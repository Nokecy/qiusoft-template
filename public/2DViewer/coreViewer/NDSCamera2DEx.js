!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NDSCamera2DEx=t():e.NDSCamera2DEx=t()}(window,function(){return r=[function(e,t,r){r.r(t);console.log("NDS ExtensionFramework V0.1");let i={FLAG_ENABLE_NODE_TRANSFORM:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,FLAG_ENABLE_NODE_STOREVIEW:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<1,FLAG_ENABLE_NODE_CAMERA2D:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<2,FLAG_ENABLE_NODE_BLOCK:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<3,FLAG_ENABLE_NODE_TEXT:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<4};class o extends NDSWebViewer.Extension{constructor(){super()}onLoad(e){}onInitLights(){}update(e){}setFlags(e){super.setFlags(e)}onNdsModelPrepareForRendering(e){}onBeforeNdsModelUpdate(e,t){}onAfterNdsModelUpdate(e,t){}onBeforeNdsModelSetRender(e,t){}onAfterNdsModelSetRender(e,t){}onBeforeNdsMeshRender(e,t){}getExtensionWithFlags(e){return NDSWebViewer.ExtensionManager.getExtensionWithFlags(e)}resetToDefault(){}getStoreInfo(e){throw this.name+" Extesion did not implement method 'getStoreInfo' "}setStoreInfo(e){throw this.name+" Extesion did not implement method 'setStoreInfo' "}getBodyTransform(e){return new THREE.Matrix4}getBodyNodeTranslate(e){return new THREE.Vector3(0,0,0)}}r=new class extends o{constructor(){super(),this.setFlags(i.FLAG_ENABLE_NODE_CAMERA2D),this.name="NDSCamera2DExtension",console.log("NDSCamera2DExtension version 1.0.0"),this.coreView=null,this.fixedViewInfo=null}onLoad(e){this.coreView=e}setCameraRotate(e){var t,r;this.coreView&&(e=e*Math.PI/180,(t=(new THREE.Vector3).fromArray(this.coreView.cameraInfoFile.up)).applyAxisAngle(new THREE.Vector3(0,0,1),e),e=this.coreView.camera.position.clone(),r=this.coreView.camera.target.clone(),this.coreView.startSmoothTranslation({position:e,up:t,center:r},function(){}))}getCameraViewInfo(){var e=[9];return e[0]=this.coreView.camera.position.x,e[1]=this.coreView.camera.position.y,e[2]=this.coreView.camera.position.z,e[3]=this.coreView.camera.up.x,e[4]=this.coreView.camera.up.y,e[5]=this.coreView.camera.up.z,e[6]=this.coreView.camera.target.x,e[7]=this.coreView.camera.target.y,e[8]=this.coreView.camera.target.z,e[9]=this.coreView.camera.near,e[10]=this.coreView.camera.far,e[11]=this.coreView.camera.fov,e}setCameraViewInfo(r){var i={position:new THREE.Vector3(r[0],r[1],r[2]),up:new THREE.Vector3(r[3],r[4],r[5]),center:new THREE.Vector3(r[6],r[7],r[8])};if(this.coreView){this.coreView.camera&&(this.coreView.camera.near=r[9],this.coreView.camera.far=r[10]);let e=this.testCameraDirection(i.position,i.center),t=this;this.coreView.startSmoothTranslation(i,function(){e&&e.notify&&t.notifyCameraDirection(e.notify,e.direction)})}}fixCameraViewInfo(r){if(r){this.fixedViewInfo={position:new THREE.Vector3(r[0],r[1],r[2]),up:new THREE.Vector3(r[3],r[4],r[5]),center:new THREE.Vector3(r[6],r[7],r[8])},this.coreView.camera&&(this.coreView.camera.near=r[9],this.coreView.camera.far=r[10]);let e=this.testCameraDirection(this.fixedViewInfo.position,this.fixedViewInfo.center),t=this;this.coreView.startSmoothTranslation(this.fixedViewInfo,function(){e&&e.notify&&t.notifyCameraDirection(e.notify,e.direction)})}else this.fixedViewInfo=null}changeCameraInfo(e){this.coreView.startSmoothTranslation(e,function(){})}getCameraDirection(){let e="front";return e=this.coreView.isECAD2DViewer&&this.coreView&&this.coreView.camera&&this.coreView.camera.position.z<this.coreView.camera.target.z?"back":e}setCameraDirection(e){var t,r,i,o;this.getCameraDirection()!=e&&(t=this.coreView.camera.position,i=2*(r=this.coreView.camera.getCameraTarget()).z-t.z,o=Math.abs(i),this.coreView.camera.near>o&&(this.coreView.camera.near=.9*o),this.coreView.camera.far<o&&(this.coreView.camera.far=1.1*o),this.coreView.camera.position.set(t.x,t.y,i),this.coreView.camera.lookAt(r),this.coreView.camera.updateProjectionMatrix(),this.coreView.render(),this.coreView.dispatchEvent({type:"CameraDirection",value:e}),this.updateOriginalCamera())}testCameraDirection(e,t){if(this.coreView.isECAD2DViewer){var r=this.getCameraDirection(),e=e.z<t.z?"back":"front";if(r!=e)return this.updateOriginalCamera(),{notify:!0,direction:e}}return{notify:!1,direction:null}}notifyCameraDirection(e,t){e&&t&&this.coreView.dispatchEvent({type:"CameraDirection",value:t})}updateOriginalCamera(){var e,t,r=this.coreView.camera.getOrginalCameraInfo();r&&(e=2*r.center.z-r.position.z,t=Math.abs(e),r.near>t&&(r.near=.9*t),r.far<t&&(r.far=1.1*t),r.position.z=e)}};NDSWebViewer.ExtensionManager.addExtension(r)}],i={},o.m=r,o.c=i,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0);function o(e){var t;return(i[e]||(t=i[e]={i:e,l:!1,exports:{}},r[e].call(t.exports,t,t.exports,o),t.l=!0,t)).exports}var r,i});