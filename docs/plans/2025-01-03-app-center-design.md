# åº”ç”¨ä¸­å¿ƒè®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€æ¦‚è¿°

### 1.1 èƒŒæ™¯

dynamic-schema ç³»ç»Ÿå·²å®Œæˆç®¡ç†ç«¯åŠŸèƒ½ï¼ˆåº”ç”¨ç®¡ç†ã€å®ä½“é…ç½®ã€è¡¨å•è®¾è®¡ç­‰ï¼‰ï¼Œç°éœ€ä¸ºç»ˆç«¯ç”¨æˆ·æä¾›"åº”ç”¨ä¸­å¿ƒ"å…¥å£ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæµè§ˆå¯ç”¨åº”ç”¨å¹¶è¿›è¡Œæ•°æ®æ“ä½œã€‚

### 1.2 ç›®æ ‡

- æä¾›ç›´è§‚çš„åº”ç”¨æµè§ˆç•Œé¢ï¼ˆå¡ç‰‡ç½‘æ ¼å¼ï¼‰
- æ”¯æŒç”¨æˆ·è¿›å…¥åº”ç”¨åæŸ¥çœ‹æ•°æ®æ¦‚è§ˆå’Œè¿›è¡Œ CRUD æ“ä½œ
- å¤ç”¨ç°æœ‰ API å’Œæƒé™ä½“ç³»ï¼Œé™ä½å¼€å‘æˆæœ¬

### 1.3 æ¨¡å—å®šä½

```
ç®¡ç†ç«¯ (/appSYS/dynamic-schema/)     ç»ˆç«¯ç”¨æˆ· (/appCenter/)
â”œâ”€â”€ åº”ç”¨ç®¡ç† (åˆ›å»º/é…ç½®åº”ç”¨)         â”œâ”€â”€ åº”ç”¨åˆ—è¡¨ (å¡ç‰‡ç½‘æ ¼æµè§ˆ)
â”œâ”€â”€ å®ä½“/å­—æ®µé…ç½®                    â””â”€â”€ åº”ç”¨æ•°æ®é¡µ (ä»ªè¡¨ç›˜+æ•°æ®æ“ä½œ)
â”œâ”€â”€ è¡¨å•è®¾è®¡å™¨
â””â”€â”€ æ•°æ®ç®¡ç† (ç®¡ç†å‘˜è§†è§’)
```

---

## äºŒã€è·¯ç”±ç»“æ„

```
/appCenter/
â”œâ”€â”€ index.tsx          # åº”ç”¨å¡ç‰‡åˆ—è¡¨é¡µ
â””â”€â”€ app/
    â””â”€â”€ index.tsx      # åº”ç”¨æ•°æ®é¡µ (?name=xxx)
```

### 2.1 è·¯ç”±é…ç½®

åœ¨ `config/routeItems/` æ–°å¢ `appCenter.json`ï¼š

```json
[
  {
    "path": "/appCenter",
    "name": "åº”ç”¨ä¸­å¿ƒ",
    "icon": "AppstoreOutlined",
    "routes": [
      {
        "path": "/appCenter",
        "component": "./appCenter/index",
        "name": "åº”ç”¨åˆ—è¡¨"
      },
      {
        "path": "/appCenter/app",
        "component": "./appCenter/app/index",
        "name": "åº”ç”¨æ•°æ®",
        "hideInMenu": true
      }
    ]
  }
]
```

---

## ä¸‰ã€åº”ç”¨åˆ—è¡¨é¡µ (/appCenter/)

### 3.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨ä¸­å¿ƒ                                    ğŸ” æœç´¢æ¡†  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š     â”‚  â”‚  ğŸ“¦     â”‚  â”‚  ğŸ‘¥     â”‚  â”‚  ğŸ“‹     â”‚   â”‚
â”‚  â”‚ é”€å”®ç®¡ç† â”‚  â”‚ åº“å­˜ç®¡ç† â”‚  â”‚ å®¢æˆ·ç®¡ç† â”‚  â”‚ è®¢å•ç®¡ç† â”‚   â”‚
â”‚  â”‚ 1,234æ¡ â”‚  â”‚  856æ¡  â”‚  â”‚  432æ¡  â”‚  â”‚ 2,156æ¡ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚  ğŸ”§     â”‚  â”‚  ğŸ“ˆ     â”‚                              â”‚
â”‚  â”‚ è®¾å¤‡å°è´¦ â”‚  â”‚ æŠ¥è¡¨ä¸­å¿ƒ â”‚                              â”‚
â”‚  â”‚  128æ¡  â”‚  â”‚   56æ¡  â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¡ç‰‡ç»„ä»¶è®¾è®¡

æ¯ä¸ªåº”ç”¨å¡ç‰‡å±•ç¤ºï¼š
- **å›¾æ ‡** - ä½¿ç”¨åº”ç”¨é…ç½®çš„ icon å­—æ®µï¼ˆAnt Design å›¾æ ‡æˆ–è‡ªå®šä¹‰ï¼‰
- **åç§°** - displayName
- **æ•°æ®é‡** - è¯¥åº”ç”¨ä¸»å®ä½“çš„æ•°æ®æ€»æ•°
- **æ‚¬æµ®æ•ˆæœ** - é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºé˜´å½±å’Œæè¿°ä¿¡æ¯

### 3.3 äº¤äº’è¡Œä¸º

| æ“ä½œ | è¡Œä¸º |
|------|------|
| ç‚¹å‡»å¡ç‰‡ | è·³è½¬åˆ° `/appCenter/app?name={applicationName}` |
| æœç´¢è¾“å…¥ | å®æ—¶è¿‡æ»¤åº”ç”¨å¡ç‰‡ï¼ˆæŒ‰åç§°/æè¿°åŒ¹é…ï¼‰ |
| ç©ºçŠ¶æ€ | æ˜¾ç¤º"æš‚æ— å¯ç”¨åº”ç”¨"æç¤º |

### 3.4 æ•°æ®è·å–

```typescript
// è·å–å·²å¯ç”¨çš„åº”ç”¨åˆ—è¡¨
DynamicApplicationGetListAsync({
  IsEnabled: true,
  MaxResultCount: 100
})
```

---

## å››ã€åº”ç”¨æ•°æ®é¡µ (/appCenter/app)

### 4.1 é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† è¿”å›åº”ç”¨ä¸­å¿ƒ    é”€å”®ç®¡ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æ•°æ®æ€»æ•°   â”‚ â”‚ ä»Šæ—¥æ–°å¢   â”‚ â”‚ æœ¬å‘¨æ–°å¢   â”‚ â”‚ æœ¬æœˆæ–°å¢  â”‚â”‚
â”‚  â”‚   1,234   â”‚ â”‚    12     â”‚ â”‚    86     â”‚ â”‚   324    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [+ æ–°å¢]  [ğŸ—‘ æ‰¹é‡åˆ é™¤]              ğŸ” æœç´¢...     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ç¼–ç      â”‚ åç§°     â”‚ çŠ¶æ€   â”‚ åˆ›å»ºæ—¶é—´   â”‚ æ“ä½œ    â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ S001    â”‚ è®¢å•A    â”‚ å·²å®Œæˆ  â”‚ 2024-01-15 â”‚ ç¼–è¾‘ åˆ é™¤â”‚â”‚
â”‚  â”‚ S002    â”‚ è®¢å•B    â”‚ è¿›è¡Œä¸­  â”‚ 2024-01-14 â”‚ ç¼–è¾‘ åˆ é™¤â”‚â”‚
â”‚  â”‚ ...     â”‚ ...     â”‚ ...    â”‚ ...       â”‚ ...     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                        < 1 2 3 4 5 >                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 é¡µé¢ç»„æˆ

#### 4.2.1 é¡¶éƒ¨å¯¼èˆªæ 
- è¿”å›æŒ‰é’® â†’ å›åˆ°åº”ç”¨ä¸­å¿ƒ
- åº”ç”¨åç§°ï¼ˆdisplayNameï¼‰
- å¯é€‰ï¼šåº”ç”¨æè¿° tooltip

#### 4.2.2 ç»Ÿè®¡å¡ç‰‡åŒº

å››ä¸ªç»Ÿè®¡å¡ç‰‡æ¨ªå‘æ’åˆ—ï¼š

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | é¢œè‰² |
|------|----------|------|
| æ•°æ®æ€»æ•° | `count(*)` | è“è‰² (#1890ff) |
| ä»Šæ—¥æ–°å¢ | `count(*) where creationTime >= today` | ç»¿è‰² (#52c41a) |
| æœ¬å‘¨æ–°å¢ | `count(*) where creationTime >= weekStart` | æ©™è‰² (#faad14) |
| æœ¬æœˆæ–°å¢ | `count(*) where creationTime >= monthStart` | ç´«è‰² (#722ed1) |

#### 4.2.3 æ•°æ®åˆ—è¡¨åŒº

å¤ç”¨ `AgGridPlus` ç»„ä»¶ï¼š
- åŠ¨æ€åˆ—å®šä¹‰ï¼ˆæ ¹æ®å®ä½“å­—æ®µç”Ÿæˆï¼‰
- å·¥å…·æ ï¼šæ–°å¢ã€æ‰¹é‡åˆ é™¤ã€æœç´¢
- æ“ä½œåˆ—ï¼šç¼–è¾‘ã€åˆ é™¤
- åˆ†é¡µæ”¯æŒ

### 4.3 è¡¨å•å¼¹çª—é€»è¾‘

```
ç”¨æˆ·ç‚¹å‡»"æ–°å¢"æˆ–"ç¼–è¾‘"
    â†“
æ£€æŸ¥æ˜¯å¦æœ‰å·²å‘å¸ƒçš„ FormSchema
    â†“
â”Œâ”€ æœ‰ â†’ ä½¿ç”¨è®¾è®¡å™¨è¡¨å•æ¸²æŸ“
â”‚
â””â”€ æ—  â†’ æ ¹æ®å®ä½“å­—æ®µåŠ¨æ€ç”Ÿæˆè¡¨å•
    â†“
ç”¨æˆ·å¡«å†™å¹¶æäº¤
    â†“
è°ƒç”¨ DynamicData API ä¿å­˜
    â†“
åˆ·æ–°åˆ—è¡¨ + æ›´æ–°ç»Ÿè®¡å¡ç‰‡
```

---

## äº”ã€API æ¥å£ä¸æ•°æ®æµ

### 5.1 å¤ç”¨ç°æœ‰ API

æ— éœ€æ–°å¢åç«¯æ¥å£ï¼Œå®Œå…¨å¤ç”¨å·²æœ‰æœåŠ¡ï¼š

| åŠŸèƒ½ | API | æ–‡ä»¶ |
|------|-----|------|
| è·å–åº”ç”¨åˆ—è¡¨ | `DynamicApplicationGetListAsync` | DynamicApplication.ts |
| è·å–åº”ç”¨è¯¦æƒ… | `DynamicApplicationGetAsync` | DynamicApplication.ts |
| è·å–æ•°æ®åˆ—è¡¨ | `DynamicDataGetListAsync` | DynamicData.ts |
| æ–°å¢æ•°æ® | `DynamicDataCreateAsync` | DynamicData.ts |
| æ›´æ–°æ•°æ® | `DynamicDataUpdateAsync` | DynamicData.ts |
| åˆ é™¤æ•°æ® | `DynamicDataDeleteAsync` | DynamicData.ts |
| æ‰¹é‡åˆ é™¤ | `DynamicDataBatchDeleteAsync` | DynamicData.ts |
| è·å–è¡¨å•Schema | `FormSchemaGetPublishedAsync` | FormSchema.ts |

### 5.2 ç»Ÿè®¡æ•°æ®æ–¹æ¡ˆ

**åˆæœŸæ–¹æ¡ˆï¼šå‰ç«¯è®¡ç®—**
```typescript
// è·å–æ•°æ®åˆ—è¡¨æ—¶å¸¦ä¸Š creationTime å­—æ®µ
// å‰ç«¯æ ¹æ®è¿”å›æ•°æ®è®¡ç®—ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆæ–°å¢
// ä¼˜ç‚¹ï¼šæ— éœ€åç«¯æ”¹åŠ¨
// ç¼ºç‚¹ï¼šæ•°æ®é‡å¤§æ—¶æ€§èƒ½å—é™
```

**åç»­ä¼˜åŒ–ï¼šåç«¯ç»Ÿè®¡æ¥å£**
```typescript
// GET /api/dynamic-schema/dynamic-data/statistics?applicationName=xxx
// è¿”å›ï¼š{ total, todayCount, weekCount, monthCount }
```

### 5.3 é¡µé¢æ•°æ®æµ

```
/appCenter/ (åº”ç”¨åˆ—è¡¨é¡µ)
â”‚
â”œâ”€â”€ åˆå§‹åŒ–
â”‚   â””â”€â”€ DynamicApplicationGetListAsync({ IsEnabled: true })
â”‚       â†’ æ¸²æŸ“åº”ç”¨å¡ç‰‡
â”‚
â””â”€â”€ ç‚¹å‡»å¡ç‰‡
    â””â”€â”€ history.push(`/appCenter/app?name=${app.name}`)


/appCenter/app?name=xxx (åº”ç”¨æ•°æ®é¡µ)
â”‚
â”œâ”€â”€ åˆå§‹åŒ–ï¼ˆå¹¶è¡Œè¯·æ±‚ï¼‰
â”‚   â”œâ”€â”€ DynamicApplicationGetAsync({ name }) â†’ è·å–åº”ç”¨+å®ä½“ä¿¡æ¯
â”‚   â”œâ”€â”€ DynamicDataGetListAsync({ applicationName }) â†’ æ•°æ®åˆ—è¡¨
â”‚   â””â”€â”€ FormSchemaGetPublishedAsync({ applicationName }) â†’ è¡¨å•é…ç½®
â”‚
â”œâ”€â”€ ç»Ÿè®¡å¡ç‰‡
â”‚   â””â”€â”€ æ ¹æ®æ•°æ®åˆ—è¡¨çš„ creationTime å‰ç«¯è®¡ç®—
â”‚
â”œâ”€â”€ æ–°å¢/ç¼–è¾‘
â”‚   â”œâ”€â”€ æœ‰ FormSchema â†’ æ¸²æŸ“è®¾è®¡å™¨è¡¨å•
â”‚   â””â”€â”€ æ—  FormSchema â†’ åŠ¨æ€ç”Ÿæˆè¡¨å•
â”‚
â””â”€â”€ æäº¤ä¿å­˜
    â””â”€â”€ DynamicDataCreateAsync / UpdateAsync â†’ åˆ·æ–°åˆ—è¡¨
```

---

## å…­ã€æ–‡ä»¶ç»“æ„ä¸ç»„ä»¶åˆ’åˆ†

### 6.1 ç›®å½•ç»“æ„

```
src/pages/appCenter/
â”œâ”€â”€ index.tsx                    # åº”ç”¨å¡ç‰‡åˆ—è¡¨é¡µ
â”œâ”€â”€ app/
â”‚   â””â”€â”€ index.tsx                # åº”ç”¨æ•°æ®é¡µ
â”œâ”€â”€ _components/
â”‚   â”œâ”€â”€ AppCard.tsx              # åº”ç”¨å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ AppCardGrid.tsx          # å¡ç‰‡ç½‘æ ¼å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ StatisticCards.tsx       # ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
â”‚   â””â”€â”€ DataFormDialog.tsx       # æ•°æ®è¡¨å•å¼¹çª—ï¼ˆæ™ºèƒ½é€‰æ‹©è¡¨å•ï¼‰
â”œâ”€â”€ _hooks/
â”‚   â””â”€â”€ useAppStatistics.ts      # ç»Ÿè®¡æ•°æ®è®¡ç®— Hook
â””â”€â”€ _utils/
    â””â”€â”€ formGenerator.ts         # åŠ¨æ€è¡¨å•ç”Ÿæˆå·¥å…·
```

### 6.2 ç»„ä»¶èŒè´£

| ç»„ä»¶ | èŒè´£ |
|------|------|
| `AppCard` | å•ä¸ªåº”ç”¨å¡ç‰‡æ¸²æŸ“ï¼ˆå›¾æ ‡ã€åç§°ã€æ•°æ®é‡ã€æ‚¬æµ®æ•ˆæœï¼‰ |
| `AppCardGrid` | å¡ç‰‡ç½‘æ ¼å¸ƒå±€ã€æœç´¢è¿‡æ»¤ã€ç©ºçŠ¶æ€å¤„ç† |
| `StatisticCards` | å››ä¸ªç»Ÿè®¡å¡ç‰‡çš„å±•ç¤ºï¼Œæ¥æ”¶æ•°æ®åˆ—è¡¨è®¡ç®—ç»Ÿè®¡å€¼ |
| `DataFormDialog` | æ™ºèƒ½è¡¨å•å¼¹çª—ï¼Œä¼˜å…ˆä½¿ç”¨ FormSchemaï¼Œé™çº§åŠ¨æ€ç”Ÿæˆ |
| `useAppStatistics` | è®¡ç®—ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆæ–°å¢çš„é€»è¾‘å°è£… |
| `formGenerator` | æ ¹æ®å®ä½“å­—æ®µç”Ÿæˆ Formily Schema çš„å·¥å…·å‡½æ•° |

---

## ä¸ƒã€å…³é”®å®ç°ç»†èŠ‚

### 7.1 AppCard å¡ç‰‡ç»„ä»¶

```typescript
// æ ¸å¿ƒ Props
interface AppCardProps {
  app: {
    name: string;
    displayName: string;
    description?: string;
    icon?: string;
  };
  dataCount: number;
  onClick: () => void;
}

// æ ·å¼è¦ç‚¹
// - å›ºå®šå®½åº¦ 180pxï¼Œé«˜åº¦ 140px
// - åœ†è§’ 8pxï¼Œè½»å¾®é˜´å½±
// - æ‚¬æµ®æ—¶é˜´å½±åŠ æ·± + è½»å¾®ä¸Šç§»åŠ¨ç”»
// - å›¾æ ‡ä½¿ç”¨ Ant Design Icon åŠ¨æ€æ¸²æŸ“
// - æ•°æ®é‡ä½¿ç”¨åƒåˆ†ä½æ ¼å¼åŒ–ï¼ˆ1,234ï¼‰
```

### 7.2 StatisticCards ç»Ÿè®¡ç»„ä»¶

```typescript
// ä½¿ç”¨ Ant Design Statistic + Card ç»„ä»¶
// å››åˆ—ç­‰å®½å¸ƒå±€ï¼Œä½¿ç”¨ Row + Col span={6}

interface StatisticCardsProps {
  total: number;
  todayCount: number;
  weekCount: number;
  monthCount: number;
  loading?: boolean;
}
```

### 7.3 useAppStatistics Hook

```typescript
import { useMemo } from 'react';
import dayjs from 'dayjs';

function useAppStatistics(dataList: any[]) {
  return useMemo(() => {
    const now = dayjs();
    const todayStart = now.startOf('day');
    const weekStart = now.startOf('week');
    const monthStart = now.startOf('month');

    return {
      total: dataList.length,
      todayCount: dataList.filter(d =>
        dayjs(d.creationTime).isAfter(todayStart)
      ).length,
      weekCount: dataList.filter(d =>
        dayjs(d.creationTime).isAfter(weekStart)
      ).length,
      monthCount: dataList.filter(d =>
        dayjs(d.creationTime).isAfter(monthStart)
      ).length,
    };
  }, [dataList]);
}

export default useAppStatistics;
```

### 7.4 DataFormDialog æ™ºèƒ½è¡¨å•

```typescript
// è¡¨å•é€‰æ‹©é€»è¾‘
async function getFormSchema(applicationName: string, entityId: string) {
  // 1. ä¼˜å…ˆå°è¯•è·å–å·²å‘å¸ƒçš„ FormSchema
  const published = await FormSchemaGetPublishedAsync({
    applicationName,
    entityId
  });

  if (published?.schema) {
    return { type: 'designer', schema: published.schema };
  }

  // 2. é™çº§ï¼šæ ¹æ®å®ä½“å­—æ®µåŠ¨æ€ç”Ÿæˆ
  const entity = await getEntityFields(applicationName);
  const generatedSchema = generateFormilySchema(entity.fields);
  return { type: 'generated', schema: generatedSchema };
}
```

### 7.5 åŠ¨æ€åˆ—ç”Ÿæˆ

å‚è€ƒ `/appSYS/dynamic-schema/data/index.tsx` çš„åˆ—ç”Ÿæˆé€»è¾‘ï¼š

```typescript
// å­—æ®µç±»å‹ â†’ åˆ—é…ç½®æ˜ å°„
const fieldTypeConfig = {
  [FieldDataType.String]: { width: 150, hideInSearch: false },
  [FieldDataType.Int]: { width: 100, hideInSearch: true },
  [FieldDataType.DateTime]: { width: 160, hideInSearch: false },
  [FieldDataType.Boolean]: { width: 80, hideInSearch: true },
  // ...
};
```

---

## å…«ã€é”™è¯¯å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ

### 8.1 å¼‚å¸¸åœºæ™¯å¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|----------|
| åº”ç”¨åˆ—è¡¨ä¸ºç©º | æ˜¾ç¤ºç©ºçŠ¶æ€æ’å›¾ + "æš‚æ— å¯ç”¨åº”ç”¨" æç¤º |
| åº”ç”¨ä¸å­˜åœ¨/æœªå¯ç”¨ | è·³è½¬å›åº”ç”¨ä¸­å¿ƒ + æç¤º"åº”ç”¨ä¸å­˜åœ¨æˆ–å·²ç¦ç”¨" |
| åº”ç”¨æ— ä¸»å®ä½“ | æ˜¾ç¤ºæç¤º"è¯¥åº”ç”¨å°šæœªé…ç½®æ•°æ®ç»“æ„" |
| æ•°æ®åŠ è½½å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯æç¤º + é‡è¯•æŒ‰é’® |
| è¡¨å•æäº¤å¤±è´¥ | ä¿ç•™è¡¨å•æ•°æ® + æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ |
| æ— æƒé™è®¿é—® | å¡ç‰‡åˆ—è¡¨è‡ªåŠ¨è¿‡æ»¤ï¼Œæ•°æ®é¡µæ˜¾ç¤º403æç¤º |

### 8.2 KeepAlive å¤š Tab æ”¯æŒ

å‚è€ƒç°æœ‰ `/appSYS/dynamic-schema/applications/config` çš„å®ç°ï¼š

```typescript
// ç›‘å¬ URL å‚æ•°å˜åŒ–ï¼Œæ”¯æŒå¤š Tab åˆ‡æ¢
const CURRENT_PAGE_PATH = '/appCenter/app';

const isCurrentPage = location.pathname === CURRENT_PAGE_PATH;
const applicationName = useMemo(() => {
  if (!isCurrentPage) return '';
  const query = parse(location.search.substring(1));
  return (query.name as string) || '';
}, [location.search, isCurrentPage]);

// å‚æ•°å˜åŒ–æ—¶é‡æ–°åŠ è½½æ•°æ®
const prevNameRef = useRef<string | null>(null);
useEffect(() => {
  if (applicationName !== prevNameRef.current) {
    prevNameRef.current = applicationName;
    if (applicationName) {
      loadAppData();
    }
  }
}, [applicationName]);
```

### 8.3 åŠ è½½çŠ¶æ€

```
é¡µé¢åŠ è½½æµç¨‹ï¼š
1. æ˜¾ç¤ºéª¨æ¶å±ï¼ˆSkeletonï¼‰
2. å¹¶è¡Œè¯·æ±‚åº”ç”¨ä¿¡æ¯ + æ•°æ®åˆ—è¡¨ + è¡¨å•é…ç½®
3. è¯·æ±‚å®Œæˆåæ¸²æŸ“å®Œæ•´é¡µé¢
4. ç»Ÿè®¡å¡ç‰‡æ”¯æŒç‹¬ç«‹ loading çŠ¶æ€
```

---

## ä¹ã€æƒé™æ§åˆ¶

### 9.1 æƒé™ç­–ç•¥

å¤ç”¨ç°æœ‰ `DynamicSchema.DynamicData` æƒé™ä½“ç³»ï¼š

```typescript
DynamicDataPermissions = {
  Default: 'DynamicSchema.DynamicData',
  Create: 'DynamicSchema.DynamicData.Create',
  Update: 'DynamicSchema.DynamicData.Update',
  Delete: 'DynamicSchema.DynamicData.Delete',
  Export: 'DynamicSchema.DynamicData.Export',
  Import: 'DynamicSchema.DynamicData.Import',
}
```

### 9.2 æƒé™åº”ç”¨

| åŠŸèƒ½ | æƒé™ |
|------|------|
| æŸ¥çœ‹åº”ç”¨åˆ—è¡¨ | `DynamicSchema.DynamicData` (Default) |
| æŸ¥çœ‹æ•°æ®åˆ—è¡¨ | `DynamicSchema.DynamicData` (Default) |
| æ–°å¢æ•°æ® | `DynamicSchema.DynamicData.Create` |
| ç¼–è¾‘æ•°æ® | `DynamicSchema.DynamicData.Update` |
| åˆ é™¤æ•°æ® | `DynamicSchema.DynamicData.Delete` |

---

## åã€è®¾è®¡å†³ç­–æ€»ç»“

| ç»´åº¦ | å†³ç­– |
|------|------|
| å…¥å£å½¢å¼ | å¡ç‰‡ç½‘æ ¼å¼ï¼Œæ”¯æŒæœç´¢è¿‡æ»¤ |
| é¡µé¢å¸ƒå±€ | ä¸Šä¸‹åˆ†åŒºï¼ˆç»Ÿè®¡å¡ç‰‡ + æ•°æ®åˆ—è¡¨ï¼‰ |
| è·¯ç”±ç»“æ„ | ç‹¬ç«‹æ¨¡å— `/appCenter/` |
| æƒé™æ§åˆ¶ | å¤ç”¨ DynamicData æƒé™ä½“ç³» |
| è¡¨å•ç­–ç•¥ | è®¾è®¡å™¨è¡¨å•ä¼˜å…ˆï¼ŒåŠ¨æ€ç”Ÿæˆé™çº§ |
| ç»Ÿè®¡æŒ‡æ ‡ | æ€»æ•°ã€ä»Šæ—¥ã€æœ¬å‘¨ã€æœ¬æœˆæ–°å¢ |
| API ç­–ç•¥ | å®Œå…¨å¤ç”¨ç°æœ‰æ¥å£ |

---

## åä¸€ã€æ–‡ä»¶æ¸…å•

```
æ–°å¢æ–‡ä»¶ï¼š
â”œâ”€â”€ config/routeItems/appCenter.json
â””â”€â”€ src/pages/appCenter/
    â”œâ”€â”€ index.tsx
    â”œâ”€â”€ app/index.tsx
    â”œâ”€â”€ _components/
    â”‚   â”œâ”€â”€ AppCard.tsx
    â”‚   â”œâ”€â”€ AppCardGrid.tsx
    â”‚   â”œâ”€â”€ StatisticCards.tsx
    â”‚   â””â”€â”€ DataFormDialog.tsx
    â”œâ”€â”€ _hooks/useAppStatistics.ts
    â””â”€â”€ _utils/formGenerator.ts
```

---

## åäºŒã€åç»­æ‰©å±•æ–¹å‘

1. **åº”ç”¨åˆ†ç±»** - æ”¯æŒæŒ‰åˆ†ç±»ç­›é€‰åº”ç”¨
2. **æ”¶è—åŠŸèƒ½** - ç”¨æˆ·å¯æ”¶è—å¸¸ç”¨åº”ç”¨
3. **å¿«æ·å…¥å£** - é¦–é¡µæ˜¾ç¤ºæœ€è¿‘ä½¿ç”¨çš„åº”ç”¨
4. **æ•°æ®å¯¼å…¥å¯¼å‡º** - æ”¯æŒ Excel æ‰¹é‡æ“ä½œ
5. **åç«¯ç»Ÿè®¡æ¥å£** - ä¼˜åŒ–å¤§æ•°æ®é‡åœºæ™¯çš„ç»Ÿè®¡æ€§èƒ½
6. **å¤šå®ä½“æ”¯æŒ** - åº”ç”¨å†…æ”¯æŒåˆ‡æ¢ä¸åŒå®ä½“çš„æ•°æ®ç®¡ç†
