!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NDSAnimationExtension=t():e.NDSAnimationExtension=t()}(window,function(){return i=[function(e,t){var i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(m,_,e){!function(e){var t,y,a,o,s,l,d,h,u,i,r,n,c;function p(){this.init()}function f(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")}p.prototype={init:function(){var e=this||y;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||y;if(e=parseFloat(e),t.ctx||u(),void 0!==e&&0<=e&&e<=1){if(t._volume=e,!t._muted){t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,y.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),n=0;n<r.length;n++){var a=t._howls[i]._soundById(r[n]);a&&a._node&&(a._node.volume=a._volume*e)}}return t}return t._volume},mute:function(e){var t=this||y;t.ctx||u(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,y.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),n=0;n<r.length;n++){var a=t._howls[i]._soundById(r[n]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},stop:function(){for(var e=this||y,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||y,t=e._howls.length-1;0<=t;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs:function(e){return(this||y)._codecs[e.replace(/^x-/,"")]},_setup:function(){var t=this||y;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(e){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var e,t,i,r,n=this||y,a=null;try{a="undefined"!=typeof Audio?new Audio:null}catch(e){return n}return a&&"function"==typeof a.canPlayType&&(e=a.canPlayType("audio/mpeg;").replace(/^no$/,""),t=(t=(i=n._navigator?n._navigator.userAgent:"").match(/OPR\/(\d+)/g))&&parseInt(t[0].split("/")[1],10)<33,r=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),i=i.match(/Version\/(.*?) /),r=r&&i&&parseInt(i[1],10)<15,n._codecs={mp3:!(t||!e&&!a.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!e,opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(a.canPlayType('audio/wav; codecs="1"')||a.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!a.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(a.canPlayType("audio/x-m4b;")||a.canPlayType("audio/m4b;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(r||!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(r||!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!a.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(a.canPlayType("audio/x-flac;")||a.canPlayType("audio/flac;")).replace(/^no$/,"")}),n},_unlockAudio:function(){var s,l=this||y;if(!l._audioUnlocked&&l.ctx)return l._audioUnlocked=!1,l.autoUnlock=!1,l._mobileUnloaded||44100===l.ctx.sampleRate||(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050),s=function(e){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var t=new Audio;t._unlocked=!0,l._releaseHtml5Audio(t)}catch(e){l.noAudio=!0;break}for(var i=0;i<l._howls.length;i++)if(!l._howls[i]._webAudio)for(var r=l._howls[i]._getSoundIds(),n=0;n<r.length;n++){var a=l._howls[i]._soundById(r[n]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}l._autoResume();var o=l.ctx.createBufferSource();o.buffer=l._scratchBuffer,o.connect(l.ctx.destination),void 0===o.start?o.noteOn(0):o.start(0),"function"==typeof l.ctx.resume&&l.ctx.resume(),o.onended=function(){o.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",s,!0),document.removeEventListener("touchend",s,!0),document.removeEventListener("click",s,!0),document.removeEventListener("keydown",s,!0);for(var e=0;e<l._howls.length;e++)l._howls[e]._emit("unlock")}},document.addEventListener("touchstart",s,!0),document.addEventListener("touchend",s,!0),document.addEventListener("click",s,!0),document.addEventListener("keydown",s,!0),l},_obtainHtml5Audio:function(){var e=this||y;return e._html5AudioPool.length?e._html5AudioPool.pop():((e=(new Audio).play())&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio)},_releaseHtml5Audio:function(e){var t=this||y;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&y.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){var e;t.autoSuspend&&(t._suspendTimer=null,t.state="suspending",e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())},t.ctx.suspend().then(e,e))},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&y.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}},y=new p,f.prototype={init:function(e){var t=this;return y.ctx||u(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=y.usingWebAudio&&!t._html5,void 0!==y.ctx&&y.ctx&&y.autoUnlock&&y._unlockAudio(),y._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(y.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var i,r,n=0;n<e._src.length;n++){if(e._format&&e._format[n])i=e._format[n];else{if("string"!=typeof(r=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}i=(i=(i=/^data:audio\/([^;,]+);/i.exec(r))||/\.([^.]+)$/.exec(r.split("?",1)[0]))&&i[1].toLowerCase()}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&y.codecs(i)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&s(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,i){var r=this,e=null;if("number"==typeof t)e=t,t=null;else{if("string"==typeof t&&"loaded"===r._state&&!r._sprite[t])return null;if(void 0===t&&(t="__default",!r._playLock)){for(var n=0,a=0;a<r._sounds.length;a++)r._sounds[a]._paused&&!r._sounds[a]._ended&&(n++,e=r._sounds[a]._id);1===n?t=null:e=null}}var o,s=e?r._soundById(e):r._inactiveSound();if(!s)return null;if(e&&!t&&(t=s._sprite||"__default"),"loaded"!==r._state)return s._sprite=t,s._ended=!1,o=s._id,r._queue.push({event:"play",action:function(){r.play(o)}}),o;if(e&&!s._paused)return i||r._loadQueue("play"),s._id;r._webAudio&&y._autoResume();var l,d,h,u,c=Math.max(0,0<s._seek?s._seek:r._sprite[t][0]/1e3),p=Math.max(0,(r._sprite[t][0]+r._sprite[t][1])/1e3-c),f=1e3*p/Math.abs(s._rate),m=r._sprite[t][0]/1e3,_=(r._sprite[t][0]+r._sprite[t][1])/1e3,g=(s._sprite=t,s._ended=!1,function(){s._paused=!1,s._seek=c,s._start=m,s._stop=_,s._loop=!(!s._loop&&!r._sprite[t][2])});if(!(_<=c))return l=s._node,r._webAudio?(h=function(){r._playLock=!1,g(),r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;l.gain.setValueAtTime(e,y.ctx.currentTime),s._playStart=y.ctx.currentTime,void 0===l.bufferSource.start?s._loop?l.bufferSource.noteGrainOn(0,c,86400):l.bufferSource.noteGrainOn(0,c,p):s._loop?l.bufferSource.start(0,c,86400):l.bufferSource.start(0,c,p),f!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),f)),i||setTimeout(function(){r._emit("play",s._id),r._loadQueue()},0)},"running"===y.state&&"interrupted"!==y.ctx.state?h():(r._playLock=!0,r.once("resume",h),r._clearTimer(s._id))):(d=function(){l.currentTime=c,l.muted=s._muted||r._muted||y._muted||l.muted,l.volume=s._volume*y.volume(),l.playbackRate=s._rate;try{var e=l.play();e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(r._playLock=!0,g(),e.then(function(){r._playLock=!1,l._unlocked=!0,i?r._loadQueue():r._emit("play",s._id)}).catch(function(){r._playLock=!1,r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0})):i||(r._playLock=!1,g(),r._emit("play",s._id)),l.playbackRate=s._rate,l.paused?r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."):"__default"!==t||s._loop?r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),f):(r._endTimers[s._id]=function(){r._ended(s),l.removeEventListener("ended",r._endTimers[s._id],!1)},l.addEventListener("ended",r._endTimers[s._id],!1))}catch(e){r._emit("playerror",s._id,e)}},"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===l.src&&(l.src=r._src,l.load()),h=window&&window.ejecta||!l.readyState&&y._navigator.isCocoonJS,3<=l.readyState||h?d():(r._playLock=!0,r._state="loading",u=function(){r._state="loaded",d(),l.removeEventListener(y._canPlayEvent,u,!1)},l.addEventListener(y._canPlayEvent,u,!1),r._clearTimer(s._id))),s._id;r._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)t._queue.push({event:"pause",action:function(){t.pause(e)}});else for(var i=t._getSoundIds(e),r=0;r<i.length;r++){t._clearTimer(i[r]);var n=t._soundById(i[r]);if(n&&!n._paused&&(n._seek=t.seek(i[r]),n._rateSeek=0,n._paused=!0,t._stopFade(i[r]),n._node))if(t._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),t._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||t._emit("pause",n?n._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)i._queue.push({event:"stop",action:function(){i.stop(e)}});else for(var r=i._getSoundIds(e),n=0;n<r.length;n++){i._clearTimer(r[n]);var a=i._soundById(r[n]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,i._stopFade(r[n]),a._node&&(i._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),i._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&i._clearSound(a._node))),t||i._emit("stop",a._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)i._queue.push({event:"mute",action:function(){i.mute(e,t)}});else{if(void 0===t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var r=i._getSoundIds(t),n=0;n<r.length;n++){var a=i._soundById(r[n]);a&&(a._muted=e,a._interval&&i._stopFade(a._id),i._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,y.ctx.currentTime):a._node&&(a._node.muted=!!y._muted||e),i._emit("mute",a._id))}}return i},volume:function(){var e,t,i=this,r=arguments;if(0===r.length)return i._volume;if(1===r.length||2===r.length&&void 0===r[1]?0<=i._getSoundIds().indexOf(r[0])?n=parseInt(r[0],10):e=parseFloat(r[0]):2<=r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10)),!(void 0!==e&&0<=e&&e<=1))return(t=n?i._soundById(n):i._sounds[0])?t._volume:0;if("loaded"!==i._state||i._playLock)i._queue.push({event:"volume",action:function(){i.volume.apply(i,r)}});else{void 0===n&&(i._volume=e);for(var n=i._getSoundIds(n),a=0;a<n.length;a++)(t=i._soundById(n[a]))&&(t._volume=e,r[2]||i._stopFade(n[a]),i._webAudio&&t._node&&!t._muted?t._node.gain.setValueAtTime(e,y.ctx.currentTime):t._node&&!t._muted&&(t._node.volume=e*y.volume()),i._emit("volume",t._id))}return i},fade:function(e,t,i,r){var n=this;if("loaded"!==n._state||n._playLock)n._queue.push({event:"fade",action:function(){n.fade(e,t,i,r)}});else{e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),n.volume(e,r);for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s,l,d=n._soundById(a[o]);d&&(r||n._stopFade(a[o]),n._webAudio&&!d._muted&&(l=(s=y.ctx.currentTime)+i/1e3,d._volume=e,d._node.gain.setValueAtTime(e,s),d._node.gain.linearRampToValueAtTime(t,l)),n._startFadeInterval(d,e,t,i,a[o],void 0===r))}}return n},_startFadeInterval:function(t,i,r,n,e,a){var o=this,s=i,l=r-i,d=Math.abs(l/.01),d=Math.max(4,0<d?n/d:n),h=Date.now();t._fadeTo=r,t._interval=setInterval(function(){var e=(Date.now()-h)/n;h=Date.now(),s+=l*e,s=Math.round(100*s)/100,s=l<0?Math.max(r,s):Math.min(r,s),o._webAudio?t._volume=s:o.volume(s,t._id,!0),a&&(o._volume=s),(r<i&&s<=r||i<r&&r<=s)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,o.volume(r,t._id),o._emit("fade",t._id))},d)},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(y.ctx.currentTime),clearInterval(i._interval),i._interval=null,t.volume(i._fadeTo,e),i._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,i,r=this,n=arguments;if(0===n.length)return r._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(i=r._soundById(parseInt(n[0],10)))&&i._loop;r._loop=e=n[0]}else 2===n.length&&(e=n[0],t=parseInt(n[1],10));for(var a=r._getSoundIds(t),o=0;o<a.length;o++)(i=r._soundById(a[o]))&&(i._loop=e,r._webAudio)&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e)&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,r.playing(a[o]))&&(r.pause(a[o],!0),r.play(a[o],!0));return r},rate:function(){var e,t=this,i=arguments;if(0===i.length?a=t._sounds[0]._id:1===i.length?0<=t._getSoundIds().indexOf(i[0])?a=parseInt(i[0],10):e=parseFloat(i[0]):2===i.length&&(e=parseFloat(i[0]),a=parseInt(i[1],10)),"number"!=typeof e)return((n=t._soundById(a))||t)._rate;if("loaded"!==t._state||t._playLock)t._queue.push({event:"rate",action:function(){t.rate.apply(t,i)}});else{void 0===a&&(t._rate=e);for(var r,n,a=t._getSoundIds(a),o=0;o<a.length;o++)(n=t._soundById(a[o]))&&(t.playing(a[o])&&(n._rateSeek=t.seek(a[o]),n._playStart=t._webAudio?y.ctx.currentTime:n._playStart),n._rate=e,t._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,y.ctx.currentTime):n._node&&(n._node.playbackRate=e),r=t.seek(a[o]),r=1e3*((t._sprite[n._sprite][0]+t._sprite[n._sprite][1])/1e3-r)/Math.abs(n._rate),!t._endTimers[a[o]]&&n._paused||(t._clearTimer(a[o]),t._endTimers[a[o]]=setTimeout(t._ended.bind(t,n),r)),t._emit("rate",n._id))}return t},seek:function(){var e,t,i=this,r=arguments;if(0===r.length?i._sounds.length&&(t=i._sounds[0]._id):1===r.length?0<=i._getSoundIds().indexOf(r[0])?t=parseInt(r[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(r[0])):2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),void 0===t)return 0;if("number"!=typeof e||"loaded"===i._state&&!i._playLock){var n,a,o,s,l,d=i._soundById(t);if(d){if(!("number"==typeof e&&0<=e))return i._webAudio?(s=i.playing(t)?y.ctx.currentTime-d._playStart:0,l=d._rateSeek?d._rateSeek-d._seek:0,d._seek+(l+s*Math.abs(d._rate))):d._node.currentTime;(n=i.playing(t))&&i.pause(t,!0),d._seek=e,d._ended=!1,i._clearTimer(t),i._webAudio||!d._node||isNaN(d._node.duration)||(d._node.currentTime=e),a=function(){n&&i.play(t,!0),i._emit("seek",t)},n&&!i._webAudio?(o=function(){i._playLock?setTimeout(o,0):a()},setTimeout(o,0)):a()}}else i._queue.push({event:"seek",action:function(){i.seek.apply(i,r)}});return i},playing:function(e){if("number"==typeof e)return!!(e=this._soundById(e))&&!e._paused;for(var t=0;t<this._sounds.length;t++)if(!this._sounds[t]._paused)return!0;return!1},duration:function(e){var t=this._duration,e=this._soundById(e);return t=e?this._sprite[e._sprite][1]/1e3:t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(y._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),y._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);for(var r=y._howls.indexOf(e),n=(0<=r&&y._howls.splice(r,1),!0),i=0;i<y._howls.length;i++)if(y._howls[i]._src===e._src||0<=e._src.indexOf(y._howls[i]._src)){n=!1;break}return o&&n&&delete o[e._src],y.noAudio=!1,e._state="unloaded",e._sounds=[],e=null},on:function(e,t,i,r){e=this["_on"+e];return"function"==typeof t&&e.push(r?{id:i,fn:t,once:r}:{id:i,fn:t}),this},off:function(e,t,i){var r=this,n=r["_on"+e],a=0;if("number"==typeof t&&(i=t,t=null),t||i)for(a=0;a<n.length;a++){var o=i===n[a].id;if(t===n[a].fn&&o||!t&&o){n.splice(a,1);break}}else if(e)r["_on"+e]=[];else for(var s=Object.keys(r),a=0;a<s.length;a++)0===s[a].indexOf("_on")&&Array.isArray(r[s[a]])&&(r[s[a]]=[]);return r},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var r=this,n=r["_on"+e],a=n.length-1;0<=a;a--)n[a].id&&n[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(r,n[a].fn),0),n[a].once&&r.off(e,n[a].fn,n[a].id));return r._loadQueue(e),r},_loadQueue:function(e){var t,i=this;return 0<i._queue.length&&((t=i._queue[0]).event===e&&(i._queue.shift(),i._loadQueue()),e||t.action()),i},_ended:function(e){var t,i=this,r=e._sprite;return!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop?setTimeout(i._ended.bind(i,e),100):(r=!(!e._loop&&!i._sprite[r][2]),i._emit("end",e._id),!i._webAudio&&r&&i.stop(e._id,!0).play(e._id),i._webAudio&&r&&(i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=y.ctx.currentTime,t=1e3*(e._stop-e._start)/Math.abs(e._rate),i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),t)),i._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),y._autoSuspend()),i._webAudio||r||i.stop(e._id,!0)),i},_clearTimer:function(e){var t,i=this;return i._endTimers[e]&&("function"!=typeof i._endTimers[e]?clearTimeout(i._endTimers[e]):(t=i._soundById(e))&&t._node&&t._node.removeEventListener("ended",i._endTimers[e],!1),delete i._endTimers[e]),i},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,i=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&i++;for(r=e._sounds.length-1;0<=r;r--){if(i<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),i--)}}},_getSoundIds:function(e){if(void 0!==e)return[e];for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t},_refreshBuffer:function(e){return e._node.bufferSource=y.ctx.createBufferSource(),e._node.bufferSource.buffer=o[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,y.ctx.currentTime),this},_cleanBuffer:function(e){var t=y._navigator&&0<=y._navigator.vendor.indexOf("Apple");if(e.bufferSource){if(y._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=y._scratchBuffer}catch(e){}e.bufferSource=null}return this},_clearSound:function(e){/MSIE |Trident\//.test(y._navigator&&y._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},(a=function(e){this._parent=e,this.init()}).prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++y._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=y._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===y.ctx.createGain?y.ctx.createGainNode():y.ctx.createGain(),e._node.gain.setValueAtTime(i,y.ctx.currentTime),e._node.paused=!0,e._node.connect(y.masterGain)):y.noAudio||(e._node=y._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(y._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*y.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++y._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(y._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}},o={},s=function(t){var e=t._src;if(o[e])t._duration=o[e].duration,h(t);else if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),r=new Uint8Array(i.length),n=0;n<i.length;++n)r[n]=i.charCodeAt(n);d(r.buffer,t)}else{var a=new XMLHttpRequest;a.open(t._xhr.method,e,!0),a.withCredentials=t._xhr.withCredentials,a.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(e){a.setRequestHeader(e,t._xhr.headers[e])}),a.onload=function(){var e=(a.status+"")[0];"0"!==e&&"2"!==e&&"3"!==e?t._emit("loaderror",null,"Failed loading audio file with status: "+a.status+"."):d(a.response,t)},a.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete o[e],t.load())},l(a)}},l=function(t){try{t.send()}catch(e){t.onerror()}},d=function(e,t){function i(){t._emit("loaderror",null,"Decoding audio data failed.")}function r(e){e&&0<t._sounds.length?(o[t._src]=e,h(t,e)):i()}"undefined"!=typeof Promise&&1===y.ctx.decodeAudioData.length?y.ctx.decodeAudioData(e).then(r).catch(i):y.ctx.decodeAudioData(e,r,i)},h=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},u=function(){if(y.usingWebAudio){try{"undefined"!=typeof AudioContext?y.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?y.ctx=new webkitAudioContext:y.usingWebAudio=!1}catch(e){y.usingWebAudio=!1}y.ctx||(y.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(y._navigator&&y._navigator.platform),t=y._navigator&&y._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=t?parseInt(t[1],10):null;e&&t&&t<9&&(e=/safari/.test(y._navigator&&y._navigator.userAgent.toLowerCase()),y._navigator)&&!e&&(y.usingWebAudio=!1),y.usingWebAudio&&(y.masterGain=void 0===y.ctx.createGain?y.ctx.createGainNode():y.ctx.createGain(),y.masterGain.gain.setValueAtTime(y._muted?0:y._volume,y.ctx.currentTime),y.masterGain.connect(y.ctx.destination)),y._setup()}},void 0!==(t=function(){return{Howler:y,Howl:f}}.apply(_,[]))&&(m.exports=t),_.Howler=y,_.Howl=f,void 0!==e?(e.HowlerGlobal=p,e.Howler=y,e.Howl=f,e.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=p,window.Howler=y,window.Howl=f,window.Sound=a),HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(t.ctx&&t.ctx.listener)for(var i=t._howls.length-1;0<=i;i--)t._howls[i].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,i){var r=this;if(r.ctx&&r.ctx.listener){if(t="number"!=typeof t?r._pos[1]:t,i="number"!=typeof i?r._pos[2]:i,"number"!=typeof e)return r._pos;r._pos=[e,t,i],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2])}return r},HowlerGlobal.prototype.orientation=function(e,t,i,r,n,a){var o=this;if(o.ctx&&o.ctx.listener){var s=o._orientation;if(t="number"!=typeof t?s[1]:t,i="number"!=typeof i?s[2]:i,r="number"!=typeof r?s[3]:r,n="number"!=typeof n?s[4]:n,a="number"!=typeof a?s[5]:a,"number"!=typeof e)return s;o._orientation=[e,t,i,r,n,a],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,i,r,n,a)}return o},Howl.prototype.init=(i=Howl.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],i.call(this,e)}),Howl.prototype.stereo=function(e,t){var i=this;if(i._webAudio)if("loaded"!==i._state)i._queue.push({event:"stereo",action:function(){i.stereo(e,t)}});else{var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var n=i._getSoundIds(t),a=0;a<n.length;a++){var o=i._soundById(n[a]);if(o){if("number"!=typeof e)return o._stereo;o._stereo=e,o._pos=[e,0,0],o._node&&(o._pannerAttr.panningModel="equalpower",o._panner&&o._panner.pan||c(o,r),"spatial"==r?void 0!==o._panner.positionX?(o._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),o._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),o._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):o._panner.setPosition(e,0,0):o._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",o._id)}}}return i},Howl.prototype.pos=function(e,t,i,r){var n=this;if(n._webAudio)if("loaded"!==n._state)n._queue.push({event:"pos",action:function(){n.pos(e,t,i,r)}});else{if(t="number"!=typeof t?0:t,i="number"!=typeof i?-.5:i,void 0===r){if("number"!=typeof e)return n._pos;n._pos=[e,t,i]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._pos;s._pos=[e,t,i],s._node&&(s._panner&&!s._panner.pan||c(s,"spatial"),void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):s._panner.setPosition(e,t,i)),n._emit("pos",s._id)}}}return n},Howl.prototype.orientation=function(e,t,i,r){var n=this;if(n._webAudio)if("loaded"!==n._state)n._queue.push({event:"orientation",action:function(){n.orientation(e,t,i,r)}});else{if(t="number"!=typeof t?n._orientation[1]:t,i="number"!=typeof i?n._orientation[2]:i,void 0===r){if("number"!=typeof e)return n._orientation;n._orientation=[e,t,i]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var s=n._soundById(a[o]);if(s){if("number"!=typeof e)return s._orientation;s._orientation=[e,t,i],s._node&&(s._panner||(s._pos||(s._pos=n._pos||[0,0,-.5]),c(s,"spatial")),void 0!==s._panner.orientationX?(s._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),s._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):s._panner.setOrientation(e,t,i)),n._emit("orientation",s._id)}}}return n},Howl.prototype.pannerAttr=function(){var e,t,i=this,r=arguments;if(i._webAudio){if(0===r.length)return i._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return((o=i._soundById(parseInt(r[0],10)))||i)._pannerAttr;e=r[0],void 0===t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===r.length&&(e=r[0],t=parseInt(r[1],10));for(var n,a,o,s=i._getSoundIds(t),l=0;l<s.length;l++)(o=i._soundById(s[l]))&&(n=o._pannerAttr,n={coneInnerAngle:(void 0!==e.coneInnerAngle?e:n).coneInnerAngle,coneOuterAngle:(void 0!==e.coneOuterAngle?e:n).coneOuterAngle,coneOuterGain:(void 0!==e.coneOuterGain?e:n).coneOuterGain,distanceModel:(void 0!==e.distanceModel?e:n).distanceModel,maxDistance:(void 0!==e.maxDistance?e:n).maxDistance,refDistance:(void 0!==e.refDistance?e:n).refDistance,rolloffFactor:(void 0!==e.rolloffFactor?e:n).rolloffFactor,panningModel:(void 0!==e.panningModel?e:n).panningModel},(a=o._panner)||(o._pos||(o._pos=i._pos||[0,0,-.5]),c(o,"spatial"),a=o._panner),a.coneInnerAngle=n.coneInnerAngle,a.coneOuterAngle=n.coneOuterAngle,a.coneOuterGain=n.coneOuterGain,a.distanceModel=n.distanceModel,a.maxDistance=n.maxDistance,a.refDistance=n.refDistance,a.rolloffFactor=n.rolloffFactor,a.panningModel=n.panningModel)}return i},Sound.prototype.init=(r=Sound.prototype.init,function(){var e=this,t=e._parent;e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,r.call(this),e._stereo?t.stereo(e._stereo):e._pos&&t.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}),Sound.prototype.reset=(n=Sound.prototype.reset,function(){var e=this,t=e._parent;return e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,e._stereo?t.stereo(e._stereo):e._pos?t.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,t._refreshBuffer(e)),n.call(this)}),c=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}.call(this,e(0))},function(e,t){var i,r,e=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}function o(t){if(i===setTimeout)return setTimeout(t,0);if((i===n||!i)&&setTimeout)return(i=setTimeout)(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}var s,l=[],d=!1,h=-1;function u(){d&&s&&(d=!1,s.length?l=s.concat(l):h=-1,l.length)&&c()}function c(){if(!d){for(var e=o(u),t=(d=!0,l.length);t;){for(s=l,l=[];++h<t;)s&&s[h].run();h=-1,t=l.length}s=null,d=!1,!function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return(r=clearTimeout)(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}e.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new p(e,t)),1!==l.length||d||o(c)},p.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=f,e.addListener=f,e.once=f,e.off=f,e.removeListener=f,e.removeAllListeners=f,e.emit=f,e.prependListener=f,e.prependOnceListener=f,e.listeners=function(e){return[]},e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,i){!function(u,p,r,f){e.exports=function r(n,a,o){function s(t,e){if(!a[t]){if(!n[t]){if(l)return l(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}i=a[t]={exports:{}};n[t][0].call(i.exports,function(e){return s(n[t][1][e]||e)},i,i.exports,r,n,a,o)}return a[t].exports}for(var l=!1,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){var u=e("./utils"),h=e("./support"),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,r,n,a,o,s=[],l=0,d=e.length,h="string"!==u.getTypeOf(e);l<e.length;)o=d-l,r=h?(t=e[l++],i=l<d?e[l++]:0,l<d?e[l++]:0):(t=e.charCodeAt(l++),i=l<d?e.charCodeAt(l++):0,l<d?e.charCodeAt(l++):0),n=(3&t)<<4|i>>4,a=1<o?(15&i)<<2|r>>6:64,o=2<o?63&r:64,s.push(c.charAt(t>>2)+c.charAt(n)+c.charAt(a)+c.charAt(o));return s.join("")},i.decode=function(e){var t,i,r,n,a,o=0,s=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var l,d=3*(e=e.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(e.charAt(e.length-1)===c.charAt(64)&&d--,e.charAt(e.length-2)===c.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(l=new(h.uint8array?Uint8Array:Array)(0|d);o<e.length;)t=c.indexOf(e.charAt(o++))<<2|(n=c.indexOf(e.charAt(o++)))>>4,i=(15&n)<<4|(n=c.indexOf(e.charAt(o++)))>>2,r=(3&n)<<6|(a=c.indexOf(e.charAt(o++))),l[s++]=t,64!==n&&(l[s++]=i),64!==a&&(l[s++]=r);return l}},{"./support":30,"./utils":32}],2:[function(e,t,i){var r=e("./external"),n=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),o=e("./stream/DataLengthProbe");function s(e,t,i,r,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=r,this.compressedContent=n}s.prototype={getContentWorker:function(){var e=new n(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new n(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,i){return e.pipe(new a).pipe(new o("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new o("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,i){var r=e("./utils"),o=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t){return void 0!==e&&e.length?("string"!==r.getTypeOf(e)?function(e,t,i){var r=o,n=0+i;e^=-1;for(var a=0;a<n;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}:function(e,t,i){var r=o,n=0+i;e^=-1;for(var a=0;a<n;a++)e=e>>>8^r[255&(e^t.charCodeAt(a))];return-1^e})(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,t,i){e="undefined"!=typeof Promise?Promise:e("lie");t.exports={Promise:e}},{lie:37}],7:[function(e,t,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako"),a=e("./utils"),o=e("./stream/GenericWorker"),s=r?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}i.magic="\b\0",a.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(s,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(e){return new l("Deflate",e)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,i){function y(e,t){for(var i="",r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function r(e,t,i,r,n,a){var o=e.file,s=e.compression,l=a!==v.utf8encode,d=w.transformTo("string",a(o.name)),h=w.transformTo("string",v.utf8encode(o.name)),u=o.comment,a=w.transformTo("string",a(u)),c=w.transformTo("string",v.utf8encode(u)),p=h.length!==o.name.length,u=c.length!==u.length,f="",m=o.dir,_=o.date,g={crc32:0,compressedSize:0,uncompressedSize:0},i=(t&&!i||(g.crc32=e.crc32,g.compressedSize=e.compressedSize,g.uncompressedSize=e.uncompressedSize),0),e=(t&&(i|=8),l||!p&&!u||(i|=2048),0),t=0,_=(m&&(e|=16),"UNIX"===n?(t=798,e|=(65535&((l=o.unixPermissions)?l:m?16893:33204))<<16):(t=20,e|=63&(o.dosPermissions||0)),n=_.getUTCHours(),n=(n=((n<<=6)|_.getUTCMinutes())<<5)|_.getUTCSeconds()/2,l=_.getUTCFullYear()-1980,l=(l=((l<<=4)|_.getUTCMonth()+1)<<5)|_.getUTCDate(),p&&(m=y(1,1)+y(b(d),4)+h,f+="up"+y(m.length,2)+m),u&&(o=y(1,1)+y(b(a),4)+c,f+="uc"+y(o.length,2)+o),""),_=(_=(_=(_=(_=(_=(_=(_=(_=(_+="\n\0")+y(i,2))+s.magic)+y(n,2))+y(l,2))+y(g.crc32,4))+y(g.compressedSize,4))+y(g.uncompressedSize,4))+y(d.length,2))+y(f.length,2);return{fileRecord:x.LOCAL_FILE_HEADER+_+d+f,dirRecord:x.CENTRAL_FILE_HEADER+y(t,2)+_+y(a.length,2)+"\0\0\0\0"+y(e,4)+y(r,4)+d+f+a}}var w=e("../utils"),n=e("../stream/GenericWorker"),v=e("../utf8"),b=e("../crc32"),x=e("../signature");function a(e,t,i,r){n.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}w.inherits(a,n),a.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,n.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-r-1))/i:100}}))},a.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;t?(e=r(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},a.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,i=r(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),t)this.push({data:(t=e,x.DATA_DESCRIPTOR+y(t.crc32,4)+y(t.compressedSize,4)+y(t.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},a.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i=this.bytesWritten-e,i=function(e,t,i,r,n){n=w.transformTo("string",n(r));return x.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(e,2)+y(e,2)+y(t,4)+y(i,4)+y(n.length,2)+n}(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},a.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},a.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},a.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},a.prototype.error=function(e){var t=this._sources;if(!n.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},a.prototype.lock=function(){n.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=a},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,i){var d=e("../compressions"),r=e("./ZipFileWorker");i.generateWorker=function(e,o,t){var s=new r(o.streamFiles,t,o.platform,o.encodeFileName),l=0;try{e.forEach(function(e,t){l++;var i=function(e,t){e=e||t,t=d[e];if(t)return t;throw new Error(e+" is not a valid compression method !")}(t.options.compression,o.compression),r=t.options.compressionOptions||o.compressionOptions||{},n=t.dir,a=t.date;t._compressWorker(i,r).withStreamInfo("file",{name:e,dir:n,date:a,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(s)}),s.entriesCount=l}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var e,t=new r;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,i){var l=e("./utils"),n=e("./external"),r=e("./utf8"),a=e("./zipEntries"),d=e("./stream/Crc32Probe"),h=e("./nodejsUtils");t.exports=function(e,o){var s=this;return o=l.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),h.isNode&&h.isStream(e)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):l.prepareContent("the loaded zip file",e,!0,o.optimizedBinaryString,o.base64).then(function(e){var t=new a(o);return t.load(e),t}).then(function(e){var t=[n.Promise.resolve(e)],i=e.files;if(o.checkCRC32)for(var r=0;r<i.length;r++)t.push(function(r){return new n.Promise(function(e,t){var i=r.decompressed.getContentWorker().pipe(new d);i.on("error",function(e){t(e)}).on("end",function(){i.streamInfo.crc32!==r.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}(i[r]));return n.Promise.all(t)}).then(function(e){for(var e=e.shift(),t=e.files,i=0;i<t.length;i++){var r=t[i],n=r.fileNameStr,a=l.resolve(r.fileNameStr);s.file(a,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:o.createFolders}),r.dir||(s.file(a).unsafeOriginalName=n)}return e.zipComment.length&&(s.comment=e.zipComment),s})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,i){var r=e("../utils"),n=e("../stream/GenericWorker");function a(e,t){n.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(a,n),a.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},a.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,i){var n=e("readable-stream").Readable;function r(e,t,i){n.call(this,t),this._helper=e;var r=this;e.on("data",function(e,t){r.push(e)||r._helper.pause(),i&&i(t)}).on("error",function(e){r.emit("error",e)}).on("end",function(){r.push(null)})}e("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,i){t.exports={isNode:void 0!==u,newBufferFrom:function(e,t){if(u.from&&u.from!==Uint8Array.from)return u.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new u(e,t)},allocBuffer:function(e){return u.alloc?u.alloc(e):((e=new u(e)).fill(0),e)},isBuffer:function(e){return u.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,i){function n(e,t,i){var r=l.getTypeOf(t),n=l.extend(i||{},u),a=(n.date=n.date||new Date,null!==n.compression&&(n.compression=n.compression.toUpperCase()),"string"==typeof n.unixPermissions&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&16384&n.unixPermissions&&(n.dir=!0),n.dosPermissions&&16&n.dosPermissions&&(n.dir=!0),n.dir&&(e=g(e)),n.createFolders&&(a=o(e))&&s.call(this,a,!0),"string"===r&&!1===n.binary&&!1===n.base64),r=(i&&void 0!==i.binary||(n.binary=!a),(t instanceof c&&0===t.uncompressedSize||n.dir||!t||0===t.length)&&(n.base64=!1,n.binary=!0,t="",n.compression="STORE"),t instanceof c||t instanceof d?t:m.isNode&&m.isStream(t)?new _(e,t):l.prepareContent(e,t,n.binary,n.optimizedBinaryString,n.base64)),i=new p(e,r,n);this.files[e]=i}function o(e){var t=(e="/"===e.slice(-1)?e.substring(0,e.length-1):e).lastIndexOf("/");return 0<t?e.substring(0,t):""}function s(e,t){return t=void 0!==t?t:u.createFolders,e=g(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}var a=e("./utf8"),l=e("./utils"),d=e("./stream/GenericWorker"),h=e("./stream/StreamHelper"),u=e("./defaults"),c=e("./compressedObject"),p=e("./zipObject"),f=e("./generate"),m=e("./nodejsUtils"),_=e("./nodejs/NodejsStreamInputAdapter"),g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e};function y(e){return"[object RegExp]"===Object.prototype.toString.call(e)}t.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,r;for(t in this.files)r=this.files[t],(i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,r)},filter:function(i){var r=[];return this.forEach(function(e,t){i(e,t)&&r.push(t)}),r},file:function(e,t,i){var r;return 1!==arguments.length?(e=this.root+e,n.call(this,e,t,i),this):y(e)?(r=e,this.filter(function(e,t){return!t.dir&&r.test(e)})):(t=this.files[this.root+e])&&!t.dir?t:null},folder:function(i){var e,t;return i?y(i)?this.filter(function(e,t){return t.dir&&i.test(e)}):(e=this.root+i,e=s.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(i){i=this.root+i;var e=this.files[i];if(e||("/"!==i.slice(-1)&&(i+="/"),e=this.files[i]),e&&!e.dir)delete this.files[i];else for(var t=this.filter(function(e,t){return t.name.slice(0,i.length)===i}),r=0;r<t.length;r++)delete this.files[t[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=l.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");l.checkSupport(t.type),"darwin"!==t.platform&&"freebsd"!==t.platform&&"linux"!==t.platform&&"sunos"!==t.platform||(t.platform="UNIX"),"win32"===t.platform&&(t.platform="DOS");var i=t.comment||this.comment||"",r=f.generateWorker(this,t,i)}catch(e){(r=new d("error")).error(e)}return new h(r,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,i){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,i){var r=e("./DataReader");function n(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(n,r),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===t&&this.data[a+1]===i&&this.data[a+2]===r&&this.data[a+3]===n)return a-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),e=e.charCodeAt(3),n=this.readData(4);return t===n[0]&&i===n[1]&&r===n[2]&&e===n[3]},n.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?[]:(t=this.data.slice(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t,i){var r=e("../utils");function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t,i){var r=e("./Uint8ArrayReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,i){var r=e("./DataReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t,i){var r=e("./ArrayReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,i){var r=e("../utils"),n=e("../support"),a=e("./ArrayReader"),o=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||n.uint8array?"nodebuffer"===t?new s(e):n.uint8array?new l(r.transformTo("uint8array",e)):new a(r.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,i){var r=e("./GenericWorker"),n=e("../utils");function a(e){r.call(this,"ConvertWorker to "+e),this.destType=e}n.inherits(a,r),a.prototype.processChunk=function(e){this.push({data:n.transformTo(this.destType,e.data),meta:e.meta})},t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,i){var r=e("./GenericWorker"),n=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(e){this.streamInfo.crc32=n(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,i){var r=e("../utils"),n=e("./GenericWorker");function a(e){n.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(a,n),a.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),n.prototype.processChunk.call(this,e)},t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,i){var r=e("../utils"),n=e("./GenericWorker");function a(e){n.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}r.inherits(a,n),a.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished)||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,i){function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){var e;return!(!this.isPaused||this.isFinished||(e=this.isPaused=!1,this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),e))},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],29:[function(e,t,i){var d=e("../utils"),n=e("./ConvertWorker"),a=e("./GenericWorker"),h=e("../base64"),r=e("../support"),o=e("../external"),s=null;if(r.nodestream)try{s=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function l(e,t,i){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=i,d.checkSupport(r),this._worker=e.pipe(new n(r)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}l.prototype={accumulate:function(e){return s=this,l=e,new o.Promise(function(t,i){var r=[],n=s._internalType,a=s._outputType,o=s._mimeType;s.on("data",function(e,t){r.push(e),l&&l(t)}).on("error",function(e){r=[],i(e)}).on("end",function(){try{var e=function(e,t,i){switch(e){case"blob":return d.newBlob(d.transformTo("arraybuffer",t),i);case"base64":return h.encode(t);default:return d.transformTo(e,t)}}(a,function(e,t){for(var i=0,r=null,n=0,a=0;a<t.length;a++)n+=t[a].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(n),a=0;a<t.length;a++)r.set(t[a],i),i+=t[a].length;return r;case"nodebuffer":return u.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(n,r),o);t(e)}catch(e){i(e)}r=[]}).resume()});var s,l},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,function(e){t.call(i,e.data,e.meta)}):this._worker.on(e,function(){d.delay(t,arguments,i)}),this},resume:function(){return d.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(d.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new s(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==u,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(r),i.blob=0===n.getBlob("application/zip").size}catch(e){i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){for(var l=e("./utils"),d=e("./support"),h=e("./nodejsUtils"),i=e("./stream/GenericWorker"),u=new Array(256),r=0;r<256;r++)u[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function a(){i.call(this,"utf-8 decode"),this.leftOver=null}function o(){i.call(this,"utf-8 encode")}u[254]=u[254]=1,n.utf8encode=function(e){if(d.nodebuffer)return h.newBufferFrom(e,"utf-8");for(var t,i,r,n,a=e,o=a.length,s=0,l=0;l<o;l++)55296==(64512&(i=a.charCodeAt(l)))&&l+1<o&&56320==(64512&(r=a.charCodeAt(l+1)))&&(i=65536+(i-55296<<10)+(r-56320),l++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new(d.uint8array?Uint8Array:Array)(s),l=n=0;n<s;l++)55296==(64512&(i=a.charCodeAt(l)))&&l+1<o&&56320==(64512&(r=a.charCodeAt(l+1)))&&(i=65536+(i-55296<<10)+(r-56320),l++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},n.utf8decode=function(e){if(d.nodebuffer)return l.transformTo("nodebuffer",e).toString("utf-8");for(var t,i,r,n=e=l.transformTo(d.uint8array?"uint8array":"array",e),a=n.length,o=new Array(2*a),s=t=0;s<a;)if((i=n[s++])<128)o[t++]=i;else if(4<(r=u[i]))o[t++]=65533,s+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&s<a;)i=i<<6|63&n[s++],r--;1<r?o[t++]=65533:i<65536?o[t++]=i:(i-=65536,o[t++]=55296|i>>10&1023,o[t++]=56320|1023&i)}return o.length!==t&&(o.subarray?o=o.subarray(0,t):o.length=t),l.applyFromCharCode(o)},l.inherits(a,i),a.prototype.processChunk=function(e){var t=l.transformTo(d.uint8array?"uint8array":"array",e.data),i=(this.leftOver&&this.leftOver.length&&(d.uint8array?(i=t,(t=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),t.set(i,this.leftOver.length)):t=this.leftOver.concat(t),this.leftOver=null),function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+u[e[i]]>t?i:t}(t)),r=t;i!==t.length&&(d.uint8array?(r=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(r=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:n.utf8decode(r),meta:e.meta})},a.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=a,l.inherits(o,i),o.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=o},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,o){var s=e("./support"),l=e("./base64"),i=e("./nodejsUtils"),d=e("./external");function r(e){return e}function h(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}e("setimmediate"),o.newBlob=function(t,i){o.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var n={stringifyByChunk:function(e,t,i){var r=[],n=0,a=e.length;if(a<=i)return String.fromCharCode.apply(null,e);for(;n<a;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(n,Math.min(n+i,a))):String.fromCharCode.apply(null,e.subarray(n,Math.min(n+i,a)))),n+=i;return r.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&1===String.fromCharCode.apply(null,i.allocBuffer(1)).length}catch(e){return!1}}()}};function a(e){var t=65536,i=o.getTypeOf(e),r=!0;if("uint8array"===i?r=n.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=n.applyCanBeUsed.nodebuffer),r)for(;1<t;)try{return n.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return n.stringifyByChar(e)}function u(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}o.applyFromCharCode=a;var c={};c.string={string:r,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return c.string.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:function(e){return h(e,i.allocBuffer(e.length))}},c.array={string:a,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(e)}},c.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return u(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(new Uint8Array(e))}},c.uint8array={string:a,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return i.newBufferFrom(e)}},c.nodebuffer={string:a,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return c.nodebuffer.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:r},o.transformTo=function(e,t){if(t=t||"",!e)return t;o.checkSupport(e);var i=o.getTypeOf(t);return c[i][e](t)},o.resolve=function(e){for(var t=e.split("/"),i=[],r=0;r<t.length;r++){var n=t[r];"."===n||""===n&&0!==r&&r!==t.length-1||(".."===n?i.pop():i.push(n))}return i.join("/")},o.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":s.nodebuffer&&i.isBuffer(e)?"nodebuffer":s.uint8array&&e instanceof Uint8Array?"uint8array":s.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(e){if(!s[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(e){for(var t,i="",r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},o.delay=function(e,t,i){p(function(){e.apply(i||null,t||[])})},o.inherits=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i},o.extend=function(){for(var e,t={},i=0;i<arguments.length;i++)for(e in arguments[i])Object.prototype.hasOwnProperty.call(arguments[i],e)&&void 0===t[e]&&(t[e]=arguments[i][e]);return t},o.prepareContent=function(i,e,r,n,a){return d.Promise.resolve(e).then(function(r){return s.blob&&(r instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(r)))&&"undefined"!=typeof FileReader?new d.Promise(function(t,i){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){i(e.target.error)},e.readAsArrayBuffer(r)}):r}).then(function(e){var t=o.getTypeOf(e);return t?("arraybuffer"===t?e=o.transformTo("uint8array",e):"string"===t&&(a?e=l.decode(e):r&&!0!==n&&(e=h(t=e,new(s.uint8array?Uint8Array:Array)(t.length)))),e):d.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,i){var r=e("./reader/readerFor"),n=e("./utils"),a=e("./signature"),o=e("./zipEntry"),s=e("./support");function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){var t;if(!this.reader.readAndCheckSignature(e))throw this.reader.index-=4,t=this.reader.readString(4),new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(t)+", expected "+n.pretty(e)+")")},isSignature:function(e,t){var i=this.reader.index,e=(this.reader.setIndex(e),this.reader.readString(4)===t);return this.reader.setIndex(i),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",t=n.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}e=this.centralDirOffset+this.centralDirSize,e=t-(e=this.zip64?e+20+(12+this.zip64EndOfCentralSize):e);if(0<e)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,i){var r=e("./reader/readerFor"),n=e("./utils"),a=e("./compressedObject"),o=e("./crc32"),s=e("./utf8"),l=e("./compressions"),d=e("./support");function h(e,t){this.options=e,this.loadOptions=t}h.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(t),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(Object.prototype.hasOwnProperty.call(l,t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){var e;this.extraFields[1]&&(e=r(this.extraFields[1].value),this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS)&&(this.diskNumberStart=e.readInt(4))},readExtraFields:function(e){var t,i,r,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<n;)t=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[t]={id:t,length:i,value:r};e.setIndex(n)},handleUTF8:function(){var e,t=d.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(e=n.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(e)),null!==(e=this.findExtraFieldUnicodeComment())?this.fileCommentStr=e:(e=n.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(e)))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=r(t.value)).readInt(1)||o(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return!t||1!==(e=r(t.value)).readInt(1)||o(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}},t.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,i){function r(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var a=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),o=e("./utf8"),s=e("./compressedObject"),l=e("./stream/GenericWorker");r.prototype={internalStream:function(e){var t=null,i="string";try{if(!e)throw new Error("No output type specified.");var r="string"===(i=e.toLowerCase())||"text"===i,n=("binarystring"!==i&&"text"!==i||(i="string"),t=this._decompressWorker(),!this._dataBinary);n&&!r&&(t=t.pipe(new o.Utf8EncodeWorker)),!n&&r&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new a(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){var i;return this._data instanceof s&&this._data.compression.magic===e.magic?this._data.getCompressedWorker():(i=this._decompressWorker(),this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),s.createWorkerFrom(i,e,t))},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof l?this._data:new n(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<d.length;u++)r.prototype[d[u]]=h;t.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,d,t){!function(t){var r,e,i,n,a=t.MutationObserver||t.WebKitMutationObserver,o=a?(e=0,a=new a(l),i=t.document.createTextNode(""),a.observe(i,{characterData:!0}),function(){i.data=e=++e%2}):t.setImmediate||void 0===t.MessageChannel?"document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)}:((n=new t.MessageChannel).port1.onmessage=l,function(){n.port2.postMessage(0)}),s=[];function l(){var e,t;r=!0;for(var i=s.length;i;){for(t=s,s=[],e=-1;++e<i;)t[e]();i=s.length}r=!1}d.exports=function(e){1!==s.push(e)||r||o()}}.call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,i){var n=e("immediate");function l(){}var d={},a=["REJECTED"],o=["FULFILLED"],r=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=r,this.queue=[],this.outcome=void 0,e!==l&&p(this,e)}function h(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function u(t,i,r){n(function(){var e;try{e=i(r)}catch(e){return d.reject(t,e)}e===t?d.reject(t,new TypeError("Cannot resolve promise with itself")):d.resolve(t,e)})}function c(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(t,e){var i=!1;function r(e){i||(i=!0,d.reject(t,e))}function n(e){i||(i=!0,d.resolve(t,e))}var a=f(function(){e(n,r)});"error"===a.status&&r(a.value)}function f(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}(t.exports=s).prototype.finally=function(t){var i;return"function"!=typeof t?this:(i=this.constructor,this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})}))},s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var i;return"function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===a?this:(i=new this.constructor(l),this.state!==r?u(i,this.state===o?e:t,this.outcome):this.queue.push(new h(i,e,t)),i)},h.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},h.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},h.prototype.callRejected=function(e){d.reject(this.promise,e)},h.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},d.resolve=function(e,t){var i=f(c,t);if("error"===i.status)return d.reject(e,i.value);i=i.value;if(i)p(e,i);else{e.state=o,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callFulfilled(t)}return e},d.reject=function(e,t){e.state=a,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callRejected(t);return e},s.resolve=function(e){return e instanceof this?e:d.resolve(new this(l),e)},s.reject=function(e){var t=new this(l);return d.reject(t,e)},s.all=function(e){var i=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),o=0,t=-1,s=new this(l);++t<r;)!function(e,t){i.resolve(e).then(function(e){a[t]=e,++o!==r||n||(n=!0,d.resolve(s,a))},function(e){n||(n=!0,d.reject(s,e))})}(e[t],t);return s},s.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,i=!1;if(!t)return this.resolve([]);for(var r,n=-1,a=new this(l);++n<t;)r=e[n],this.resolve(r).then(function(e){i||(i=!0,d.resolve(a,e))},function(e){i||(i=!0,d.reject(a,e))});return a}},{immediate:36}],38:[function(e,t,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,i){var o=e("./zlib/deflate"),s=e("./utils/common"),l=e("./utils/strings"),r=e("./zlib/messages"),n=e("./zlib/zstream"),d=Object.prototype.toString;function a(e){if(!(this instanceof a))return new a(e);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var e=this.options,t=(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,o.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy));if(0!==t)throw new Error(r[t]);if(e.header&&o.deflateSetHeader(this.strm,e.header),e.dictionary){e="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===d.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=o.deflateSetDictionary(this.strm,e)))throw new Error(r[t]);this._dict_set=!0}}function h(e,t){t=new a(t);if(t.push(e,!0),t.err)throw t.msg||r[t.err];return t.result}a.prototype.push=function(e,t){var i,r,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=l.string2buf(e):"[object ArrayBuffer]"===d.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(a),n.next_out=0,n.avail_out=a),1!==(i=o.deflate(n,r))&&0!==i)return this.onEnd(i),!(this.ended=!0)}while(0!==n.avail_out&&(0!==n.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(l.buf2binstring(s.shrinkBuf(n.output,n.next_out))):this.onData(s.shrinkBuf(n.output,n.next_out))),(0<n.avail_in||0===n.avail_out)&&1!==i);return 4===r?(i=o.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==r||(this.onEnd(0),!(n.avail_out=0))},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=a,i.deflate=h,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,h(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,h(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,i){var u=e("./zlib/inflate"),c=e("./utils/common"),p=e("./utils/strings"),f=e("./zlib/constants"),r=e("./zlib/messages"),n=e("./zlib/zstream"),a=e("./zlib/gzheader"),m=Object.prototype.toString;function o(e){if(!(this instanceof o))return new o(e);this.options=c.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,u.inflateInit2(this.strm,t.windowBits));if(e!==f.Z_OK)throw new Error(r[e]);this.header=new a,u.inflateGetHeader(this.strm,this.header)}function s(e,t){t=new o(t);if(t.push(e,!0),t.err)throw t.msg||r[t.err];return t.result}o.prototype.push=function(e,t){var i,r,n,a,o,s=this.strm,l=this.options.chunkSize,d=this.options.dictionary,h=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof e?s.input=p.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new c.Buf8(l),s.next_out=0,s.avail_out=l),(i=u.inflate(s,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&d&&(o="string"==typeof d?p.string2buf(d):"[object ArrayBuffer]"===m.call(d)?new Uint8Array(d):d,i=u.inflateSetDictionary(this.strm,o)),i===f.Z_BUF_ERROR&&!0===h&&(i=f.Z_OK,h=!1),i!==f.Z_STREAM_END&&i!==f.Z_OK)return this.onEnd(i),!(this.ended=!0)}while(!s.next_out||0!==s.avail_out&&i!==f.Z_STREAM_END&&(0!==s.avail_in||r!==f.Z_FINISH&&r!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(o=p.utf8border(s.output,s.next_out),n=s.next_out-o,a=p.buf2string(s.output,o),s.next_out=n,s.avail_out=l-n,n&&c.arraySet(s.output,s.output,o,n,0),this.onData(a)):this.onData(c.shrinkBuf(s.output,s.next_out))),0===s.avail_in&&0===s.avail_out&&(h=!0),(0<s.avail_in||0===s.avail_out)&&i!==f.Z_STREAM_END);return(r=i===f.Z_STREAM_END?f.Z_FINISH:r)===f.Z_FINISH?(i=u.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===f.Z_OK):r!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(s.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){e===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=c.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=o,i.inflate=s,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},i.ungzip=s},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,n=(i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)},{arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var a=0;a<r;a++)e[n+a]=t[i+a]},flattenChunks:function(e){for(var t,i,r,n,a=t=0,o=e.length;a<o;a++)t+=e[a].length;for(n=new Uint8Array(t),a=i=0,o=e.length;a<o;a++)r=e[a],n.set(r,i),i+=r.length;return n}}),a={arraySet:function(e,t,i,r,n){for(var a=0;a<r;a++)e[n+a]=t[i+a]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],42:[function(e,t,i){var l=e("./common"),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var d=new l.Buf8(256),r=0;r<256;r++)d[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function h(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}d[254]=d[254]=1,i.string2buf=function(e){for(var t,i,r,n,a=e.length,o=0,s=0;s<a;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new l.Buf8(o),s=n=0;n<o;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<a&&56320==(64512&(r=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(r-56320),s++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},i.buf2binstring=function(e){return h(e,e.length)},i.binstring2buf=function(e){for(var t=new l.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){for(var i,r,n,a=t||e.length,o=new Array(2*a),s=i=0;s<a;)if((r=e[s++])<128)o[i++]=r;else if(4<(n=d[r]))o[i++]=65533,s+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&s<a;)r=r<<6|63&e[s++],n--;1<n?o[i++]=65533:r<65536?o[i++]=r:(r-=65536,o[i++]=55296|r>>10&1023,o[i++]=56320|1023&r)}return h(o,i)},i.utf8border=function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+d[e[i]]>t?i:t}},{"./common":41}],43:[function(e,t,i){t.exports=function(e,t,i,r){for(var n=65535&e|0,a=e>>>16&65535|0,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;a=a+(n=n+t[r++]|0)|0,--o;);n%=65521,a%=65521}return n|a<<16|0}},{}],44:[function(e,t,i){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,i){var s=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t,i,r){var n=s,a=r+i;e^=-1;for(var o=r;o<a;o++)e=e>>>8^n[255&(e^t[o])];return-1^e}},{}],46:[function(e,L,t){var s,u=e("../utils/common"),l=e("./trees"),c=e("./adler32"),p=e("./crc32"),i=e("./messages"),d=0,h=0,f=-2,r=2,m=8,n=286,a=30,o=19,N=2*n+1,V=15,_=3,g=258,y=g+_+1,w=42,v=113;function b(e,t){return e.msg=i[t],t}function x(e){return(e<<1)-(4<e?9:0)}function T(e){for(var t=e.length;0<=--t;)e[t]=0}function A(e){var t=e.state,i=t.pending;0!==(i=i>e.avail_out?e.avail_out:i)&&(u.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending)&&(t.pending_out=0)}function M(e,t){l._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,A(e.strm)}function S(e,t){e.pending_buf[e.pending++]=t}function E(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var i,r,n=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-y?e.strstart-(e.w_size-y):0,d=e.window,h=e.w_mask,u=e.prev,c=e.strstart+g,p=d[a+o-1],f=d[a+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(i=t)+o]===f&&d[i+o-1]===p&&d[i]===d[a]&&d[++i]===d[a+1]){for(a+=2,i++;d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&a<c;);if(r=g-(c-a),a=c-g,o<r){if(e.match_start=t,s<=(o=r))break;p=d[a+o-1],f=d[a+o]}}}while((t=u[t&h])>l&&0!=--n);return o<=e.lookahead?o:e.lookahead}function k(e){var t,i,r,n,a,o,s,l,d,h=e.w_size;do{if(l=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-y)){for(u.arraySet(e.window,e.window,h,h,0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=i=e.hash_size;r=e.head[--t],e.head[t]=h<=r?r-h:0,--i;);for(t=i=h;r=e.prev[--t],e.prev[t]=h<=r?r-h:0,--i;);l+=h}if(0===e.strm.avail_in)break;if(a=e.strm,o=e.window,s=e.strstart+e.lookahead,d=void 0,i=0===(d=(l=l)<(d=a.avail_in)?l:d)?0:(a.avail_in-=d,u.arraySet(o,a.input,a.next_in,d,s),1===a.state.wrap?a.adler=c(a.adler,o,d,s):2===a.state.wrap&&(a.adler=p(a.adler,o,d,s)),a.next_in+=d,a.total_in+=d,d),e.lookahead+=i,e.lookahead+e.insert>=_)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+_-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<_)););}while(e.lookahead<y&&0!==e.strm.avail_in)}function B(e,t){for(var i,r;;){if(e.lookahead<y){if(k(e),e.lookahead<y&&t===d)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-y&&(e.match_length=I(e,i)),e.match_length>=_)if(r=l._tr_tally(e,e.strstart-e.match_start,e.match_length-_),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(M(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<_-1?e.strstart:_-1,4===t?(M(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?1:2}function D(e,t){for(var i,r,n;;){if(e.lookahead<y){if(k(e),e.lookahead<y&&t===d)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-y&&(e.match_length=I(e,i),e.match_length<=5)&&(1===e.strategy||e.match_length===_&&4096<e.strstart-e.match_start)&&(e.match_length=_-1),e.prev_length>=_&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-_,r=l._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-_),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=_-1,e.strstart++,r&&(M(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=l._tr_tally(e,0,e.window[e.strstart-1]))&&M(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=l._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<_-1?e.strstart:_-1,4===t?(M(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?1:2}function C(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*N),this.dyn_dtree=new u.Buf16(2*(2*a+1)),this.bl_tree=new u.Buf16(2*(2*o+1)),T(this.dyn_ltree),T(this.dyn_dtree),T(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(V+1),this.heap=new u.Buf16(2*n+1),T(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*n+1),T(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function O(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=r,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?w:v,e.adler=2===t.wrap?0:1,t.last_flush=d,l._tr_init(t),h):b(e,f)}function R(e){var t=O(e);return t===h&&((e=e.state).window_size=2*e.w_size,T(e.head),e.max_lazy_match=s[e.level].max_lazy,e.good_match=s[e.level].good_length,e.nice_match=s[e.level].nice_length,e.max_chain_length=s[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=_-1,e.match_available=0,e.ins_h=0),t}function P(e,t,i,r,n,a){if(!e)return f;var o=1;if(-1===t&&(t=6),r<0?(o=0,r=-r):15<r&&(o=2,r-=16),n<1||9<n||i!==m||r<8||15<r||t<0||9<t||a<0||4<a)return b(e,f);8===r&&(r=9);var s=new W;return(e.state=s).strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+_-1)/_),s.window=new u.Buf8(2*s.w_size),s.head=new u.Buf16(s.hash_size),s.prev=new u.Buf16(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new u.Buf8(s.pending_buf_size),s.d_buf=+s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=i,R(e)}s=[new C(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(k(e),0===e.lookahead&&t===d)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,M(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-y&&(M(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(M(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(M(e,!1),e.strm.avail_out),1)}),new C(4,4,8,4,B),new C(4,5,16,8,B),new C(4,6,32,32,B),new C(4,4,16,16,D),new C(8,16,32,32,D),new C(8,16,128,128,D),new C(8,32,128,256,D),new C(32,128,258,1024,D),new C(32,258,258,4096,D)],t.deflateInit=function(e,t){return P(e,t,m,15,8,0)},t.deflateInit2=P,t.deflateReset=R,t.deflateResetKeep=O,t.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?f:(e.state.gzhead=t,h)},t.deflate=function(e,t){var i,r,n,a;if(!e||!e.state||5<t||t<0)return e?b(e,f):f;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return b(e,0===e.avail_out?-5:f);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===w&&(2===r.wrap?(e.adler=0,S(r,31),S(r,139),S(r,8),r.gzhead?(S(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),S(r,255&r.gzhead.time),S(r,r.gzhead.time>>8&255),S(r,r.gzhead.time>>16&255),S(r,r.gzhead.time>>24&255),S(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),S(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(S(r,255&r.gzhead.extra.length),S(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=p(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(S(r,0),S(r,0),S(r,0),S(r,0),S(r,0),S(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),S(r,3),r.status=v)):(o=m+(r.w_bits-8<<4)<<8,o|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(o|=32),o+=31-o%31,r.status=v,E(r,o),0!==r.strstart&&(E(r,e.adler>>>16),E(r,65535&e.adler)),e.adler=1)),69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),A(e),n=r.pending,r.pending!==r.pending_buf_size));)S(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),A(e),n=r.pending,r.pending===r.pending_buf_size)){a=1;break}}while(a=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,S(r,a),0!==a);r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),0===a&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),A(e),n=r.pending,r.pending===r.pending_buf_size)){a=1;break}}while(a=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,S(r,a),0!==a);r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),0===a&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&A(e),r.pending+2<=r.pending_buf_size&&(S(r,255&e.adler),S(r,e.adler>>8&255),e.adler=0,r.status=v)):r.status=v),0!==r.pending){if(A(e),0===e.avail_out)return r.last_flush=-1,h}else if(0===e.avail_in&&x(t)<=x(i)&&4!==t)return b(e,-5);if(666===r.status&&0!==e.avail_in)return b(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==d&&666!==r.status){var o=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(k(e),0===e.lookahead)){if(t===d)return 1;break}if(e.match_length=0,i=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(M(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(M(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var i,r,n,a,o=e.window;;){if(e.lookahead<=g){if(k(e),e.lookahead<=g&&t===d)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=_&&0<e.strstart&&(r=o[n=e.strstart-1])===o[++n]&&r===o[++n]&&r===o[++n]){for(a=e.strstart+g;r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a;);e.match_length=g-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_?(i=l._tr_tally(e,1,e.match_length-_),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(M(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(M(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(M(e,!1),0===e.strm.avail_out)?1:2}(r,t):s[r.level].func(r,t);if(3!==o&&4!==o||(r.status=666),1===o||3===o)return 0===e.avail_out&&(r.last_flush=-1),h;if(2===o&&(1===t?l._tr_align(r):5!==t&&(l._tr_stored_block(r,0,0,!1),3===t)&&(T(r.head),0===r.lookahead)&&(r.strstart=0,r.block_start=0,r.insert=0),A(e),0===e.avail_out))return r.last_flush=-1,h}return 4!==t||!(r.wrap<=0)&&(2===r.wrap?(S(r,255&e.adler),S(r,e.adler>>8&255),S(r,e.adler>>16&255),S(r,e.adler>>24&255),S(r,255&e.total_in),S(r,e.total_in>>8&255),S(r,e.total_in>>16&255),S(r,e.total_in>>24&255)):(E(r,e.adler>>>16),E(r,65535&e.adler)),A(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending)?h:1},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==w&&69!==t&&73!==t&&91!==t&&103!==t&&t!==v&&666!==t?b(e,f):(e.state=null,t===v?b(e,-3):h):f},t.deflateSetDictionary=function(e,t){var i,r,n,a,o,s,l,d=t.length;if(!e||!e.state)return f;if(2===(a=(i=e.state).wrap)||1===a&&i.status!==w||i.lookahead)return f;for(1===a&&(e.adler=c(e.adler,t,d,0)),i.wrap=0,d>=i.w_size&&(0===a&&(T(i.head),i.strstart=0,i.block_start=0,i.insert=0),l=new u.Buf8(i.w_size),u.arraySet(l,t,d-i.w_size,i.w_size,0),t=l,d=i.w_size),l=e.avail_in,o=e.next_in,s=e.input,e.avail_in=d,e.next_in=0,e.input=t,k(i);i.lookahead>=_;){for(r=i.strstart,n=i.lookahead-(_-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+_-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,--n;);i.strstart=r,i.lookahead=_-1,k(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=_-1,i.match_available=0,e.next_in=o,e.input=s,e.avail_in=l,i.wrap=a,h},t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,i){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,i){t.exports=function(e,t){var i,r,n,a,o,s,l=e.state,d=e.next_in,h=e.input,u=d+(e.avail_in-5),c=e.next_out,p=e.output,f=c-(t-e.avail_out),m=c+(e.avail_out-257),_=l.dmax,g=l.wsize,y=l.whave,w=l.wnext,v=l.window,b=l.hold,x=l.bits,T=l.lencode,A=l.distcode,M=(1<<l.lenbits)-1,S=(1<<l.distbits)-1;e:do{for(x<15&&(b+=h[d++]<<x,x+=8,b+=h[d++]<<x,x+=8),i=T[b&M];;){if(b>>>=r=i>>>24,x-=r,0==(r=i>>>16&255))p[c++]=65535&i;else{if(!(16&r)){if(0==(64&r)){i=T[(65535&i)+(b&(1<<r)-1)];continue}if(32&r){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}for(n=65535&i,(r&=15)&&(x<r&&(b+=h[d++]<<x,x+=8),n+=b&(1<<r)-1,b>>>=r,x-=r),x<15&&(b+=h[d++]<<x,x+=8,b+=h[d++]<<x,x+=8),i=A[b&S];;){if(b>>>=r=i>>>24,x-=r,!(16&(r=i>>>16&255))){if(0==(64&r)){i=A[(65535&i)+(b&(1<<r)-1)];continue}e.msg="invalid distance code",l.mode=30;break e}if(a=65535&i,x<(r&=15)&&(b+=h[d++]<<x,(x+=8)<r)&&(b+=h[d++]<<x,x+=8),_<(a+=b&(1<<r)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(b>>>=r,x-=r,(r=c-f)<a){if(y<(r=a-r)&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(s=v,(o=0)===w){if(o+=g-r,r<n){for(n-=r;p[c++]=v[o++],--r;);o=c-a,s=p}}else if(w<r){if(o+=g+w-r,(r-=w)<n){for(n-=r;p[c++]=v[o++],--r;);if(o=0,w<n){for(n-=r=w;p[c++]=v[o++],--r;);o=c-a,s=p}}}else if(o+=w-r,r<n){for(n-=r;p[c++]=v[o++],--r;);o=c-a,s=p}for(;2<n;)p[c++]=s[o++],p[c++]=s[o++],p[c++]=s[o++],n-=3;n&&(p[c++]=s[o++],1<n)&&(p[c++]=s[o++])}else{for(o=c-a;p[c++]=p[o++],p[c++]=p[o++],p[c++]=p[o++],2<(n-=3););n&&(p[c++]=p[o++],1<n)&&(p[c++]=p[o++])}break}}break}}while(d<u&&c<m);d-=n=x>>3,b&=(1<<(x-=n<<3))-1,e.next_in=d,e.next_out=c,e.avail_in=d<u?u-d+5:5-(d-u),e.avail_out=c<m?m-c+257:257-(c-m),l.hold=b,l.bits=x}},{}],49:[function(e,t,i){var D=e("../utils/common"),C=e("./adler32"),O=e("./crc32"),R=e("./inffast"),P=e("./inftrees"),L=0,N=-2,V=1,r=852,n=592;function W(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new D.Buf16(320),this.work=new D.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=V,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new D.Buf32(r),t.distcode=t.distdyn=new D.Buf32(n),t.sane=1,t.back=-1,L):N}function s(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,o(e)):N}function l(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?N:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,s(e))}function d(e,t){var i;return e?(i=new a,(e.state=i).window=null,(i=l(e,t))!==L&&(e.state=null),i):N}var F,z,H=!0;function U(e,t,i,r){var n,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new D.Buf8(e.wsize)),r>=e.wsize?(D.arraySet(e.window,t,i-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(r<(n=e.wsize-e.wnext)&&(n=r),D.arraySet(e.window,t,i-r,n,e.wnext),(r-=n)?(D.arraySet(e.window,t,i-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=n,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=n))),0}i.inflateReset=s,i.inflateReset2=l,i.inflateResetKeep=o,i.inflateInit=function(e){return d(e,15)},i.inflateInit2=d,i.inflate=function(e,t){var i,r,n,a,o,s,l,d,h,u,c,p,f,m,_,g,y,w,v,b,x,T,A,M,S=0,E=new D.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return N;12===(i=e.state).mode&&(i.mode=13),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,d=i.hold,h=i.bits,u=s,c=l,T=L;e:for(;;)switch(i.mode){case V:if(0===i.wrap)i.mode=13;else{for(;h<16;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(2&i.wrap&&35615===d)E[i.check=0]=255&d,E[1]=d>>>8&255,i.check=O(i.check,E,2,0),h=d=0,i.mode=2;else if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&d)<<8)+(d>>8))%31)e.msg="incorrect header check",i.mode=30;else if(8!=(15&d))e.msg="unknown compression method",i.mode=30;else{if(h-=4,x=8+(15&(d>>>=4)),0===i.wbits)i.wbits=x;else if(x>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<x,e.adler=i.check=1,i.mode=512&d?10:12,h=d=0}}break;case 2:for(;h<16;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(i.flags=d,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=d>>8&1),512&i.flags&&(E[0]=255&d,E[1]=d>>>8&255,i.check=O(i.check,E,2,0)),h=d=0,i.mode=3;case 3:for(;h<32;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.head&&(i.head.time=d),512&i.flags&&(E[0]=255&d,E[1]=d>>>8&255,E[2]=d>>>16&255,E[3]=d>>>24&255,i.check=O(i.check,E,4,0)),h=d=0,i.mode=4;case 4:for(;h<16;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.head&&(i.head.xflags=255&d,i.head.os=d>>8),512&i.flags&&(E[0]=255&d,E[1]=d>>>8&255,i.check=O(i.check,E,2,0)),h=d=0,i.mode=5;case 5:if(1024&i.flags){for(;h<16;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.length=d,i.head&&(i.head.extra_len=d),512&i.flags&&(E[0]=255&d,E[1]=d>>>8&255,i.check=O(i.check,E,2,0)),h=d=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((p=s<(p=i.length)?s:p)&&(i.head&&(x=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),D.arraySet(i.head.extra,r,a,p,x)),512&i.flags&&(i.check=O(i.check,r,p,a)),s-=p,a+=p,i.length-=p),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===s)break e;for(p=0;x=r[a+p++],i.head&&x&&i.length<65536&&(i.head.name+=String.fromCharCode(x)),x&&p<s;);if(512&i.flags&&(i.check=O(i.check,r,p,a)),s-=p,a+=p,x)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===s)break e;for(p=0;x=r[a+p++],i.head&&x&&i.length<65536&&(i.head.comment+=String.fromCharCode(x)),x&&p<s;);if(512&i.flags&&(i.check=O(i.check,r,p,a)),s-=p,a+=p,x)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;h<16;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(d!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}h=d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;h<32;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}e.adler=i.check=W(d),h=d=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=d,i.bits=h,2;e.adler=i.check=1,i.mode=12;case 12:if(5===t||6===t)break e;case 13:if(i.last)d>>>=7&h,h-=7&h,i.mode=27;else{for(;h<3;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}switch(i.last=1&d,--h,3&(d>>>=1)){case 0:i.mode=14;break;case 1:k=B=void 0;var k,B=i;if(H){for(F=new D.Buf32(512),z=new D.Buf32(32),k=0;k<144;)B.lens[k++]=8;for(;k<256;)B.lens[k++]=9;for(;k<280;)B.lens[k++]=7;for(;k<288;)B.lens[k++]=8;for(P(1,B.lens,0,288,F,0,B.work,{bits:9}),k=0;k<32;)B.lens[k++]=5;P(2,B.lens,0,32,z,0,B.work,{bits:5}),H=!1}if(B.lencode=F,B.lenbits=9,B.distcode=z,B.distbits=5,i.mode=20,6!==t)break;d>>>=2,h-=2;break e;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}d>>>=2,h-=2}break;case 14:for(d>>>=7&h,h-=7&h;h<32;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&d,h=d=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(p=i.length){if(0===(p=l<(p=s<p?s:p)?l:p))break e;D.arraySet(n,r,a,p,o),s-=p,a+=p,l-=p,o+=p,i.length-=p}else i.mode=12;break;case 17:for(;h<14;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(i.nlen=257+(31&d),d>>>=5,h-=5,i.ndist=1+(31&d),d>>>=5,h-=5,i.ncode=4+(15&d),d>>>=4,h-=4,286<i.nlen||30<i.ndist){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;h<3;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.lens[I[i.have++]]=7&d,d>>>=3,h-=3}for(;i.have<19;)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,A={bits:i.lenbits},T=P(0,i.lens,0,19,i.lencode,0,i.work,A),i.lenbits=A.bits,T){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;g=(S=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,y=65535&S,!((_=S>>>24)<=h);){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(y<16)d>>>=_,h-=_,i.lens[i.have++]=y;else{if(16===y){for(M=_+2;h<M;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(d>>>=_,h-=_,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}x=i.lens[i.have-1],p=3+(3&d),d>>>=2,h-=2}else if(17===y){for(M=_+3;h<M;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}x=0,p=3+(7&(d>>>=_)),d>>>=3,h=h-_-3}else{for(M=_+7;h<M;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}x=0,p=11+(127&(d>>>=_)),d>>>=7,h=h-_-7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;p--;)i.lens[i.have++]=x}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,A={bits:i.lenbits},T=P(1,i.lens,0,i.nlen,i.lencode,0,i.work,A),i.lenbits=A.bits,T){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,A={bits:i.distbits},T=P(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,A),i.distbits=A.bits,T){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(6<=s&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=d,i.bits=h,R(e,c),o=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,d=i.hold,h=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;g=(S=i.lencode[d&(1<<i.lenbits)-1])>>>16&255,y=65535&S,!((_=S>>>24)<=h);){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(g&&0==(240&g)){for(w=_,v=g,b=y;g=(S=i.lencode[b+((d&(1<<w+v)-1)>>w)])>>>16&255,y=65535&S,!(w+(_=S>>>24)<=h);){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}d>>>=w,h-=w,i.back+=w}if(d>>>=_,h-=_,i.back+=_,i.length=y,0===g){i.mode=26;break}if(32&g){i.back=-1,i.mode=12;break}if(64&g){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&g,i.mode=22;case 22:if(i.extra){for(M=i.extra;h<M;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.length+=d&(1<<i.extra)-1,d>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;g=(S=i.distcode[d&(1<<i.distbits)-1])>>>16&255,y=65535&S,!((_=S>>>24)<=h);){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(0==(240&g)){for(w=_,v=g,b=y;g=(S=i.distcode[b+((d&(1<<w+v)-1)>>w)])>>>16&255,y=65535&S,!(w+(_=S>>>24)<=h);){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}d>>>=w,h-=w,i.back+=w}if(d>>>=_,h-=_,i.back+=_,64&g){e.msg="invalid distance code",i.mode=30;break}i.offset=y,i.extra=15&g,i.mode=24;case 24:if(i.extra){for(M=i.extra;h<M;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}i.offset+=d&(1<<i.extra)-1,d>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===l)break e;if(i.offset>(p=c-l)){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}f=p>i.wnext?(p-=i.wnext,i.wsize-p):i.wnext-p,p>i.length&&(p=i.length),m=i.window}else m=n,f=o-i.offset,p=i.length;for(l-=p=l<p?l:p,i.length-=p;n[o++]=m[f++],--p;);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;n[o++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;h<32;){if(0===s)break e;s--,d|=r[a++]<<h,h+=8}if(c-=l,e.total_out+=c,i.total+=c,c&&(e.adler=i.check=(i.flags?O:C)(i.check,n,c,o-c)),c=l,(i.flags?d:W(d))!==i.check){e.msg="incorrect data check",i.mode=30;break}h=d=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;h<32;){if(0===s)break e;s--,d+=r[a++]<<h,h+=8}if(d!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}h=d=0}i.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return-4;default:return N}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,i.hold=d,i.bits=h,(i.wsize||c!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&U(e,e.output,e.next_out,c-e.avail_out)?(i.mode=31,-4):(u-=e.avail_in,c-=e.avail_out,e.total_in+=u,e.total_out+=c,i.total+=c,i.wrap&&c&&(e.adler=i.check=(i.flags?O:C)(i.check,n,c,e.next_out-c)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),T=(0==u&&0===c||4===t)&&T===L?-5:T)},i.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,L):N},i.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?N:((e.head=t).done=!1,L)},i.inflateSetDictionary=function(e,t){var i,r=t.length;return!e||!e.state||0!==(i=e.state).wrap&&11!==i.mode?N:11===i.mode&&C(1,t,r,0)!==i.check?-3:U(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,L)},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,i){var R=e("../utils/common"),P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],N=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],V=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,r,n,a,o,s){for(var l,d,h,u,c,p,f,m,_,g=s.bits,y=0,w=0,v=0,b=0,x=0,T=0,A=0,M=0,S=0,E=0,I=null,k=0,B=new R.Buf16(16),D=new R.Buf16(16),C=null,O=0,y=0;y<=15;y++)B[y]=0;for(w=0;w<r;w++)B[t[i+w]]++;for(x=g,b=15;1<=b&&0===B[b];b--);if(b<x&&(x=b),0===b)n[a++]=20971520,n[a++]=20971520,s.bits=1;else{for(v=1;v<b&&0===B[v];v++);for(x<v&&(x=v),y=M=1;y<=15;y++)if((M=(M<<1)-B[y])<0)return-1;if(0<M&&(0===e||1!==b))return-1;for(D[1]=0,y=1;y<15;y++)D[y+1]=D[y]+B[y];for(w=0;w<r;w++)0!==t[i+w]&&(o[D[t[i+w]]++]=w);if(p=0===e?(I=C=o,19):1===e?(I=P,k-=257,C=L,O-=257,256):(I=N,C=V,-1),y=v,c=a,A=w=E=0,h=-1,u=(S=1<<(T=x))-1,1===e&&852<S||2===e&&592<S)return 1;for(;;){for(_=o[w]<p?(m=0,o[w]):o[w]>p?(m=C[O+o[w]],I[k+o[w]]):(m=96,0),l=1<<(f=y-A),v=d=1<<T;n[c+(E>>A)+(d-=l)]=f<<24|m<<16|_|0,0!==d;);for(l=1<<y-1;E&l;)l>>=1;if(0!==l?E=(E&l-1)+l:E=0,w++,0==--B[y]){if(y===b)break;y=t[i+o[w]]}if(x<y&&(E&u)!==h){for(c+=v,M=1<<(T=y-(A=0===A?x:A));T+A<b&&!((M-=B[T+A])<=0);)T++,M<<=1;if(S+=1<<T,1===e&&852<S||2===e&&592<S)return 1;n[h=E&u]=x<<24|T<<16|c-a|0}}0!==E&&(n[c+E]=y-A<<24|64<<16|0),s.bits=x}return 0}},{"../utils/common":41}],51:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,L,t){var n=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var r=16,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],d=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],h=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],u=new Array(576),c=(i(u),new Array(60)),p=(i(c),new Array(512)),f=(i(p),new Array(256)),m=(i(f),new Array(29));i(m);var _,g,y,w=new Array(30);function v(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function x(e){return e<256?p[e]:p[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function T(e,t,i){e.bi_valid>r-i?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>r-e.bi_valid,e.bi_valid+=i-r):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function A(e,t,i){T(e,i[2*t],i[2*t+1])}function M(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function S(e,t,i){for(var r,n=new Array(16),a=0,o=1;o<=15;o++)n[o]=a=a+i[o-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=M(n[s]++,s))}}function E(e){for(var t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function I(e){8<e.bi_valid?a(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function o(e,t,i,r){var n=2*t,a=2*i;return e[n]<e[a]||e[n]===e[a]&&r[t]<=r[i]}function k(e,t,i){for(var r=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&o(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!o(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r}function B(e,t,i){var r,n,a,o,s=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],n=e.pending_buf[e.l_buf+s],s++,0==r?A(e,n,t):(A(e,(a=f[n])+256+1,t),0!==(o=l[a])&&T(e,n-=m[a],o),A(e,a=x(--r),i),0!==(o=d[a])&&T(e,r-=w[a],o)),s<e.last_lit;);A(e,256,t)}function D(e,t){var i,r,n,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<l;i++)0!==a[2*i]?(e.heap[++e.heap_len]=d=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)a[2*(n=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=o[2*n+1]);for(t.max_code=d,i=e.heap_len>>1;1<=i;i--)k(e,a,i);for(n=l;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],k(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,a[2*n]=a[2*i]+a[2*r],e.depth[n]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,a[2*i+1]=a[2*r+1]=n,e.heap[1]=n++,k(e,a,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var h,u,c,p,f,m=e,_=t.dyn_tree,g=t.max_code,y=t.stat_desc.static_tree,w=t.stat_desc.has_stree,v=t.stat_desc.extra_bits,b=t.stat_desc.extra_base,x=t.stat_desc.max_length,T=0,A=0;A<=15;A++)m.bl_count[A]=0;for(_[2*m.heap[m.heap_max]+1]=0,h=m.heap_max+1;h<573;h++)x<(A=_[2*_[2*(u=m.heap[h])+1]+1]+1)&&(A=x,T++),_[2*u+1]=A,g<u||(m.bl_count[A]++,p=0,b<=u&&(p=v[u-b]),f=_[2*u],m.opt_len+=f*(A+p),w&&(m.static_len+=f*(y[2*u+1]+p)));if(0!==T){do{for(A=x-1;0===m.bl_count[A];)A--}while(m.bl_count[A]--,m.bl_count[A+1]+=2,m.bl_count[x]--,0<(T-=2));for(A=x;0!==A;A--)for(u=m.bl_count[A];0!==u;)g<(c=m.heap[--h])||(_[2*c+1]!==A&&(m.opt_len+=(A-_[2*c+1])*_[2*c],_[2*c+1]=A),u--)}S(a,d,e.bl_count)}function C(e,t,i){var r,n,a=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=o,o=t[2*(r+1)+1],++s<l&&n===o||(s<d?e.bl_tree[2*n]+=s:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=n,d=(s=0)===o?(l=138,3):n===o?(l=6,3):(l=7,4))}function O(e,t,i){var r,n,a=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),r=0;r<=i;r++)if(n=o,o=t[2*(r+1)+1],!(++s<l&&n===o)){if(s<d)for(;A(e,n,e.bl_tree),0!=--s;);else 0!==n?(n!==a&&(A(e,n,e.bl_tree),s--),A(e,16,e.bl_tree),T(e,s-3,2)):s<=10?(A(e,17,e.bl_tree),T(e,s-3,3)):(A(e,18,e.bl_tree),T(e,s-11,7));a=n,d=(s=0)===o?(l=138,3):n===o?(l=6,3):(l=7,4)}}i(w);var R=!1;function P(e,t,i,r){T(e,0+(r?1:0),3),r=t,t=i,I(i=e),a(i,t),a(i,~t),n.arraySet(i.pending_buf,i.window,r,t,i.pending),i.pending+=t}t._tr_init=function(e){if(!R){for(var t,i,r,n,a=new Array(16),o=r=0;o<28;o++)for(m[o]=r,t=0;t<1<<l[o];t++)f[r++]=o;for(f[r-1]=o,o=n=0;o<16;o++)for(w[o]=n,t=0;t<1<<d[o];t++)p[n++]=o;for(n>>=7;o<30;o++)for(w[o]=n<<7,t=0;t<1<<d[o]-7;t++)p[256+n++]=o;for(i=0;i<=15;i++)a[i]=0;for(t=0;t<=143;)u[2*t+1]=8,t++,a[8]++;for(;t<=255;)u[2*t+1]=9,t++,a[9]++;for(;t<=279;)u[2*t+1]=7,t++,a[7]++;for(;t<=287;)u[2*t+1]=8,t++,a[8]++;for(S(u,287,a),t=0;t<30;t++)c[2*t+1]=5,c[2*t]=M(t,5);_=new v(u,l,257,286,15),g=new v(c,d,0,30,15),y=new v(new Array(0),s,0,19,7),R=!0}e.l_desc=new b(e.dyn_ltree,_),e.d_desc=new b(e.dyn_dtree,g),e.bl_desc=new b(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,E(e)},t._tr_stored_block=P,t._tr_flush_block=function(e,t,i,r){var n,a,o,s=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,i=0;i<=31;i++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*i])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(i=32;i<256;i++)if(0!==e.dyn_ltree[2*i])return 1;return 0}(e)),D(e,e.l_desc),D(e,e.d_desc),s=function(e){var t;for(C(e,e.dyn_ltree,e.l_desc.max_code),C(e,e.dyn_dtree,e.d_desc.max_code),D(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=n&&(n=a)):n=a=i+5,i+4<=n&&-1!==t)P(e,t,i,r);else if(4===e.strategy||a===n)T(e,2+(r?1:0),3),B(e,u,c);else{T(e,4+(r?1:0),3);var l=e,d=(t=e.l_desc.max_code+1,i=e.d_desc.max_code+1,s+1);for(T(l,t-257,5),T(l,i-1,5),T(l,d-4,4),o=0;o<d;o++)T(l,l.bl_tree[2*h[o]+1],3);O(l,l.dyn_ltree,t-1),O(l,l.dyn_dtree,i-1),B(e,e.dyn_ltree,e.dyn_dtree)}E(e),r&&I(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(f[i]+256+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){T(e,2,3),A(e,256,u),16===(e=e).bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,i){!function(e){function n(e){delete h[e]}function a(e){if(u)setTimeout(a,0,e);else{var t=h[e];if(t){u=!0;try{var i=t.callback,r=t.args;switch(r.length){case 0:i();break;case 1:i(r[0]);break;case 2:i(r[0],r[1]);break;case 3:i(r[0],r[1],r[2]);break;default:i.apply(o,r)}}finally{n(e),u=!1}}}}function t(e){e.source===i&&"string"==typeof e.data&&0===e.data.indexOf(l)&&a(+e.data.slice(l.length))}var i,o,r,s,l,d,h,u,c,p;(i="undefined"==typeof self?void 0===e?this:e:self).setImmediate||(d=1,u=!(h={}),c=i.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(i))&&e.setTimeout?e:i,p="[object process]"==={}.toString.call(i.process)?function(e){f.nextTick(function(){a(e)})}:function(){var e,t;if(i.postMessage&&!i.importScripts)return e=!0,t=i.onmessage,i.onmessage=function(){e=!1},i.postMessage("","*"),i.onmessage=t,e}()?(l="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",t,!1):i.attachEvent("onmessage",t),function(e){i.postMessage(l+e,"*")}):i.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){a(e.data)},function(e){s.port2.postMessage(e)}):c&&"onreadystatechange"in c.createElement("script")?(r=c.documentElement,function(e){var t=c.createElement("script");t.onreadystatechange=function(){a(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):function(e){setTimeout(a,0,e)},e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];return h[d]={callback:e,args:t},p(d),d++},e.clearImmediate=n)}.call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}.call(this,i(4).Buffer,i(8).setImmediate,i(0),i(2))},function(e,C,O){!function(e){var A=O(5),a=O(6),s=O(7);function i(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(e=null===e?new u(t):e).length=t,e}function u(e,t,i){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,i);if("number"!=typeof e)return r(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return o(this,e)}function r(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var n=e,a=t,o=i;if(a.byteLength,o<0||a.byteLength<o)throw new RangeError("'offset' is out of bounds");if(a.byteLength<o+(r||0))throw new RangeError("'length' is out of bounds");return a=void 0===o&&void 0===r?new Uint8Array(a):void 0===r?new Uint8Array(a,o):new Uint8Array(a,o,r),u.TYPED_ARRAY_SUPPORT?(n=a).__proto__=u.prototype:n=d(n,a),n}if("string"!=typeof t){o=e,r=t;if(u.isBuffer(r))return a=0|h(r.length),0!==(o=l(o,a)).length&&r.copy(o,0,0,a),o;if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||function(e){return e!=e}(r.length)?l(o,0):d(o,r);if("Buffer"===r.type&&s(r.data))return d(o,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}n=e,r=t,e=i;if(u.isEncoding(e="string"==typeof e&&""!==e?e:"utf8"))return t=0|c(r,e),n=(r=(n=l(n,t)).write(r,e))!==t?n.slice(0,r):n;throw new TypeError('"encoding" must be a valid string encoding')}function n(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function o(e,t){if(n(t),e=l(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function d(e,t){var i=t.length<0?0:0|h(t.length);e=l(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function c(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var i=(e="string"!=typeof e?""+e:e).length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return B(e).length;default:if(r)return k(e).length;t=(""+t).toLowerCase(),r=!0}}function t(e,t,i){var r,n=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var a=this,o=t,s=i,l=a.length;(!s||s<0||l<s)&&(s=l);for(var d="",h=o=!o||o<0?0:o;h<s;++h)d+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(a[h]);return d;case"utf8":case"utf-8":return M(this,t,i);case"ascii":var u=this,l=t,c=i,p="";c=Math.min(u.length,c);for(var f=l;f<c;++f)p+=String.fromCharCode(127&u[f]);return p;case"latin1":case"binary":var m=this,o=t,_=i,g="";_=Math.min(m.length,_);for(var y=o;y<_;++y)g+=String.fromCharCode(m[y]);return g;case"base64":return w=this,r=i,0===(v=t)&&r===w.length?A.fromByteArray(w):A.fromByteArray(w.slice(v,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var w=t,v=i,b=this.slice(w,v),x="",T=0;T<b.length;T+=2)x+=String.fromCharCode(b[T]+256*b[T+1]);return x;default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function f(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,(i=(i=isNaN(i)?n?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:m(e,t,i,r,n);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):m(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function m(e,t,i,r,n){var a=1,o=e.length,s=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o/=a=2,s/=2,i/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n)for(var d=-1,h=i;h<o;h++)if(l(e,h)===l(t,-1===d?0:h-d)){if(h-(d=-1===d?h:d)+1===s)return d*a}else-1!==d&&(h-=h-d),d=-1;else for(h=i=o<i+s?o-s:i;0<=h;h--){for(var u=!0,c=0;c<s;c++)if(l(e,h+c)!==l(t,c)){u=!1;break}if(u)return h}return-1}function _(e,t,i,r){return D(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function g(e,t,i,r){return D(function(e,t){for(var i,r,n=[],a=0;a<e.length&&!((t-=2)<0);++a)i=e.charCodeAt(a),r=i>>8,n.push(i%256),n.push(r);return n}(t,e.length-i),e,i,r)}function M(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var a,o,s,l,d=e[n],h=null,u=239<d?4:223<d?3:191<d?2:1;if(n+u<=i)switch(u){case 1:d<128&&(h=d);break;case 2:128==(192&(a=e[n+1]))&&127<(l=(31&d)<<6|63&a)&&(h=l);break;case 3:a=e[n+1],o=e[n+2],128==(192&a)&&128==(192&o)&&2047<(l=(15&d)<<12|(63&a)<<6|63&o)&&(l<55296||57343<l)&&(h=l);break;case 4:a=e[n+1],o=e[n+2],s=e[n+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&65535<(l=(15&d)<<18|(63&a)<<12|(63&o)<<6|63&s)&&l<1114112&&(h=l)}null===h?(h=65533,u=1):65535<h&&(r.push((h-=65536)>>>10&1023|55296),h=56320|1023&h),r.push(h),n+=u}var c=r,p=c.length;if(p<=y)return String.fromCharCode.apply(String,c);for(var f="",m=0;m<p;)f+=String.fromCharCode.apply(String,c.slice(m,m+=y));return f}C.Buffer=u,C.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},C.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),C.kMaxLength=i(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,i){return r(null,e,t,i)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol)&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0}),u.alloc=function(e,t,i){return r=null,t=t,i=i,n(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?l(r,e).fill(t,i):l(r,e).fill(t):l(r,e);var r},u.allocUnsafe=function(e){return o(null,e)},u.allocUnsafeSlow=function(e){return o(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,a=Math.min(i,r);n<a;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;for(var i=u.allocUnsafe(t),r=0,n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},u.byteLength=c,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?M(this,0,e):t.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",t=C.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t)&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,i,r,n){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;for(var a=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(t>>>=0),s=Math.min(a,o),l=this.slice(r,n),d=e.slice(t,i),h=0;h<s;++h)if(l[h]!==d[h]){a=l[h],o=d[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},u.prototype.indexOf=function(e,t,i){return f(this,e,t,i,!0)},u.prototype.lastIndexOf=function(e,t,i){return f(this,e,t,i,!1)},u.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||n<i)&&(i=n),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var a,o,s,l=!1;;)switch(r){case"hex":var d=this,h=e,u=t,c=i,p=(u=Number(u)||0,d.length-u);if((!c||p<(c=Number(c)))&&(c=p),(p=h.length)%2!=0)throw new TypeError("Invalid hex string");p/2<c&&(c=p/2);for(var f=0;f<c;++f){var m=parseInt(h.substr(2*f,2),16);if(isNaN(m))return f;d[u+f]=m}return f;case"utf8":case"utf-8":return p=t,s=i,D(k(e,(o=this).length-p),o,p,s);case"ascii":return _(this,e,t,i);case"latin1":case"binary":return _(this,e,t,i);case"base64":return o=this,s=t,a=i,D(B(e),o,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,t,i);default:if(l)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),l=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var y=4096;function w(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function v(e,t,i,r,n,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<a)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function b(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,a=Math.min(e.length-i,2);n<a;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function x(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,a=Math.min(e.length-i,4);n<a;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function T(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function S(e,t,i,r,n){return n||T(e,0,i,4),a.write(e,t,i,r,23,4),i+4}function E(e,t,i,r,n){return n||T(e,0,i,8),a.write(e,t,i,r,52,8),i+8}u.prototype.slice=function(e,t){var i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else for(var r=t-e,n=new u(r,void 0),a=0;a<r;++a)n[a]=this[a+e];return n},u.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var r=this[e],n=1,a=0;++a<t&&(n*=256);)r+=this[e+a]*n;return r},u.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},u.prototype.readUInt8=function(e,t){return t||w(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||w(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||w(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var r=this[e],n=1,a=0;++a<t&&(n*=256);)r+=this[e+a]*n;return(n*=128)<=r&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||w(e,t,this.length);for(var r=t,n=1,a=this[e+--r];0<r&&(n*=256);)a+=this[e+--r]*n;return(n*=128)<=a&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||w(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(e,t){t||w(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||w(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||w(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||w(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||w(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,i,r){e=+e,t|=0,i|=0,r||v(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,a=0;for(this[t]=255&e;++a<i&&(n*=256);)this[t+a]=e/n&255;return t+i},u.prototype.writeUIntBE=function(e,t,i,r){e=+e,t|=0,i|=0,r||v(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,a=1;for(this[t+n]=255&e;0<=--n&&(a*=256);)this[t+n]=e/a&255;return t+i},u.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):b(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):b(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):x(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,i,r){e=+e,t|=0,r||v(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=0,a=1,o=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},u.prototype.writeIntBE=function(e,t,i,r){e=+e,t|=0,r||v(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=i-1,a=1,o=0;for(this[t+n]=255&e;0<=--n&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},u.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):b(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):b(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):x(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||v(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,i){return S(this,e,t,!0,i)},u.prototype.writeFloatBE=function(e,t,i){return S(this,e,t,!1,i)},u.prototype.writeDoubleLE=function(e,t,i){return E(this,e,t,!0,i)},u.prototype.writeDoubleBE=function(e,t,i){return E(this,e,t,!1,i)},u.prototype.copy=function(e,t,i,r){if(i=i||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<i?i:r)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var n,a=(r=e.length-t<r-i?e.length-t+i:r)-i;if(this===e&&i<t&&t<r)for(n=a-1;0<=n;--n)e[n+t]=this[n+i];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+a),t);return a},u.prototype.fill=function(e,t,i,r){if("string"==typeof e){var n;if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length&&(n=e.charCodeAt(0))<256&&(e=n),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(!(i<=t))if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(s=t;s<i;++s)this[s]=e;else for(var a=u.isBuffer(e)?e:k(new u(e,r).toString()),o=a.length,s=0;s<i-t;++s)this[s+t]=a[s%o];return this};var I=/[^+\/0-9A-Za-z-_]/g;function k(e,t){t=t||1/0;for(var i,r=e.length,n=null,a=[],o=0;o<r;++o){if(55295<(i=e.charCodeAt(o))&&i<57344){if(!n){if(56319<i){-1<(t-=3)&&a.push(239,191,189);continue}if(o+1===r){-1<(t-=3)&&a.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(t-=3)&&a.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(t-=3)&&a.push(239,191,189);if(n=null,i<128){if(--t<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function B(e){return A.toByteArray(function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}}.call(this,O(0))},function(e,t,i){t.byteLength=function(e){var e=h(e),t=e[0],e=e[1];return 3*(t+e)/4-e},t.toByteArray=function(e){var t,i,r=h(e),n=r[0],r=r[1],a=new d(function(e,t){return 3*(e+t)/4-t}(n,r)),o=0,s=0<r?n-4:n;for(i=0;i<s;i+=4)t=l[e.charCodeAt(i)]<<18|l[e.charCodeAt(i+1)]<<12|l[e.charCodeAt(i+2)]<<6|l[e.charCodeAt(i+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;2===r&&(t=l[e.charCodeAt(i)]<<2|l[e.charCodeAt(i+1)]>>4,a[o++]=255&t);1===r&&(t=l[e.charCodeAt(i)]<<10|l[e.charCodeAt(i+1)]<<4|l[e.charCodeAt(i+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t);return a},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,n=[],a=0,o=i-r;a<o;a+=16383)n.push(function(e,t,i){for(var r,n=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(r));return n.join("")}(e,a,o<a+16383?o:a+16383));1==r?(t=e[i-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2==r&&(t=(e[i-2]<<8)+e[i-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return n.join("")};for(var s=[],l=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=r.length;n<a;++n)s[n]=r[n],l[r.charCodeAt(n)]=n;function h(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,d=l>>1,h=-7,u=i?n-1:0,c=i?-1:1,n=e[t+u];for(u+=c,a=n&(1<<-h)-1,n>>=-h,h+=s;0<h;a=256*a+e[t+u],u+=c,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=r;0<h;o=256*o+e[t+u],u+=c,h-=8);if(0===a)a=1-d;else{if(a===l)return o?NaN:1/0*(n?-1:1);o+=Math.pow(2,r),a-=d}return(n?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,i,r,n,a){var o,s,l=8*a-n-1,d=(1<<l)-1,h=d>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:a-1,p=r?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(t+=1<=o+h?u/r:u*Math.pow(2,1-h))*r&&(o++,r/=2),d<=o+h?(s=0,o=d):1<=o+h?(s=(t*r-1)*Math.pow(2,n),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,n),o=0));8<=n;e[i+c]=255&s,c+=p,s/=256,n-=8);for(o=o<<n|s,l+=n;0<l;e[i+c]=255&o,c+=p,o/=256,l-=8);e[i+c-p]|=128*a}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,n,a){!function(e){var t=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function r(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new r(i.call(setTimeout,t,arguments),clearTimeout)},n.setInterval=function(){return new r(i.call(setInterval,t,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(t,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a(9),n.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,n.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}.call(this,a(0))},function(e,t,i){!function(e,t){function a(e){delete l[e]}function o(e){if(d)setTimeout(o,0,e);else{var t=l[e];if(t){d=!0;try{var i=t,r=i.callback,n=i.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(s,n)}}finally{a(e),d=!1}}}}function i(){function e(e){e.source===r&&"string"==typeof e.data&&0===e.data.indexOf(t)&&o(+e.data.slice(t.length))}var t="setImmediate$"+Math.random()+"$";r.addEventListener?r.addEventListener("message",e,!1):r.attachEvent("onmessage",e),u=function(e){r.postMessage(t+e,"*")}}var r,s,n,l,d,h,u,c,p;(r="undefined"==typeof self?void 0===e?this:e:self).setImmediate||(n=1,d=!(l={}),h=r.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(r))&&e.setTimeout?e:r,"[object process]"==={}.toString.call(r.process)?u=function(e){t.nextTick(function(){o(e)})}:!function(){var e,t;if(r.postMessage&&!r.importScripts)return e=!0,t=r.onmessage,r.onmessage=function(){e=!1},r.postMessage("","*"),r.onmessage=t,e}()?u=r.MessageChannel?((p=new MessageChannel).port1.onmessage=function(e){o(e.data)},function(e){p.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(c=h.documentElement,function(e){var t=h.createElement("script");t.onreadystatechange=function(){o(e),t.onreadystatechange=null,c.removeChild(t),t=null},c.appendChild(t)}):function(e){setTimeout(o,0,e)}:i(),e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];return l[n]={callback:e,args:t},u(n),n++},e.clearImmediate=a)}.call(this,i(0),i(2))},function(i,e,t){t.r(e);var j=t(1);console.log("NDS ExtensionFramework V0.1");let o={FLAG_ENABLE_NODE_TRANSFORM:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,FLAG_ENABLE_NODE_STOREVIEW:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<1,FLAG_ENABLE_NODE_CAMERA2D:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<2,FLAG_ENABLE_NODE_BLOCK:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<3,FLAG_ENABLE_NODE_TEXT:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<4};class n extends NDSWebViewer.Extension{constructor(){super()}onLoad(e){}onInitLights(){}update(e){}setFlags(e){super.setFlags(e)}onNdsModelPrepareForRendering(e){}onBeforeNdsModelUpdate(e,t){}onAfterNdsModelUpdate(e,t){}onBeforeNdsModelSetRender(e,t){}onAfterNdsModelSetRender(e,t){}onBeforeNdsMeshRender(e,t){}onBeforeScreenCapture(e){}onAfterScreenCapture(){}onBeforeChangeBackGroundColor(e){}onAfterChangeBackGroundColor(e){}onAfterWindowResize(e,t,i){}onSetCaptureView(e,t){}getExtensionWithFlags(e){return NDSWebViewer.ExtensionManager.getExtensionWithFlags(e)}resetToDefault(){}needDisableInputEvent(){}getStoreInfo(e){throw this.name+" Extesion did not implement method 'getStoreInfo' "}setStoreInfo(e){throw this.name+" Extesion did not implement method 'setStoreInfo' "}getBodyTransform(e){return new THREE.Matrix4}getBodyNodeTranslate(e){return new THREE.Vector3(0,0,0)}onAfterSetBroadcastInfo(e){}onAfterGetBroadcastInfo(e){}}class O{static getModel(e){return e.ndsModel}static getModelId(e){return e.ndsModel.id}static getUUID(e){return e.uuid}static getObjectId(e){return e.objectid}static getId(e){return e.id}static getBodyNodeMaterial(e){var t=e.getMaterialBodyNodeUUid();return t&&e.useBodyNodeMaterial?e.ndsModel.bodyNodeUUidToMaterial[t]:null}static setBodyNodeMaterial(e,t){e.ndsModel.bodyNodeUUidToMaterial[e.uuid]=t,e.useBodyNodeMaterial=!!t}static getUserMaterial(e){return e.getUserMaterial()}static setUserMaterial(e,t){e.setUserMaterial(t)}static getBoundingBox(e){var t=new THREE.Box3;return e.getBoundingBox(t,!0)}static isLeafBodyNode(e){return!!e.leafBodyAttri||!!e._leafBodyAttri}static isPartBodyNode(e){return"Part"===e.type}static getLeafBodyNodes(e){return e.ndsModel.getLeafBodies(e)}static getMeshesInLeafBodyNode(e){return e.leafBodyAttri?e.leafBodyAttri.bodyMeshIds:[]}static getMatrixLocal(e){return e.matrix}static getMatrixWorld(e){return e.worldMatrix}static setMatrixWorld(e,t){e.setMatrixWorld(t)}static applyTransform(e,t=null){e.applyTransform(t)}static updateMatrixWorld(e,t=!1){e.updateMatrixWorld(t,!0)}static hide(e){e.hide(e)}static show(e){e.show()}static isPreSelected(e){return e.isPreSelected()}static isSelected(e){return e.isSelected()}static isTransparent(e){return e.isTransparent()}static isHidden(e){return e.isHidden()}static isIsolated(e){return e.isIsolated()}static getRenderMode(e){switch(e.renderMode){case 3:return"wireframe";case 4:return"hiddenLineRemove";case 5:return"hiddenLineVisible"}return""}static getBodyNodeTranslate(e,i){var r=new THREE.Vector3(0,0,0),n=e.getExtensionWithFlags(o.FLAG_ENABLE_NODE_TRANSFORM);for(let e=0,t=n.length;e<t;++e)r.add(n[e].getBodyNodeTranslate(i));return r}static updateNodeMatrix(e,t){e.ndsModel.updateNodeMatrix(e.uuid,t,e.getModel().id)}static hideBody(e){e.ndsModel.hideBody(e)}static showBody(e){e.ndsModel.showBody(e)}}let G=function(){let r=new THREE.Matrix4,n=new THREE.Vector3,a=new THREE.Quaternion,o=new THREE.Vector3,s=new THREE.Matrix4,l=new THREE.Matrix4;return function(e,t,i){return r.makeRotationFromQuaternion(i),r.getInverse(r),s.makeTranslation(e.x,e.y,e.z),l.makeTranslation(-e.x,-e.y,-e.z),t.premultiply(l).premultiply(r).premultiply(s),t.decompose(n,a,o),n}}();function u(e,t,i,r,n,a,o){let s=r-i;r=n-i,n=a.map(function(e){return(e-i)/s});new THREE.LinearInterpolant(n,e,t,o).evaluate(r/s)}function b(e,t){let i=[],r=[],n=[],a=[],o=[];return e.forEach(e=>{1==e.trackType||8==e.trackType?i=t?e.translations.slice(0,3):e.translations.slice(-3):2==e.trackType?r=t?e.rotations.slice(0,4):e.rotations.slice(-4):3==e.trackType?n=t?e.scales.slice(0,3):e.scales.slice(-3):4==e.trackType?a=t?e.colors.slice(0,3):e.colors.slice(-3):5!=e.trackType&&7!=e.trackType&&11!=e.trackType||(o=t?e.opacities.slice(0,1):e.opacities.slice(-1))}),{currentTranslation:i,currentRotation:r,currentScale:n,currentColor:a,currentOpacity:o}}function c(e){var t=e[0],i=e[1],e=e[2],t=Math.round(255*t),i=Math.round(255*i),e=Math.round(255*e);return"#"+t.toString(16).padStart(2,"0")+i.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")}function m(e){let t=-1/0,i=1/0,r=null,n=null;return e.forEach(e=>{e.times[e.times.length-1]>t&&(t=e.times[e.times.length-1],r=e),e.times[e.times.length-1]==t&&8==e.trackType&&(r=e),e.times[0]<i&&(i=e.times[0],n=e),e.times[0]==i&&8==e.trackType&&(n=e)}),{max:t,min:i,maxTrack:r,minTrack:n}}function Z(r,n){{let{max:e,min:t}=m(r),i=null;return i=n>e?s(r,e):n<t?s(r,t):s(r,n)}}function s(e,r){let n=0,a=0,o=[];var t;return e.forEach(e=>{var t=function(t,i){if(t&&t.opacities.length){var r=t.times[t.times.length-1],n=t.times[0];let e=[];return r<i?e=t.opacities.slice(-3):i<n?e=t.opacities.slice(0,3):u(t.opacities,1,n,r,i,t.times,e),e[0]}return 0}(e,r),i=function(e,t){{var i;if(e&&e.opacities.length)return i=e.times[e.times.length-1],e.times[0]<=t&&t<=i?1:0}return 0}(e,r),t=i*t;a+=i,n+=t,r>e.times[e.times.length-1]&&o.push(e)}),0==a&&o.length?({max:e,min:t}=m(o),s(o,e)):n/=a}function Y(r,n,a){{let{max:e,min:t}=m(n),i=null;return i=a>e?l(r,n,e):a<t?l(r,n,t):l(r,n,a)}}function l(r,e,n){let a=null,o=0,s=[];var t;return e.forEach(e=>{var t=w(r,e,n);let i=function(e,t){{var i;if(e&&e.opacities.length)return i=e.times[e.times.length-1],e.times[0]<=t&&t<=i?1:0}return 0}(e,n);Array.isArray(t)&&(a=a||JSON.parse(JSON.stringify(t)),t.forEach((e,t)=>{e=i*e.value;null!=a[t].mixOpacity&&null!=a[t].mixOpacity||(a[t].mixOpacity=0),a[t].mixOpacity+=e})),o+=i,n>e.times[e.times.length-1]&&s.push(e)}),0==o&&s.length?({max:e,min:t}=m(s),l(r,s,e)):(Array.isArray(a)&&a.forEach(e=>{e.value=e.mixOpacity/o}),a)}let w=function(){let f=new THREE.LinearInterpolant([0,1],[],1,[]),m=[];return function(e,t,i){if(t&&t.opacities.length){var r=[],n=O.getMeshesInLeafBodyNode(e);if(i>t.times[t.times.length-1]){var a=b([t],!1);for(let e=0;e<n.length;e++){var o=n[e];r.push({meshId:o,value:Array.isArray(a.currentOpacity[0])?a.currentOpacity[0][e]:a.currentOpacity[0]})}}else if(i<t.times[0]){var s=b([t],!0);for(let e=0;e<n.length;e++){var l=n[e];r.push({meshId:l,value:Array.isArray(s.currentOpacity[0])?s.currentOpacity[0][e]:s.currentOpacity[0]})}}else for(let e=0;e<n.length;e++){var d=n[e],h=t.times.findIndex(e=>i<=e),u=t.times.slice(h-1,h+1),c=t.opacities.slice(h-1,h),h=t.opacities.slice(h,h+1),p=[];Array.isArray(c[0])&&!Array.isArray(h[0])?p.push(c[0][e],h[0]):!Array.isArray(c[0])&&Array.isArray(h[0])?p.push(c[0],h[0][e]):Array.isArray(c[0])||Array.isArray(h[0])?Array.isArray(c[0])&&Array.isArray(h[0])&&p.push(c[0][e],h[0][e]):p.push(c[0],h[0]),p.length&&(f.sampleValues=p,f.resultBuffer=m,f._cachedIndex=0,f.evaluate((i-u[0])/(u[1]-u[0])),r.push({meshId:d,value:m[0]}))}return r.length?r:currentOpacity[0]}return 0}}();function p(t,i,r){if(t&&t[i]&&t[i].length){var n=t.times[t.times.length-1],a=t.times[0];let e=[];return n<r?e=t[i].slice(-3):r<a?e=t[i].slice(0,3):u(t[i],3,a,n,r,t.times,e),e}}let q=function(){let w=new THREE.LinearInterpolant([0,1],[],3,[]),v=[];return function(t,i,r){if(i&&i.colors.length){let e=null;var n=[],a=O.getMeshesInLeafBodyNode(t);if(r>i.times[i.times.length-1]){var o=b([i],!1);if(Array.isArray(o.currentColor[0]))for(let e=0;e<a.length;e++){var s=a[e],l=new THREE.Color;l.fromArray(o.currentColor[0],3*e),n.push({meshId:s,value:l})}else{t=new THREE.Color;e=t.fromArray(o.currentColor)}}else if(r<i.times[0]){var d=b([i],!0);if(Array.isArray(d.currentColor[0]))for(let e=0;e<a.length;e++){var h=a[e],u=new THREE.Color;u.fromArray(d.currentColor[0],3*e),n.push({meshId:h,value:u})}else{t=new THREE.Color;e=t.fromArray(d.currentColor)}}else for(let e=0;e<a.length;e++){var c=a[e],p=i.times.findIndex(e=>r<=e),f=i.times.slice(p-1,p+1),m=i.colors.slice(3*p-3,3*p),p=i.colors.slice(3*p,3*p+3),_=[];Array.isArray(m[0])&&!Array.isArray(p[0])?_.push(m[0][3*e],m[0][3*e+1],m[0][3*e+2],p[0],p[1],p[2]):!Array.isArray(m[0])&&Array.isArray(p[0])?_.push(m[0],m[1],m[2],p[0][3*e],p[0][3*e+1],p[0][3*e+2]):Array.isArray(m[0])||Array.isArray(p[0])?Array.isArray(m[0])&&Array.isArray(p[0])&&_.push(m[0][3*e],m[0][3*e+1],m[0][3*e+2],p[0][3*e],p[0][3*e+1],p[0][3*e+2]):_.push(m[0],m[1],m[2],p[0],p[1],p[2]),_.length&&(w.sampleValues=_,w.resultBuffer=v,w._cachedIndex=0,w.evaluate((r-f[0])/(f[1]-f[0])),(m=new THREE.Color).fromArray(v),n.push({meshId:c,value:m}))}return n.length?n:e?(t=e,g=Math.round(255*t.r).toString(16),y=Math.round(255*t.g).toString(16),t=Math.round(255*t.b).toString(16),"0x"+(1===g.length?"0"+g:g)+(1===y.length?"0"+y:y)+(1===t.length?"0"+t:t)):null}var g,y}}();function $(e,t,i,r){var n,a,o,s;return e.length&&!t.length?h(e[0],e[1],e[2],i,r):!e.length&&t.length?d(t,i,r):e.length&&t.length?({max:n,min:a,maxTrack:o,minTrack:s}=m([e[0],...t]),function(t,i){for(let e=0;e<t.length;e++){var r=t[e];if(i>=r.times[0]&&i<=r.times[r.times.length-1])return 1}}(t,r)||8==o.trackType&&r>o.times[o.times.length-1]?d(t,i,r):h(e[0],e[1],e[2],i,r)):null}let d=function(){let s=new THREE.Quaternion,l=new THREE.Vector3,d=new THREE.Vector3,h=new THREE.Matrix4;new THREE.Quaternion;let u=[],c=[],p=[];let f=new THREE.LinearInterpolant([],[],3,[]);return function(e,t,i){var{max:r,min:n,maxTrack:a,minTrack:o}=m(e),n=(p=(r<=i?(r=b([a],!1),u=r.currentTranslation,c=a.rotations,a):i<=n?(r=b([o],!0),u=r.currentTranslation,c=o.rotations,o):(a=function(e,t){if(1==e.length)return e[0];let i=null,r=[];e.forEach(e=>{t>=e.times[0]&&t<=e.times[e.times.length-1]&&(i=e),t>e.times[e.times.length-1]&&r.push(e)}),i||(e=m(r)["maxTrack"],i=e);return i}(e,i),f.parameterPositions=a.times,f.sampleValues=a.translations,f.resultBuffer=u,f._cachedIndex=0,f.evaluate(i),c=a.rotations,a)).scales,h.compose(l.fromArray(u),s.fromArray(c),d.fromArray(p)),C(t,i,h));return n}}(),h=function(){let l=new THREE.Quaternion,d=new THREE.Vector3,h=new THREE.Quaternion,u=new THREE.Vector3,c=[],p=[],f=[],m=[];var e=[];let _=new THREE.QuaternionLinearInterpolant([],[],4,e),g=new THREE.LinearInterpolant([],[],3,e),y=new THREE.Quaternion,w=new THREE.Vector3,v=new THREE.Vector3,b=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3,A=new THREE.Matrix4,M=new THREE.Quaternion,S=new THREE.Matrix4,E=new THREE.Matrix4,I=new THREE.Matrix4,k=new THREE.Vector3,B=new THREE.Quaternion,D=new THREE.Vector3;return function(e,t,i,r,n){var a,o,s;if(e&&t&&i)return e&&(o=e.times[e.times.length-1],a=e.times[0],s=e.times.findIndex(e=>n<e),a<n&&n<o?(a=s-1,b.set(e.centers[3*s],e.centers[3*s+1],e.centers[3*s+2]),v.fromArray(e.translations,3*s),E.fromArray(e.worldMatrixFrame,16*s),E.decompose(k,B,x),E.fromArray(e.worldMatrixFrame,16*a),I.copy(E),E.decompose(k,y,D),w.setFromMatrixPosition(E),A.compose(v,M,x),S.makeTranslation(-b.x,-b.y,-b.z),A.premultiply(S),S.makeRotationFromQuaternion(y),A.premultiply(S),S.makeTranslation(b.x,b.y,b.z),A.premultiply(S),A.decompose(T,B,D),o=w.sub(T),s=b.add(o),(o=e.centers.slice())[3*a]=s.x,o[3*a+1]=s.y,o[3*a+2]=s.z,g.parameterPositions=e.times,g.sampleValues=o,g.resultBuffer=m,g._cachedIndex=0,g.evaluate(n),o=e.translations.slice(),s=G(s,I,y),o[3*a]=s.x,o[3*a+1]=s.y,o[3*a+2]=s.z,g.parameterPositions=e.times,g.sampleValues=o,g.resultBuffer=c):(g.parameterPositions=e.times,g.sampleValues=e.translations,g.resultBuffer=c,g._cachedIndex=0,g.evaluate(n),g.sampleValues=e.centers,g.resultBuffer=m),g._cachedIndex=0,g.evaluate(n)),t&&(_.parameterPositions=t.times,_.sampleValues=t.rotations,_.resultBuffer=p,_._cachedIndex=0,_.evaluate(n)),i&&(g.parameterPositions=i.times,g.sampleValues=i.scales,g.resultBuffer=f,g._cachedIndex=0,g.evaluate(n)),d.fromArray(c),u.fromArray(f),A.compose(d,l,u),S.makeTranslation(-m[0],-m[1],-m[2]),A.premultiply(S),S.makeRotationFromQuaternion(h.fromArray(p)),A.premultiply(S),S.makeTranslation(m[0],m[1],m[2]),A.premultiply(S),C(r,n,A)}}(),C=function(){let n=new THREE.Vector3,a=new THREE.Quaternion,o=new THREE.Vector3,s=new THREE.Matrix4,l=new THREE.Matrix4,d=new THREE.Matrix4,h=new THREE.Vector3,u=new THREE.Matrix4,c=new THREE.Vector3,p=new THREE.Matrix4,f=new THREE.Matrix4;return function(t,i,e){if(d.copy(e),t.length)for(let e=t.length-1;0<=e;e--){var r=t[e];if(i>=r.times[0]){l.fromArray(r.worldMatrixFrame),u.copy(l).invert(),u.premultiply(d),f.extractRotation(u),n.fromArray(r.multiRotations).applyMatrix4(f).normalize(),h.setFromMatrixPosition(d),r.centers.length||r.centers.push(0,0,0),c.subVectors(h,o.fromArray(r.centers).applyMatrix4(f));let e=(i-r.times[0])/(r.times[r.times.length-1]-r.times[0]);1<e&&(e=1),p.makeTranslation(-c.x,-c.y,-c.z),d.premultiply(p),a.setFromAxisAngle(n,r.multiRotations[3]*Math.PI/180*e),s.makeRotationFromQuaternion(a),d.premultiply(s),p.makeTranslation(c.x,c.y,c.z),d.premultiply(p)}}return d}}();let K=function(){let u=[],c=[],p=[],f=new THREE.Vector3,m=new THREE.Vector3,_=new THREE.Vector3,g=new THREE.Vector3,y=new THREE.Vector3,w=new THREE.Vector3,v=new THREE.Vector3,b=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3,A=new THREE.Vector3,M=new THREE.Vector3,S=new THREE.Vector3,E=new THREE.Vector3,I=new THREE.Vector3,k=new THREE.Vector3,B=new THREE.Vector3,D=new THREE.Vector3,C=new THREE.Vector3,O=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Vector3,L=new THREE.Matrix4;let N=new THREE.LinearInterpolant([],[],3,[]);return function(t,i,r){t=t.sceneWraper;if(i&&0!=i.times.length&&null!=i.devices){let e=-1;if(r<=i.times[0])e=0,g.fromArray(i.cameras,3*e),w.fromArray(i.targets,3*e),_.fromArray(i.ups,3*e);else if(r>=i.times[i.times.length-1])e=i.times.length-1,g.fromArray(i.cameras,3*e),w.fromArray(i.targets,3*e),_.fromArray(i.ups,3*e);else{if(-1==(h=i.times.findIndex(e=>r<=e)))return;e=0==h?0:h-1,g.fromArray(i.cameras,3*e),y.fromArray(i.cameras,3*h),w.fromArray(i.targets,3*e),v.fromArray(i.targets,3*h),b.fromArray(i.orbitCenters,3*e),x.fromArray(i.orbitCenters,3*h),T.fromArray(i.ups,3*e),A.fromArray(i.devices,3*h),L.fromArray(i.projectionMatrixInverses,16*h),N.parameterPositions=i.times,N.sampleValues=i.cameras,N.resultBuffer=p,N._cachedIndex=0,N.evaluate(r),N.parameterPositions=i.times,N.sampleValues=i.ups,N.resultBuffer=c,N._cachedIndex=0,N.evaluate(r),N.parameterPositions=i.times,N.sampleValues=i.targets,N.resultBuffer=u,N._cachedIndex=0,N.evaluate(r),f.fromArray(p),_.fromArray(c),m.fromArray(u);var n=g.distanceToSquared(w).toFixed(2),a=y.distanceToSquared(v).toFixed(2),o=S.subVectors(w,b),s=E.subVectors(v,x),l=I.subVectors(g,w),d=k.subVectors(y,v);if(1e-4<Math.abs(l.angleTo(d))&&"OpDrawGeom"==t.getCurrentOperator().type&&t.getCurrentOperator().rotateViewBox(),1e-4<Math.abs(l.angleTo(d))&&Math.abs(o.length()-s.length())<1e-4)return t=(r-i.times[e])/(i.times[h]-i.times[e]),B.copy(g).sub(o),D.copy(y).sub(s),C.subVectors(B,b),O.subVectors(D,x),l=C.angleTo(O),0==(d=R.copy(C).cross(O).normalize()).x&&0==d.y&&0==d.z&&(0!=_.y?d.y=1:0!=_.z?d.x=1:0!=_.x?d.z=1:(d.x=1,_.z=1)),0==_.x&&0==_.y&&0==_.z&&(0!=T.x&&(_.x=1),0!=T.y&&(_.y=1),0!=T.z)&&(_.z=1),_.normalize(),f.copy(C).applyAxisAngle(d,l*t),f.add(x),m.copy(x),{position:f,up:_,target:m,device:A,projectionMatrixInverse:L,orbitCenter:x};n==a?M.copy(g).sub(w):M.copy(f).sub(m);var h=P.subVectors(f,m).normalize();g.copy(m).addScaledVector(h,M.length()),w.copy(m)}return{position:g,up:_,target:w}}}}();function R(e,t,i){for(var[r,n]of e)if(r.startsWith(i)&&t>=n.startTime&&t<=n.endTime)return n;return null}function f(e,t,i){var r=i.sceneWraper.getPixelRatio(),i=i.sceneWraper.getRenderDomElement(),n=i.width/2,i=i.height/2;return{x:Math.round((n*e+n)/r),y:Math.round((-i*t+i)/r)}}function P(e,i){let r=e.groups;var n=e.times,a=[];if(Array.isArray(r))for(let t=0;t<r.length;t++)if(!a.includes(r[t])){a.push(r[t]);var o=n[t],s=n[r.findLastIndex(e=>e==r[t])];if(o<=i&&i<=s)return!0}return!1}function L(f,e,m){let{uuids:t,id2showHideStatusMap:_,time:g,unExistMap:y}=e,w=f.sceneWraper;var v=A(f.ndsModels||T(f),m),b=[];let x=f.trackDataMap;return t.length?t.forEach(e=>{var i=e.lastIndexOf("-");if(0<i){var r=e.slice(0,i);let t=parseInt(e.slice(i+1));var n=[];if(y&&y.size&&(n=y.get(String(t))),0<v.filter(e=>e.id==t).length){var a=w.getBodyNodeFromUuid(r,t);if(a&&a.uuid){e=`${m}-${a.uuid}-`+t,i=`${m}-${a.uuid}-${t}-14`,r=x.get(i),i=!r||P(r,g),r=(_.set(e,i),w.getBodyNodeFromUuid(a.uuid,t));if(r)if(i){1!=M(f,r,t)&&O.showBody(r),b.indexOf(t)<0&&b.push(t);var o=f,e=m,s=t,l=g,d=o.sceneWraper,h=o.queryTracks(e,[18],[s]);if(h&&!(h.length<1))for(let e=0;e<h.length;e++){var u,c=h[e];for(let e=0;e<c.times.length;e+=2)l>=c.times[e]&&l<=c.times[e+1]&&(u=d.getBodyNodeFromUuid(c.modelID[0],s))&&u.visible&&(O.hideBody(u),o.viewer.selectionManager.isObjectSelected(u))&&o.viewer.selectionManager.deselectObject(u,!1)}if(n&&0<n.length)for(let e=0;e<n.length;e++){var p=n[e],p=a.ndsModel.objectidTouuid[p];p&&(p=w.getBodyNodeFromUuid(p,t))&&O.hideBody(p)}}else 0!=M(f,r,t)&&w.showObject(r,!1,!1,!0)}}}}):b.push("0"),b}function X(e){let t=e;var i=e&&e.indexOf("model.js"),i=(t=(t=(t=1<i?e.substring(0,i):t).replaceAll("\\","/")).endsWith("/")?t.substring(0,t.length-1):t).substring(t.lastIndexOf("/")+1),i=(/^[0-6]$/.test(i)&&(t=t.substring(0,t.lastIndexOf("/"))),{origin:"",prefix0:"",prefix1:"",prefix2:"",prefix3:""});return i.prefix0=function(e){let t=e,i=e&&e.indexOf("model.js");1<i?t=e.substr(0,i):e.lastIndexOf("/")!=e.length-1&&(t=e+"/");return t}(e),0<=t.indexOf("/")&&(i.prefix2=t.substring(0,t.lastIndexOf("/"))),0<=i.prefix2.indexOf("/")?i.prefix3=i.prefix2.substring(0,i.prefix2.lastIndexOf("/")):i.prefix3=i.prefix2,i.prefix1=t,i.origin=function(e){var t;if(e.startsWith("http://")){if(0<(t=e.replace("http://","").indexOf("/")))return e.substring(0,t+"http://".length)}else if(e.startsWith("https://")){if(0<(t=e.replace("https://","").indexOf("/")))return e.substring(0,t+"http://".length)}else if(e.startsWith("file:///"))if(0<(t=e.replace("file:///","").replaceAll("\\","/").lastIndexOf("/")))return e.substring(0,t+"file:///".length);return""}(e),console.log("prefixPath:",JSON.stringify(i)),i}async function Q(e,t,i,r){try{var n=null;if(NDSWebViewer.SETTING.singleHTML){var a=await H(e._binaryData,"string",t.prefix0+"aniFilelist.js");if((n=JSON.parse(a))&&0<n.length){for(let e=0;e<n.length;e++){var o=n[e];r.set(String(o.modelId),o)}if(i.models&&1<i.models.length)for(let e=0;e<i.models.length;++e){var s=i.models[e];r.has(String(s.modelId))&&(h=r.get(String(s.modelId)))&&h.url&&(s.url=h.url,s.name=h.name)}}return i}var l=await fetch(t.prefix0+"aniFilelist.js?temp="+(new Date).getTime());if(!l.ok)return i;try{if((n=await l.json())&&0<n.length){for(let e=0;e<n.length;e++){var d=n[e];r.set(String(d.modelId),d)}if(i.models&&1<i.models.length)for(let e=0;e<i.models.length;++e){var h,u,s=i.models[e];r.has(String(s.modelId))&&(h=r.get(String(s.modelId)))&&h.url&&(s.name=h.name,console.log("insertPath-before-",h.url),c=h.url,p=t,u=c.startsWith("http://")||c.startsWith("https://")||c.startsWith("file:///")||/^[A-Za-z]:/.test(c)?c:c.startsWith("/")?p.origin+c:c.startsWith("./")?p.prefix2+"/"+c.substring(2):c.startsWith("../")?p.prefix3+"/"+c.substring(3):p.prefix1+"/"+c,console.log("insertPath-before1-",u),s.url=await(async e=>{if(e&&e.endsWith("model.js"))return e;if(e&&e.endsWith("model.json"))return e;let t=e,i=e&&e.indexOf("model.js");if(i>1)return e;else if(e.lastIndexOf("/")!=e.length-1)t=e+"/";let r=await k(t+"Configurations.json"+`?temp=${(new Date).getTime()}`),n=I(t,r);return n})(u),console.log("insertPath-after-",s.url))}}return i}catch(e){return i}}catch(e){return console.info(":",e),i}var c,p}function _(t,i){var r=-1;if(0<=i.indexOf(t))r=t;else for(let e=0;e<i.length;e++)0==e?t<=i[e]&&(r=i[e]):t>i[e-1]&&t<=i[e]&&(r=i[e]);return r}function g(e,t){e=t.indexOf(e);return 0<=e-1?t[e-1]+.02:0}function N(t,e){if(e.has(String(t.modelUri)))return e.get(String(t.modelUri));var i=[],r=[];if(t.hideBodies&&0<t.hideBodies.length)for(let e=0;e<t.hideBodies.length;e++){var n=t.hideBodies[e];r.indexOf(n.uuid)<0&&(r.push(n.uuid),i.push(n))}e.set(String(t.modelUri),i)}let I=(e,r)=>{let n={};if(r){let t=r.IsDisaModel?"/model.json":"/model.js",i=e;n={...r},r.Accuracy&&0<r.Accuracy.length&&(r.Accuracy.map(e=>{2==e.Level&&(i=i+e.Folder+"/")}),n.mPath=i+t),r.Configurations&&(r.Configurations.map(e=>{e.mPath=i+e.Folder+t}),n.mPath=r.Configurations[0].mPath)}else n.mPath=e+"model.js";return n.mPath};async function k(e){try{var t=await fetch(e);if(!t.ok)return null;try{return await t.json()}catch(e){return null}}catch(e){return console.info(":",e),null}}function v(e,t){var i=new THREE.Box3,r=A(e.ndsModels,t);for(let e=0;e<r.length;e++){var n=r[e];for(let e=0;e<n.wholeLeafBodyNodes.length;e++){var a=n.wholeLeafBodyNodes[e];("Body"==a.type||"Model"==a.type)&&a.leafBodyAttri&&a.leafBodyAttri.bodyMeshIds.length&&a.visible&&(a.__bounding_box_dirty__=!0,a=n.getBodyBoundingBox(a))&&i.union(a)}}return i}function V(e,t,l){let d=e.meshId2MaterialMap,h=x(e.modelWraperMap,t);if(h){e=O.getMeshesInLeafBodyNode(t);let o=O.getModelId(t),s;e&&e.forEach((t,e)=>{var i,r,n=h.getMeshMaterial(t);let a=n.material;"MeshPhysicalMaterial"===a.type&&(i=t+"-"+o,d.has(i)&&(r=d.get(i)).type==a.type?a=r:(a=n.material.clone(),d.set(i,a))),a._oriColor||(a._oriColor=a.color.clone()),a.OriginTransparentFlag=!0,a.OriginTransparent=void 0,a.OriginOpacity=void 0,a.needsUpdate=!0,s=Array.isArray(l)?l.find(e=>e.meshId==t).value:l||a._oriColor,a.color.set(s.r,s.g,s.b),a.opacity=n.drawingParams.opacity,h.setMeshMaterialTemporaryUpdate(t,a),"MeshPhysicalMaterial"===a.type&&h.setMeshMaterial(t,a)})}}function W(e,t,l){let d=e.meshId2MaterialMap,h=x(e.modelWraperMap,t);if(h){e=O.getMeshesInLeafBodyNode(t);let o=O.getModelId(t),s;e&&e.forEach((t,e)=>{var i,r,n=h.getMeshMaterial(t);let a=n.material;"MeshPhysicalMaterial"===a.type&&(i=t+"-"+o,d.has(i)&&(r=d.get(i)).type==a.type?a=r:(a=n.material.clone(),d.set(i,a))),a._oriOpacity||(a._oriOpacity=a.opacity),a.OriginTransparentFlag=!0,a.OriginTransparent=void 0,a.OriginOpacity=void 0,a.needsUpdate=!0,s=Array.isArray(l)?l.find(e=>e.meshId==t).value:"number"==typeof l?l:a._oriOpacity,a.opacity=s,a.transparent=a.opacity<1,a.color.setHex(n.drawingParams.color),h.setMeshMaterialTemporaryUpdate(t,a),"MeshPhysicalMaterial"===a.type&&h.setMeshMaterial(t,a)})}}function F(i){i.ndsModels.forEach(e=>{if(0!=e.id&&e.animationId!=i.activeAnimationID)return!0;let t=i.modelWraperMap.get(e.id).getMeshState();if(!t)return!0;e.meshSets.forEach(e=>{e.needsUpdate&&t.meshSetUpdate(e)})})}function z(t){t.ndsModels.forEach(e=>{if(0!=e.id&&e.animationId!=t.activeAnimationID)return!0;t.modelWraperMap.has(e.id)&&t.modelWraperMap.get(e.id).refreshBodyWorldMatrixUniforms()})}function T(e){var t=[],i=e.sceneWraper;for(let e=0;e<i.getModelCount();e++){var r=i.getModelByIndex(e);t.push(r)}return t}function A(t,i){var r=[];if(t&&0<t.length)for(let e=0;e<t.length;++e){var n=t[e];(0==n.id||n.animationId==i)&&r.push(n)}return r}function x(e,t){t=O.getModelId(t);return e.has(t)?e.get(t).getMeshState():null}function M(e,t,i=0){e=e.sceneWraper;e.setActiveModelByModelId(i);let r=e.getBodyNodeFromUuid(t.uuid,i);if(r=r||t,O.getModel(t))return 0!=r.children.length||r.leafBodyAttri||"Body"==r.type?O.getModel(t).getBodyOrSomeChildVisibleStatus(r):r.visible?1:0}async function J(r){let n=r.zip;var e;n&&(e=Object.keys(n.files).map(e=>async function(e){var t,i;!1===(e=n.files[e]).dir&&"string"==(t="js"==(e=e.name).substr(e.length-2,2)?"string":"arraybuffer")&&(i=await n.file(e).async(t),r._binaryData.set(e,{returnType:t,content:i}))}(e)),await Promise.all(e))}function H(e,i,t){t=t.replace(/^\.\/|^\//,"");let r=e.get(t);return new Promise((e,t)=>{if(r&&r.returnType===i)return e(r.content);t("")})}var e=t(3),B=t.n(e);window.keys=new Set,document.addEventListener("keydown",function(e){window.keys.add(e.key)}),document.addEventListener("keyup",function(e){window.keys.delete(e.key)});let y={preId:"textpoint_",textareaWidth:120,textareaHeight:30,fontSize:24,fontFamily:"",fontStyle:"normal",fontWeight:"normal",minWidth:28,textDecoration:"auto",nodeType:"textNode",color:"#000000",opacity:"1"};function D(t){function i(e,t){t&&(e.style.height="auto"),e.style.height=e.scrollHeight+"px",a((e.id||"").split("_").pop(),e.scrollHeight)}function r(e){n&&(clearTimeout(n),n=null),n=setTimeout(function(){i(e)},200)}let n=null;t.addEventListener?(t.addEventListener("input",function(){i(t,!0)},!1),i(t)):t.attachEvent&&(t.attachEvent("onpropertychange",function(){i(t)}),i(t)),window.VBArray&&window.addEventListener&&(t.attachEvent("onkeydown",function(){var e=window.event.keyCode;8!=e&&46!=e||r(t)}),t.attachEvent("oncut",function(){r(t)}));new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(e=>{1<e.length||i(t,!0)}).observe(t,{childList:!1,attributes:!0,characterData:!1,subtree:!1,attributeFilter:["style"],attributeOldValue:!1,characterDataOldValue:!1})}function a(e,t){var i=document.querySelector("#"+r.preId+"spanlefti_"+e),e=document.querySelector("#"+r.preId+"spanrighti_"+e);i&&(i.style.height=t+"px",i.style.top=-(t-12)/2+"px"),e&&(e.style.height=t+"px",e.style.top=-(t-12)/2+"px")}let r={preId:"textpoint_",list:[],el:"#t_container",sceneWraper:null,viewerEl:null,mousePopEl:null,mousePopElShow:!1,canAddPoint:!1,curSelectPoint:null,nameIndex:0,moveState:"",mousePoint:{x:null,y:null},mouseClickObj:{mouseStatus:"up",leftOrRight:"right"},init:function(e){var t;this.extension=e,this.sceneWraper||(this.sceneWraper=e.sceneWraper),this.staticAnnotation||(this.staticAnnotation=e.staticAnnotation),this.AnimationEdit||(this.AnimationEdit=e.coreView.AnimationEdit),this.viewerEl||(this.viewerEl=document.querySelector(this.el),this.viewerEl.addEventListener("click",this._addTextPoint.bind(this)),this._initPageEvent(),this.mousePopEl=(e=this.viewerEl,(t=document.createElement("div")).innerText="",t.style.position="absolute",t.style.zIndex="10",t.style.width="132px",t.style.height="20px",t.style.overflow="hidden",t.style.fontSize="14px",t.style.lineHeight="20px",t.style.padding="2px",t.style.cursor="default",t.style.userSelect="none",t.style.backgroundColor="rgba(255, 255, 255, 0.5)",t.style.border="1px solid rgb(255, 0, 0)",t.style.textWrap="nowrap",t.style.display="none",e.appendChild(t),t))},_initPageEvent:function(){var e,t,i;this.viewerEl.addEventListener("mouseup",e=>{this.moveState="",this.mouseClickObj.mouseStatus="up",(e.target.id||(e.target.id||"").includes("cms")||e.target.parentNode.id||(e.target.parentNode.id||"").includes("cms")||e.ctrlKey)&&(e.target.id.includes(this.preId+"textarea_")?document.querySelector("#"+e.target.id).focus():e.ctrlKey||this._clearAllSelectedStatus())}),this.viewerEl&&this.viewerEl.addEventListener("mousemove",(e=t=>{try{if(this.AnimationEdit&&this.AnimationEdit.opMouseMoveByEvent&&this.AnimationEdit.opMouseMoveByEvent(t),this._mousePopHandler.call(this,t),this.moveState){var e,i,r,n,a,o,s=document.querySelector("#"+this.preId+"textarea_"+this.curSelectPoint.id),l=document.querySelector("#"+this.preId+"wrap_"+this.curSelectPoint.id);if("width"==this.moveState){if(this.extension._enableAnimation)return;if("down"==this.mouseClickObj.mouseStatus){var d=t.x;let e;if("right"==this.mouseClickObj.leftOrRight){var h=d-this.mousePoint.x;this.mousePoint.x=d,e=parseInt(s.style.width)+h,s.style.width=parseInt(s.style.width)+h+"px"}else if("left"==this.mouseClickObj.leftOrRight){var u=this.mousePoint.x-d;if(this.mousePoint.x=d,parseInt(s.style.width)+u<y.minWidth)return;e=parseInt(s.style.width)+u,s.style.width=parseInt(s.style.width)+u+"px",l.style.left=parseInt(l.style.left)-u+"px"}this._updateDataList({id:this.curSelectPoint.id,style:{width:e}})}}"position"!=this.moveState||this.extension._enableAnimation||(e=t.x,i=t.y,r=e-this.mousePoint.x,n=i-this.mousePoint.y,this.mousePoint.x=e,this.mousePoint.y=i,a=parseInt(l.style.left)+r,o=parseInt(l.style.top)+n,parseInt(s.offsetWidth||0),parseInt(s.offsetHeight||0),this.viewerEl.offsetWidth,this.viewerEl.offsetHeight,l.style.left=(0<a?a:0)+"px",l.style.top=(0<o?o:0)+"px",this._updateDataList({id:this.curSelectPoint.id,position:{x:parseInt(l.style.left),y:parseInt(l.style.top)}}))}}catch(e){console.log(e)}},t=17,i=!0,function(){i&&(e.apply(this,arguments),i=!1,setTimeout(()=>{i=!0},t))}))},_mousePopHandler(e){try{this.mousePopElShow&&"CANVAS"===e.target.nodeName&&e.target.id?(this._showMousePopHandler(!0),this.mousePopEl.style.top=e.offsetY+20+"px",this.mousePopEl.style.left=e.offsetX+6+"px"):this._showMousePopHandler(!1)}catch(e){console.log("_mousePopHandler error = ",e)}},_showMousePopHandler(e){this.mousePopEl&&(this.mousePopEl.style.display=e?"block":"none")},_changeTextareaStatus:function(t,i="default"){var e=document.querySelector("#"+y.preId+"wrap_"+t),r=document.querySelector("#"+y.preId+"mask_"+t),n=document.querySelector("#"+y.preId+"spanleft_"+t),a=document.querySelector("#"+y.preId+"spanright_"+t),o=document.querySelector("#"+y.preId+"textarea_"+t);r&&("default"==i?(e.style.border="1px solid transparent",e.style.zIndex="7",o.style.border="1px solid transparent",r.style.zIndex=10,r.style.cursor="auto",n.style.display="none",a.style.display="none"):"selected"==i?(e.style.border="1px solid rgb(255, 195, 0)",e.style.zIndex="9",n.style.display="block",a.style.display="block",r.style.cursor="move"):"edit"==i&&(e.style.zIndex="9",e.style.border="1px solid rgb(255, 195, 0)",o.focus(),r.style.zIndex="-1",r.style.cursor="auto",n.style.display="block",a.style.display="block"),this.list=this.list.map(e=>(e.id==t&&(e.selectStatus=i),{...e})))},_initTextPointEvent:function(t){var e=document.querySelector("#"+this.preId+"wrap_"+t);e.addEventListener("click",e=>{try{var t;this.extension._enableAnimation&&this.extension.isrunning()||(this._getCurPoint(e),(t=(e.target.id||"").split("_").pop())&&this._changeTextareaStatus(t,"selected"),this._selectedNode(t))}catch(e){console.log(e)}}),e.addEventListener("dblclick",e=>{try{var t;this.extension._enableAnimation||(this._getCurPoint(e),(t=(e.target.id||"").split("_").pop())&&this._changeTextareaStatus(t,"edit"))}catch(e){console.log(e)}}),e.addEventListener("mousedown",e=>{(e.target.id||"").split("_").pop();this.mousePoint.x=e.x,this.mousePoint.y=e.y,"move"==e.target.style.cursor&&(this.moveState="position")});let a=document.querySelector("#"+this.preId+"textarea_"+t);a.addEventListener("input",e=>{this._updateDataList({id:t,content:e.target.value.trim(),style:{height:e.target.scrollHeight}})}),a.addEventListener("keydown",e=>{try{if(13==e.keyCode){a.value=e.target.value.trim(),this._clearAllSelectedStatus();let i=e.target.id.split("_").pop();var t,r=e.target.value,n=e.target.getAttribute("data-create");if(r&&r.trim())"true"==n&&(t=this.list.find(e=>e.id==i)||{},this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"addShowHideTrack",data:{name:t.name,textIds:[i],animationID:t.animationID}}),this.sceneWraper)&&this.sceneWraper.dispatchEvent({type:"PureTextAdd"}),e.target.setAttribute("data-create","false"),this.sceneWraper&&this.AnimationEdit.resetContainerStyle();else{if(this.delTextPoint(i),"true"==n){this.nameIndex--;let t=[];this.list.forEach(e=>e.id!=i&&t.push(e)),this.list=t}"false"==n&&this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"deleteShowHideTrack",data:{textId:[i]}})}}}catch(e){}}),a.addEventListener("blur",e=>{try{a.value=e.target.value.trim();let i=e.target.id.split("_").pop();var t,r=e.target.value,n=e.target.getAttribute("data-create");if(r&&r.trim())"true"==n&&(this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"PureTextAdd"}),t=this.list.find(e=>e.id==i)||{},this.sceneWraper)&&this.sceneWraper.dispatchEvent({type:"addShowHideTrack",data:{name:t.name,textIds:[i],animationID:t.animationID}}),e.target.setAttribute("data-create","false"),this.sceneWraper&&this.AnimationEdit.resetContainerStyle();else{if(this.delTextPoint(i),"true"==n){this.nameIndex--;let t=[];this.list.forEach(e=>e.id!=i&&t.push(e)),this.list=t}"false"==n&&this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"deleteShowHideTrack",data:{textId:[i]}})}}catch(e){}}),document.querySelector("#"+this.preId+"spanright_"+t).addEventListener("mousedown",e=>{this.moveState="width",this.mouseClickObj.leftOrRight="right",this._getCurPoint(e),this.mousePoint.x=e.x,this.mousePoint.y=e.y,this.mouseClickObj.mouseStatus="down"}),document.querySelector("#"+this.preId+"spanleft_"+t).addEventListener("mousedown",e=>{this.moveState="width",this.mouseClickObj.leftOrRight="left",this._getCurPoint(e),this.mousePoint.x=e.x,this.mousePoint.y=e.y,this.mouseClickObj.mouseStatus="down"})},_clearAllSelectedStatus:function(){this.list.forEach(e=>{var t=document.querySelector("#"+this.preId+"textarea_"+e.id);t&&t.blur(),this._changeTextareaStatus(e.id,"default"),e.selectStatus="default"}),this._selectedNode()},_getCurPoint:function(e){let t=(e.target.id||"").split("_").pop();t&&(this.curSelectPoint=this.list.find(e=>e.id==t))},_addTextPoint:function(e,i={},r,n){if(!(e.target&&"CANVAS"!=e.target.nodeName||e.target&&!e.target.id)){let t=this;var a=e.offsetX||e.x,o=e.offsetY||e.y;if(this.canAddPoint||i.id){var s=i.id||"cms"+(s=new Date).getDay()+s.getHours()+s.getMinutes()+s.getSeconds()+s.getMilliseconds()+Math.round(1e4*Math.random()),l=([l,{x:h,y:d},u]=[this.preId+"wrap_"+s,{x:a,y:o},i],(c=document.createElement("div")).id=l,c.style.position="absolute",c.style.top=d+"px",c.style.left=h+"px",c.style.zIndex="7",c.style.width="auto",c.style.height="auto",c.style.display="flex","default"==u.selectStatus?c.style.border="1px solid transparent":(c.style.border="1px solid rgb(255, 195, 0)",c.style.zIndex="9"),c),d=([d,h={}]=[this.preId+"textarea_"+s,i],u=h.style||{},(c=document.createElement("textarea")).id=d,h.content&&(c.innerText=h.content),c.rows="1",c.style.padding="2px",c.style.width=(u.width||y.textareaWidth)+"px",c.style.height=(u.height||y.textareaHeight)+"px",c.style.overflow="hidden",c.style.boxSizing="border-box",c.style.fontSize=(u.fontSize||y.fontSize)+"px",c.style.fontFamily=u.fontFamily||y.fontFamily,c.style.minWidth=y.minWidth+"px",c.style.wordBreak="break-all",c.style.boxSizing="border-box",u.color&&(c.style.color=u.color),u.fontStyle&&(c.style.fontStyle=u.fontStyle),u.fontWeight&&(c.style.fontWeight=u.fontWeight),u.opacity&&(c.style.opacity=u.opacity),u.textDecoration&&(c.style.textDecoration=u.textDecoration),c),e=(e.target&&d.setAttribute("data-create","true"),h=this.preId+"spanleft_"+s,(u=document.createElement("span")).id=h,u.style.width="6px",u.style.height="12px",u.style.border="1px solid rgb(255, 195, 0)",u.style.position="absolute",u.style.left="-4px",u.style.top="50%",u.style.transform="translateY(-50%)",u.style.background="#fff",u.style.zIndex="11",u.style.cursor="e-resize",(c=document.createElement("i")).id=h.replace("spanleft","spanlefti"),c.style.display="block",c.style.position="absolute",c.style.width="8px",c.style.height=y.textareaHeight+"px",c.style.background="transparent",c.style.top=-(y.textareaHeight-12)/2+"px",u.appendChild(c),u),h=(h=this.preId+"spanright_"+s,(c=document.createElement("span")).id=h,c.style.width="6px",c.style.height="12px",c.style.border="1px solid rgb(255, 195, 0)",c.style.position="absolute",c.style.right="-4px",c.style.top="50%",c.style.transform="translateY(-50%)",c.style.background="#fff",c.style.zIndex="11",c.style.cursor="e-resize",(u=document.createElement("i")).id=h.replace("spanright","spanrighti"),u.style.display="block",u.style.position="absolute",u.style.width="8px",u.style.height=y.textareaHeight+"px",u.style.background="transparent",u.style.top=-(y.textareaHeight-12)/2+"px",c.appendChild(u),c),u=(u=this.preId+"mask_"+s,(c=document.createElement("div")).id=u,c.style.width="100%",c.style.height="100%",c.style.position="absolute",c.style.left="0",c.style.top="0",c.style.zIndex="-1",c);u.addEventListener("click",function(e){t.staticAnnotation&&t.staticAnnotation.onCancelHighlight(e)}),l.appendChild(d),l.appendChild(e),l.appendChild(h),l.appendChild(u),this.viewerEl.appendChild(l),i.id||d.focus();try{D(d)}catch(e){console.log("makeHeightAuto error = ",e)}this.nameIndex++;var c=i.style||{},e={id:s,name:i.name||""+this.nameIndex,content:i.content||"",selectStatus:"edit",position:{x:a,y:o},initPosition:{x:a,y:o},style:{width:c.width||y.textareaWidth,height:c.height||y.textareaHeight,fontSize:c.fontSize||y.fontSize,fontFamily:c.fontFamily||y.fontFamily,textDecoration:c.textDecoration||y.textDecoration,fontStyle:c.fontStyle||y.fontStyle,fontWeight:c.fontWeight||y.fontWeight,color:c.color||y.color,opacity:c.opacity||y.opacity},animationID:r||this.sceneWraper&&this.AnimationEdit&&this.AnimationEdit._activeAnimationID,visible:null==n||n};return this.list.push(e),this._initTextPointEvent(s),this._showMousePopHandler(!1),e}}},_updateDataList:function({id:t,name:i,content:r,position:n={},style:a={}},o){this.list.forEach(e=>{e.id==t&&(null!=o&&(e.visible=o),r&&(e.content=r),i&&(e.name=i),n.x&&(e.position.x=n.x),n.y&&(e.position.y=n.y),a.fontSize&&(e.style.fontSize=a.fontSize),a.minWidth&&(e.style.minWidth=a.minWidth),a.fontFamily&&(e.style.fontFamily=a.fontFamily),a.fontStyle&&(e.style.fontStyle=a.fontStyle),a.fontWeight&&(e.style.fontWeight=a.fontWeight),a.textDecoration&&(e.style.textDecoration=a.textDecoration),a.color&&(e.style.color=a.color),null!=a.opacity&&(e.style.opacity=a.opacity),a.display&&(e.style.display=a.display),a.height&&(e.style.height=a.height),a.width)&&(e.style.width=a.width)})},_selectedNode:function(e=0){var t=this.getSelectContent()||[];this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"animationTextselected",data:t}),this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"PurnTextSelect",data:t})},setNameIndex:function(e){this.nameIndex=e},getNameIndex:function(){return this.nameIndex},addTextPoint:function({x:e=0,y:t=0}){return this.canAddPoint=!0,this._addTextPoint({x:e,y:t})},delTextPoint:function(i){var e=document.querySelector("#"+this.preId+"wrap_"+i);if(e){e.parentNode.removeChild(e),this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"PureTextDelete",data:this.list.filter(e=>e.id==i)});let t=[];this.list.forEach(e=>{e.id!=i&&t.push(e)}),this.list=t}},selectTextPoint:function(t){var e=document.querySelector("#"+y.preId+"wrap_"+t);e&&e.style&&e.style.display&&"none"!=e.style.display&&(this.list.forEach(e=>e.id==t&&(e.selectStatus="selected")),this._changeTextareaStatus(t,"selected"))},setFontSize:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.fontSize=parseInt(t||0)+"px",i.style.minWidth=parseInt(t||0)+4+"px",this._updateDataList({id:e,style:{fontSize:parseInt(t||0),minWidth:parseInt(t||0)+4}}))},setFontFamily:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.fontFamily=t,this._updateDataList({id:e,style:{fontFamily:t}}))},setFontStyle:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.fontStyle=t,this._updateDataList({id:e,style:{fontStyle:t}}))},setFontWeight:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.fontWeight=t,this._updateDataList({id:e,style:{fontWeight:t}}))},setTextDecoration:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.textDecoration=t,this._updateDataList({id:e,style:{textDecoration:t}}))},setFontColor:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.color=t,this._updateDataList({id:e,style:{color:t}}))},setOpacity:function(e,t){var i;null!=t&&(i=document.querySelector("#"+this.preId+"textarea_"+e))&&(i.style.opacity=t,this._updateDataList({id:e,style:{opacity:t}}))},setFontHeight:function(t,i){if(null!=i){let e=document.querySelector("#"+this.preId+"textarea_"+t);e.style.height="auto"==i?e.scrollHeight+"px":i+"px",a(t,e.scrollHeight),setTimeout(()=>{e.style.height="auto",setTimeout(()=>{e.style.height=e.scrollHeight+"px"},200)},200),this._updateDataList({id:t,style:{height:i}})}},setPosition:function(e,t=0,i=0){var r=document.querySelector("#"+this.preId+"wrap_"+e);r&&(r.style.left=parseInt(t)+"px",r.style.top=parseInt(i)+"px",this._updateDataList({id:e,position:{x:parseInt(t),y:parseInt(i)}}))},setTextPointShow:function(e,t=!0){var i=document.querySelector("#"+this.preId+"wrap_"+e),r=t?"block":"none";i&&(i.style.display=r,this._updateDataList({id:e,style:{display:r}},t))},setTextPointName:function(e,t){this._updateDataList({id:e,name:t}),this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"animationTextNameChange",data:{id:e,name:t}})},getTextPointDataById:function(t){return t?{...this.list.find(e=>e.id==t)||null,selectStatus:"default"}:null},getTextPointAllData:function(){return this.list.map(e=>({...e}))},getTextLabels:function(){return this.list.map(e=>({id:e.id,name:e.name,type:y.nodeType,visible:e.visible,animationID:e.animationID}))},setListData:function(e){this.list=e},setData:function(t,i=!0){0!==this.list.length&&this.list.forEach(e=>this.delTextPoint(e.id)),this.list=[],this.nameIndex=t.length;for(let e=0;e<t.length;e++){var r=t[e];this._addTextPoint(r.position,{...r,selectStatus:"default"},r.animationID,r.visible),i&&this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"addShowHideTrack",data:{name:r.name,textIds:[r.id],animationID:r.animationID}})}this._clearAllSelectedStatus(),this.sceneWraper&&this.sceneWraper.dispatchEvent({type:"PureTextAdd"})},clickAddPoint:function(){this.canAddPoint=!0,this.mousePopElShow=!0},resetOperate:function(){this.canAddPoint=!1,this.mousePopElShow=!1,this._showMousePopHandler(!1)},setTextPointHighLight:function(e,t){this._changeTextareaStatus(e,t?"selected":"default")},getSelectContent:function(){return this.list.filter(e=>"selected"==e.selectStatus)},resetStyle:function(e){this.setFontStyle(e,y.fontStyle),this.setFontWeight(e,y.fontWeight),this.setTextDecoration(e,y.textDecoration),this.setFontColor(e,y.color),this.setFontFamily(e,y.fontFamily),this.setFontSize(e,y.fontSize),this.setOpacity(e,y.opacity)}};var S=window._nd_aniTextPoint=r;class ee{constructor(e){this.__coreView__=e}addEventListener(e,t){this.__coreView__.addEventListener(e,t)}hasEventListener(e,t){return this.__coreView__.hasEventListener(e,t)}removeEventListener(e,t){this.__coreView__.removeEventListener(e,t)}dispatchEvent(e){this.__coreView__.dispatchEvent(e)}getPixelRatio(){return this.__coreView__.renderer.getPixelRatio()}switchRotateCenterBySelection(){this.__coreView__.switchRotateCenterBySelection()}setDefaultEnvMap(e){e&&(this.__coreView__.hasPbrMaterial=!0,this.__coreView__.setDefaultEnvMap=()=>{this.__coreView__.setEnvMapEnabled(!0),this.__coreView__.defaultEnvMapTexture=e,this.__coreView__.updateEnvMap(this.__coreView__.defaultEnvMapTexture)},this.__coreView__.setDefaultEnvMap())}getBackgroundState(){return this.__coreView__.exchangeBackImage?{type:this.__coreView__.exchangeBackImage.type,value:this.__coreView__.exchangeBackImage.value}:void 0}setBackgroundState(e,t){"Image"===e?(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(t)):"EnvMap"===e?this.__coreView__.setEnvMapTextures(t):"Color"===e&&(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(null),this.__coreView__.setBackGroundColor(t))}removeAllLights(){this.__coreView__.lights.length=0}getLight(e){return this.__coreView__.lights[e]}setLight(e,t){this.__coreView__.lights[e]=t}getViewBox(){return this.__coreView__.viewBox}toggleAutoRotation(e){this.__coreView__.toggleAutoRotation(e)}randColor(){return this.__coreView__.materialsSetting.randColor()}getBoundingBox(e=!0){e=this.__coreView__.ndsModel.getTotalBodyBoundingBox(null,e);return e.isEmpty()?this.__coreView__.modelRootObject.boundingBox:e}getModelTree(){return this.__coreView__.getModelTree()}getModelTotalTree(){return this.__coreView__.getModelTotalTree()}getModelCount(){return this.__coreView__.ndsModel.models.length}setActiveModel(e){this.__coreView__.ndsModel.setActiveModel(e)}setActiveModelByModelId(t){let i=-1;for(let e=0;e<this.__coreView__.ndsModel.models.length;++e)if(this.__coreView__.ndsModel.models[e].id===t){i=e;break}this.setActiveModel(i)}getActiveModel(){return this.__coreView__.ndsModel.getActiveModel()}getModelById(e){return this.__coreView__.ndsModel.getModelById(e)}getModelIndexByModelId(t){var i=this.__coreView__.ndsModel;for(let e=0;e<i.models.length;++e)if(i.models[e].id===t)return e}getModelByIndex(e){return this.__coreView__.ndsModel.models[e]}registOperator(e,t){this.__coreView__.registOperator(e,t)}setOperatorByID(e){this.__coreView__.setOperatorByID(e)}getCurrentOperator(){return this.__coreView__.controls.getOperator()}getCurrentOperatorID(){return this.__coreView__.getCurrentOperatorID()}setOperator(e){this.__coreView__.setOperator(e)}registCursor(e,t,i){this.__coreView__.registCursor(e,t,i)}hideSelectedObjects(){this.__coreView__.hideSelectedObjects()}getViewControlBoundingBox(){return this.__coreView__.controls.getBoundingBox()}setViewControlBoundingBox(e,t){this.__coreView__.controls.setBoundingBox(e,t)}setViewBoxDir(e){this.__coreView__.look({smoothTranslation:!1,useOrginal:!1,type:e})}getCamera(){return this.__coreView__.camera}setCameraControlBoundingBoxCenter(e){this.__coreView__.cameraControl.setBoundingBoxCenter(e)}setCameraControlBounding(e,t){this.__coreView__.cameraControl.setBoundingBox(e,t)}getRotateCenter(){return this.__coreView__.cameraControl.getRotateCenter()}setRotateCenter(e){this.__coreView__.cameraControl.setRotateCenter(e)}rotateToPlane(e){this.__coreView__.cameraControl.rotateToPlane(e)}getViewLockedState(){return this.__coreView__.cameraControl.isViewLockedBySingleBody}setViewLockedState(e){this.__coreView__.cameraControl.isViewLockedBySingleBody=e}getCameraInfo(){return this.__coreView__.cameraControl.getCameraInfo()}adjustNearAndFar(){this.__coreView__.cameraControl.adjustNearAndFar()}updateViewBoxCamDir(){this.__coreView__.cameraControl.updateViewBoxCamDir()}startSmoothTranslation(e){this.__coreView__.cameraControl.startSmoothTranslation(e)}zoomExtents(e,t,i){this.__coreView__.cameraControl.zoomExtents(e,t,i)}setCameraInfo(e,t){this.__coreView__.cameraControl.setCameraInfo(e,t)}getOrginalCameraInfo(){return(this.__coreView__.viewManager||this.__coreView__.camera).getOrginalCameraInfo()}setOrginalCameraInfo(e,t,i){this.__coreView__.camera.setOrginalCameraInfo({center:e,up:t,position:i})}toPerspectiveCamera(){this.__coreView__.toPerspectiveCamera()}toOrthographicCamera(){this.__coreView__.toOrthographicCamera()}updateGroundTransform(e,t,i){return this.__coreView__.groundShadow.updateGroundTransform(e,t,i)}isRendererContainsClipPlanes(){return 0<this.__coreView__.renderer.clippingPlanes.length}getCanvas2D(){return this.__coreView__.canvas2D}getCanvas3D(){return this.__coreView__.canvas3D}getContainer(){return this.__coreView__.container}getRenderDomElement(){return this.__coreView__.renderer.domElement}getAdditionalObjectsScene(){return this.__coreView__.additionalObjectsScene}getDispalyModelUnit(e,t){return this.__coreView__.getDispalyModelUnit(e,t)}modelCoordToClientCoord(e){return this.__coreView__.modelCoordToClientCoord(e)}clientCoordToModelCoord(e){return this.__coreView__.clientCoordToModelCoord(e)}showObject(e,t,i,r=!0){this.__coreView__.showObject(e,t,i,r)}showObjectReversed(e){this.__coreView__.showObjectReversed(e)}renderAllViews(){this.__coreView__.renderAllViews()}render(e){this.__coreView__.render(e)}setRenderMode(e,t){this.__coreView__.setRenderMode(e,t)}getRenderMode(){let e=void 0;switch(this.__coreView__.getRenderMode()){case 0:e="lighting";break;case 1:e="primarycolor";break;case 2:e="wireframe";break;case 3:e="whitemold";break;case 4:e="shadedWithEdges";break;case 5:e="shaded";break;case 6:e="hiddenLineRemove";break;case 7:e="hiddenLineVisible";break;case 8:e="transparent"}return e}getAssemblyPMIState(){return this.__coreView__.AssemblyPMIState}setAssemblyPMIState(e){this.__coreView__.AssemblyPMIState=e}getPartPMIState(){return this.__coreView__.PartPMIState}setPartPMIState(e){this.__coreView__.PartPMIState=e}getPmiVisible(){return this.__coreView__.pmiVisible}setPmiVisible(e){this.__coreView__.pmiVisible=e}setPMIObjectVisible(e,t){this.__coreView__.setPMIObjectVisible(e,t)}isPMIOccludeByModel(){return!NDSWebViewer.SETTING.StopPMIOcclusion}enablePMIOccludeByModel(e){this.__coreView__.stopPMIOcclusion(!e)}getPmiList(){return this.__coreView__.PMINDSBodys}getPMIObjectByUUID(e,t=-1){return this.__coreView__.getPMIObjectByuuid(e,t)}isPMIObjectOrSomeChildHidden(e){return this.__coreView__.isPMIObjectOrSomeChildHidden(e)}getPmiObjectTree(){return this.__coreView__.pmiObject}getSelectedPmiList(){return this.__coreView__.getPMINDSBodySelectList()}selectPMIObject(e,t=!0){this.__coreView__.selectPMIObject(e,t)}deselectPMIObject(e,t=!0){this.__coreView__.deselectPMIObject(e,t)}unmergeBodyNode(){this.__coreView__.ndsModel.unmergeNode()}mergeBodyNode(){this.__coreView__.ndsModel.mergeNode()}getAllTransparentBodies(e){return this.__coreView__.ndsModel.getAllTransparentBodies(e)}isolateBodiesOnly(e){this.__coreView__.ndsModel.isolateBodiesOnly(e)}clearTransparentModeBodiesMap(){this.__coreView__.ndsModel.transparentModeBodiesMap.clear()}unloadModelById(e){this.__coreView__.ndsModel.unloadModelById(e)}unloadModelByModelId(e){this.__coreView__.unloadModelById(e)}startLoadAnimationModel(e){var t=e.url,i=e.id,r={needsPMI:!1,needsAnimation:!1,needsSketchModel:!1,needsBRep:e.needsBRep,position:e.position,pmiVisible:this.__coreView__.pmiVisible,modelId:e.modelId};this.__coreView__.ndsModel.setGlobalObjectId&&this.__coreView__.ndsModel.setGlobalObjectId(0),e.singleHTML?this.__coreView__.loadModelFlate(t,r):this.__coreView__.loadModel(i,t,null,null,"js",null,null,null,r)}getBodyNodeFromUuid(t,e=-1){var i=null;return 0<=e?(e=this.getModelById(e))&&(e=e.getBodyNodeFromUuid(t))&&(i=e):this.__coreView__.ndsModel.models.forEach(e=>{e=e.getBodyNodeFromUuid(t);e&&(i=e)}),i}loadBrepInfo(e){this.__coreView__.loadBrepInfo(e)}clearBrepEdgesPoints(){this.__coreView__.clearBrepEdgesPoints()}enableTransparent(e){this.__coreView__.enableTransparent(e)}selectObjectByIds(e,t,i=[]){this.__coreView__.addSelectList(e,t,!1,i)}getObjectWorldMatrixAndMatrixByIds(t,i=[]){var r={};for(let e=0;e<t.length;e++){var n=t[e],n=(i[e]&&0<i[e]&&this.__coreView__.setActiveModelByModelId(i[e]),this.__coreView__.getObjectWorldMatrixAndMatrixByIds([n]));Object.assign(r,n)}return r}setObjectWorldMatrixById(e,t,i=-1){-1!=i&&this.__coreView__.setActiveModelByModelId(i),this.__coreView__.setObjectWorldMatrixById(e,t)}loadModel(e,t){this.__coreView__.loadModel("idv",e,null,null,"js",null,null,null,t)}getScreenCapture(e){this.__coreView__.getScreenCapturethumbnail(e)}computeBoundingBox(e,t,i,r){this.__coreView__.computeBoundingBox(e,t,i,r)}setGlobalModelId(e){this.__coreView__.ndsModel.setGlobalModelId(e)}isBodyAllChildHidden(e){return this.__coreView__.ndsModel.isBodyAllChildHidden(e)}enableRotation(e){this.__coreView__.enableRotation(e)}getBodyTranslate(e){return this.__coreView__.ndsModel.getBodyTranslate(e)}getBodyBoundingBox(e){return this.__coreView__.ndsModel.getBodyBoundingBox(e)}updateNodeMatrix(e,t,i){this.__coreView__.ndsModel.updateNodeMatrix(e,t,i)}}class te{constructor(e){this.__meshstate__=e}getMeshMaterial(e){return this.__meshstate__.getMeshMaterial(e)}setMeshMaterial(e,t){this.__meshstate__.setMeshMaterial(e,t)}setMeshMaterialTemporary(e,t){var i,e=this.__meshstate__.meshMtls.get(e);e&&(i=e.material,e.material=t,this.__meshstate__.__updateMeshMtlBuffer(e.meshMtlIndex,e),this.__meshstate__.meshMtlTexture.needsUpdate=!0,e.material=i,e.meshSet.needsUpdate=!0,e.meshSet.prepareForBatchDraw())}setMeshMaterialTemporaryUpdate(e,t){var i,e=this.__meshstate__.meshMtls.get(e);e&&(i=e.material,e.material=t,this.__meshstate__.__updateMeshMtlBuffer(e.meshMtlIndex,e),this.__meshstate__.meshMtlTexture.needsUpdate=!0,e.material=i,e.meshSet.needsUpdate=!0)}meshSetUpdate(e){e.prepareForBatchDraw()}getLineMaterial(e){this.__meshstate__.getLineMaterial(e)}setLineMaterial(e,t,i){this.__meshstate__.setLineMaterial(e,t,i)}setLineMaterialTemporary(e,t,i){var e=this.__meshstate__.lineMtls.get(e);e&&(e=2*e.lineMtlIndex,this.__meshstate__.lineMtlBuffer[e]=t,this.__meshstate__.lineMtlBuffer[1+e]=Math.round(1e3*i),this.__meshstate__.lineMtlTexture.needsUpdate=!0)}}class ie{constructor(e){this.__brepManager__=e}get brepInfos(){return this.__brepManager__.brepInfos}hasBrepInfo(){return this.__brepManager__.hasBrepInfo()}hasBrepFile(){return this.__brepManager__.hasBrepFile()}}class E{constructor(e){(this.__ndsModel__=e).meshState&&(this.__meshState__=new te(e.meshState)),e.brepManager&&(this.__brepManager__=new ie(e.brepManager))}get isMCAD3DModel(){return this.__ndsModel__.isMCAD3DModel}get isMCAD2DModel(){return this.__ndsModel__.isMCAD2DModel}get typeName(){return this.__ndsModel__.typeName}get ndsModelId(){return this.__ndsModel__.id}get numMesh(){}getMeshState(){return this.__meshState__}getBrepManager(){return this.__brepManager__}getPMIObject(){return this.__ndsModel__.pmiObject}getRootBodyNode(){return this.__ndsModel__.rootBodyNode}getBodyNode(e){return this.__ndsModel__.getBodyNode(e)}getLeafBodies(e){return this.__ndsModel__.getLeafBodies(e)}isSketchModel(){return!!this.__ndsModel__.isSketchModel}getLeafBodyNodes(){return this.__ndsModel__.wholeLeafBodyNodes}transparentizeBodies(e){this.__ndsModel__.transparentizeBodies(e)}isolateBodies(e){this.__ndsModel__.isolateBodies(e,NDSWebViewer.SETTING.bodyOpacity,NDSWebViewer.SETTING.lineOpacity)}clearTransparentBodies(){this.__ndsModel__.exitIsolate()}getMeshSets(){return this.__ndsModel__.getMeshSets()}changeObjectidTouuid(e){return this.__ndsModel__.objectidTouuid[e]}getMeshMaterial(e){return this.__ndsModel__?(e=this.__ndsModel__.meshManager.materialId[e],e=this.__ndsModel__.meshManager.materialUuids[e],this.__ndsModel__.meshManager.materials[e].mat):null}setMeshMaterial(e,t){if(!this.__ndsModel__)return!1;var i=this.__ndsModel__;let r=0;if(i.meshManager.materials[t.uuid]){for(let e=0;e<i.meshManager.materialUuids.length;e++)if(i.meshManager.materialUuids[e]===t.uuid){r=e;break}}else i.meshManager.materials[t.uuid]={mat:t,refCount:0},r=i.meshManager.materialUuids.length,i.meshManager.materialUuids.push(t.uuid);var n=i.meshManager.materialId[e],n=i.meshManager.materialUuids[n];return i.meshManager.materials[n].refCount--,i.meshManager.materials[t.uuid].refCount++,i.meshManager.materialId[e]=r,i.meshManager.materialIdOriginal[e]=r,!0}removeAllBodyNodeMaterials(){this.__ndsModel__.removeAllBodyNodeMaterials()}removeBodyNodeMaterial(e){this.__ndsModel__.removeBodyNodeMaterial(e)}refreshBodyWorldMatrixUniforms(){this.__ndsModel__.refreshBodyWorldMatrixUniforms()}refreshMeshState(e=void 0){this.__ndsModel__.refreshMeshState(e||this.__ndsModel__.rootBodyNode)}}class re{constructor(e){this.__selectionManager__=e.selectionManager}getSelectedObjects(){return this.__selectionManager__.getSelectedObjects()}getSelectedleafObjects(){return this.__selectionManager__.getSelectedleafObjects()}getSelectedMeshes(){return this.__selectionManager__.getSelectedMeshes()}clearSelection(){this.__selectionManager__.clearSelection()}setSelectType(e){this.__selectionManager__.setSelectType(e)}selectByClick(e,t,i){this.__selectionManager__.selectByClick(e,t,i)}selectObject(e,t,i){this.__selectionManager__.selectObject(e,t,i)}deselectObject(e,t){this.__selectionManager__.deselectObject(e,t)}}class U{static getBodyNodes(e){return e.bodyNodes}static updateMeshSetRenderMode(e,t,i){return e.updateMeshSetRenderMode(t,i)}static containsBodyNode(e,t){return e.containsBodyNode(t)}static getRenderMode(e){return e.renderMode}static setRenderMode(e,t){e.renderMode=t}}t=new class extends n{constructor(){super(),this.name="NDSAnimationExtension",console.log("NDSAnimationExtension version 2.0.1");var I,y=[],w=!1,B=[],a=[],r=(this.animationScene=new THREE.Group,this.node_animations=new Map,this.composited_animations=[],this.animationFinish=!1,this.initLables=!1,new THREE.Clock),n=new THREE.AnimationMixer(this.animationScene),o=null,i=0,k=!1,D=this,s=THREE.LoopOnce,C=1,l=1,d=(this._animationData={},this.activeAnimationID="",this.fromViewer=!0,this._isCadViewer=!0,this.relativePath="",0);let h=void 0;this.originalFileMap=new Map,this.playlistMap=new Map,this.activeAudio=null,this.imageLabelsMap=new Map,this.textLabelsMap=new Map,this.textIdLabelsMap=new Map,this.id2showHideStatusMap=new Map,this.unExistMap=new Map,this.renderMap=new Map,this.fileurlMap=new Map,this.defaluHideMap=new Map,this.stepMap=new Map,this.stepNodeMap=new Map,this.stepTimeMap=new Map,this.selectedHideTreeBody=[],this._defaultRootUUID=[],this.prepareLoadModels=[],this.modelWraperMap=new Map,this.meshId2MaterialMap=new Map,this.defaultNdsModelId=0,this.animation2BBoxMap=new Map,this.zip=null,this._binaryData=new Map,this.ndsModels=[],this.sketchModelId=-1,this._modelUpDirection=null,this.allAnnoLabel=[],this.textOpacityTracksDataMap=new Map,this.multiRotationTracksDataMap=new Map,this.traTracksDataMap=new Map,this.effectTracksDataMap=new Map,this._enableAnimation=!1,this.loadingModel=!1,this.initAnimationLoaded=!1,this.animationId2Scene=new Map,this.keyMay=new Map,this.trackDataMap=new Map,this.oldSelectType="",this.AnimationStart=(t=0,i)=>{if(Number.isInteger(t)||(t=0),i)for(let e=0;e<B.length;e++)B[e].animationID==i&&(t=e,I=B[e]);else I=B[t];var e;t>a.length-1||(k=!0,w&&(o&&n&&(n.uncacheAction(o),o=null),(e=a[t]).resetDuration(),n=new THREE.AnimationMixer(I),o=n.clipAction(e),s==THREE.LoopOnce||s==THREE.LoopRepeat||s==THREE.LoopPingPong?o.loop=s:2203!=s&&2204!=s&&2205!=s||(o.setLoop(THREE.LoopOnce).clampWhenFinished=!0),o.timeScale=C,w=!1,n.addEventListener("finished",function(e){D.dispatchEvent({type:"animationfinished",event:e}),D.animationFinish=!0,l=1}),n.addEventListener("loop",function(e){D.dispatchEvent({type:"animationloop",event:e}),2202==o.loop&&l++,D.activeAudio&&(D.activeAudio.howl.stop(),D.activeAudio=null)})),o.time=d,this.setViewerPlayTick(!0),d=0,o.play(),r.start(),this.animationFinish=!1,this.staticAnnotation&&this.staticAnnotation.SetEnableMove(!1),this.sceneWraper.render())},this.getAnimations=function(){var i=[];return B.forEach((e,t)=>{i[t]=e.name}),i},this.clearAnimations=function(){n.stopAllAction(),a.forEach(e=>{n.uncacheClip(e)}),I&&n.uncacheRoot(I),B=[],a=[],w=!(I=o=null),this._animationData={},y=[],this.node_animations.clear(),this.activeAudio=null,this.originalCameraInfo=null,this.staticAnnotation=null,this._binaryData.clear(),this.zip=null,this.ndsModels=[],this.defaluHideMap.clear(),this.traTracksDataMap.clear(),this.effectTracksDataMap.clear(),this.multiRotationTracksDataMap.clear(),this.textOpacityTracksDataMap.clear(),this.keyMay.clear(),this.trackDataMap.clear()},this.AnimationStop=()=>{var e;r.stop(),k=!1,I&&(this.activeAudio&&(this.activeAudio.howl.stop(),this.activeAudio=null),o&&(e=R(this.playlistMap,o.time,I.animationID))&&e.howl.stop(),l=1,w=!(d=0),this.staticAnnotation&&this.staticAnnotation.SetEnableMove(!0),this.sceneWraper.render())},this.AnimationPause=()=>{var e;r.stop(),k=!1,this.activeAudio&&(this.activeAudio.howl.stop(),this.activeAudio=null),o&&(e=R(this.playlistMap,o.time,I.animationID))&&e.howl.playing()&&e.howl.stop(),this.staticAnnotation&&this.staticAnnotation.SetEnableMove(!0),this.sceneWraper.render()},this.AnimationContinue=()=>{this.setViewerPlayTick(!0),d&&o&&(o.time=d,d=0),this.activeAudio&&(this.activeAudio.howl.stop(),this.activeAudio=null),r.start(),k=!0,this.staticAnnotation&&this.staticAnnotation.SetEnableMove(!1),this.sceneWraper.render()},this.clearAudio=()=>{var e;this.activeAudio&&this.activeAudio.howl.stop(),this.activeAudio=null,o&&(e=R(this.playlistMap,o.time,I.animationID))&&e.howl.playing()&&e.howl.stop()},this.isrunning=()=>k,this.isFinished=()=>this.animationFinish,this.getCurrentTime=()=>o?o.time:i,this.setTimeScale=e=>{C=e,o&&(o.timeScale=C),o&&(e=R(this.playlistMap,o.time,I.animationID))&&e.howl.rate(C),w=!0,this.sceneWraper.render()},this.setLoopType=e=>{2!=e&&(l=1),s=e+THREE.LoopOnce,o&&(s==THREE.LoopOnce||s==THREE.LoopRepeat||s==THREE.LoopPingPong?o.loop=s:2203!=s&&2204!=s&&2205!=s||(o.setLoop(THREE.LoopOnce).clampWhenFinished=!0,this.fromViewer&&this.setViewerPlayTick())),w=!0,this.sceneWraper.render()},this.getLoopTime=e=>e>a.length-1?-1:B[e].loopTime,this.getLoopTimeByAnimationID=t=>{var e=B.find(e=>e.animationID==t);return e?e.loopTime:0},this.addLabels=function(e){var i,r,n,t,a,o,s,l;if(!this.initLables&&(this.initLables=!0,e.textLabels&&e.textLabels.length&&this.staticAnnotation&&(t=e.textLabels,t=t,i=this.textLabelsMap,r=this,n=!1,Array.isArray(t))&&t.length&&r.staticAnnotation&&t.forEach(e=>{var t;i.has(e.id)||(t={...e,interPnt:(new THREE.Vector3).fromArray(e.interPnt),projPt:(new THREE.Vector3).fromArray(e.projPt)},i.set(e.id,t),t=i.get(e.id),r.staticAnnotation.setNoteAnnotation(t),r.staticAnnotation.setPicTextVisible(e.id,!!n))}),e.imageLabels&&e.imageLabels.length&&this.staticAnnotation&&(t=e.imageLabels,a=t,o=this.imageLabelsMap,s=this,l=!1,Array.isArray(a))&&a.length&&s.staticAnnotation&&a.forEach(e=>{o.has(e.id)||(o.set(e.id,e),s.staticAnnotation.setPicAnnotation(e),s.staticAnnotation.setPicTextVisible(e.id,!!l))}),e.textIdLabels&&e.textIdLabels.length)){var d=e.textIdLabels,h=this.textIdLabelsMap,u=this,c=!1;if(Array.isArray(d)&&d.length){u.textAnimationOp("init",u),u.textAnimationOp("setData",d,!1);for(let e=0;e<d.length;e++){var p=d[e];h.has(p.id)||h.set(p.id,p),u.textAnimationOp("setTextPointShow",p.id,!!c),c&&u.textAnimationOp("setFontHeight",p.id,p.style.height)}}}},this.switchAnnimation=async t=>{this._switchIns=!0,this.activeAnimationID=t,this.resetAnimationState(),this.animation2BBoxMap.has(t)&&(this._setModelShowHideStatus(t),this._changeBodyPosition(t),e=this.animation2BBoxMap.get(t),this.sceneWraper.setViewControlBoundingBox(e.min,e.max),this.checkTime0Camera(t)),await this.resetAnimationModel(t),this.setSelectType(),this.animationMorphAttri&&0<this.animationMorphAttri.length&&this.addMorphAnimation(this.animationData,this.animationMorphAttri);var e=this.animationData.animations.find(e=>e.animationID==t);e.isNDSAnimation?this.addNDSAnimation(e):this.addAnimation(e,D.animationData);for(let e=0;e<B.length;e++)if(B[e].animationID==t){I=B[e];break}e=function(e,r){var t=e.ndsModels||T(e);let n=e.unExistMap,a=e.sceneWraper,o=new THREE.Box3;return t.forEach((t,e)=>{let i=[];0!=e&&t.animationId!=r||t.rootBodyNode&&(n&&n.has(""+t.id)&&n.get(""+t.id).forEach(e=>{var e=t.objectidTouuid[e];e&&(e=a.getBodyNodeFromUuid(e),O.getLeafBodyNodes(e).forEach(e=>{i.push(e.objectid)}))}),e=O.getLeafBodyNodes(t.rootBodyNode))&&e.forEach(e=>{if(i.includes(e.objectid))return!0;e=t.getBodyBoundingBox(e);e&&o.union(e)})}),o}(D,t);D.sceneWraper.setViewControlBoundingBox(e.min,e.max),D.sceneWraper.switchRotateCenterBySelection(),D.changeBodyByTime(0),D.playTick=this.getNextStepTick({time:0,update:!0}),D.dispatchAsyncEvent({type:"animationInstanceLoadEnd",animationID:t})},this.preparAnimationFile=t=>{if(t.models&&0<t.models.length)for(let e=0;e<t.models.length;e++){var i,r=t.models[e];0!=r.modelId&&r.animationId&&(r=r.animationId,this.originalFileMap.has(r)||(i=A(t.models,r),this.originalFileMap.set(r,i)))}},this.resetAnimationModel=async e=>{let t="shaded";this.renderMap.has(e)&&(t=this.renderMap.get(e));var i=D.sceneWraper.getRenderMode(),r=("shaded"==t?"shaded"!=i&&D.sceneWraper.setRenderMode(t):"shadedWithEdges"==t&&"shadedWithEdges"==i||D.sceneWraper.setRenderMode(t),this.originalFileMap.get(e));if(this.originalFileMap.has(e)&&this.originalFileMap.delete(e),r&&0<r.length){var n=[];for(let e=0;e<r.length;e++){var a=r[e];0==a.modelId||this.sceneWraper.getModelById(a.modelId)||n.push(a)}0<n.length&&await this.addLoadAnimationFile(n)}},this.addLoadAnimationFile=async e=>{let t=await async function(t,i,r){var e=t.sceneWraper,n=[];let a=[],o=!1;try{for(let e=0;e<i.length;e++){var s=i[e];if(0==s.modelId)s.unload=!1;else{let e=null;if(NDSWebViewer.SETTING.singleHTML){try{var l=await H(t._binaryData,"string",s.url);e=JSON.parse(l)}catch(e){a.push(s),s.unload=!1;continue}e&&e.metadata?s.unload=!0:(a.push(s),s.unload=!1)}else{var d=await fetch(s.url);if(d.ok){try{e=await d.json()}catch(e){a.push(s),s.unload=!1;continue}e&&e.metadata||e.Metadata?s.unload=!0:(a.push(s),s.unload=!1)}else a.push(s),s.unload=!1}}n.push(s)}}catch(e){o=!0,console.info(":",e)}return n.forEach(e=>{r.push(e)}),0<a.length&&(o=!0,e.dispatchEvent({type:"AnimationFailedFiles",Modelfiles:a})),o}(D,e,this.prepareLoadModels);return new Promise(e=>{D.loadAnimationFileEnd=function(){D.loadingModel=!1,e()},t&&D.loadAnimationFileEnd()})},this.checkTime0Camera=e=>{this.changeCameraPosition(e,0,!0,!1)},this.recordMapInfo=t=>{this.animationId2Scene.clear();for(let e=0;e<t.tracks.length;e++){var i=t.tracks[e],r=(this.trackDataMap.set(i.trackID,i),this.animationId2Scene.has(i.animationID)||this.animationId2Scene.set(i.animationID,{uuid:"000",times:[1/0,-1/0],values:[1,1],uuids:new Set}),this.animationId2Scene.get(i.animationID)),n=(i.times[0]<r.times[0]&&(r.times[0]=i.times[0]),i.times[i.times.length-1]>r.times[1]&&(r.times[1]=i.times[i.times.length-1]),null!=i.ndsModelId?parseInt(i.ndsModelId):this.defaultNdsModelId),n=`${i.animationID}-${i.modelID[0]}-`+n;if(this.addKeyMap(i.animationID+"-"+i.trackType,i.trackID),1==i.trackType||4==i.trackType||5==i.trackType)r.uuids.add(n);else if(7==i.trackType)this.effectTracksDataMap.has(n)?this.effectTracksDataMap.get(n).push(i):this.effectTracksDataMap.set(n,[i]),r.uuids.add(n);else if(8==i.trackType)this.traTracksDataMap.has(n)?this.traTracksDataMap.get(n).push(i):this.traTracksDataMap.set(n,[i]),r.uuids.add(n);else if(9==i.trackType){if(i.times.length&&i.src.length){let e=!1;if(this.playlistMap.size)for(var[a,o]of this.playlistMap)0<=a.indexOf(String(i.animationID))&&(e=!0);e||function(n,a,o){a.src.forEach((e,t)=>{var i=a.srcKeys[t];let r={srcKey:i,src:o+e,howl:null};n.set(a.animationID+"-"+i,r),r.howl=new j.Howl({src:[o+e],html5:!0,usingWebAudio:!0,onplay:function(){console.log("")},onload:function(){var e=r.howl.duration();r.startTime=a.times[2*t],r.endTime=a.times[2*t]+e,r.duration=e},onend:function(){console.log("")},onloaderror:function(e,t){console.log("read load error:",e,t)},onplayerror:function(e,t){console.log("read play error:",e,t)}})})}(this.playlistMap,i,this.relativePath)}}else 11==i.trackType||12==i.trackType?this.textOpacityTracksDataMap.has(i.textImgId||i.textId)?this.textOpacityTracksDataMap.get(i.textImgId||i.textId).push(i):this.textOpacityTracksDataMap.set(i.textImgId||i.textId,[i]):14==i.trackType?this._defaultRootUUID.includes(i.htmlUUIDS[0])||this._defaultRootUUID.push(i.htmlUUIDS[0]):19==i.trackType&&(this.multiRotationTracksDataMap.has(n)?this.multiRotationTracksDataMap.get(n).push(i):this.multiRotationTracksDataMap.set(n,[i]),r.uuids.add(n))}this.allAnnoLabel=[],t.textLabels&&t.textLabels.length&&(this.allAnnoLabel=this.allAnnoLabel.concat(t.textLabels)),t.imageLabels&&t.imageLabels.length&&(this.allAnnoLabel=this.allAnnoLabel.concat(t.imageLabels)),t.textIdLabels&&t.textIdLabels.length&&(this.allAnnoLabel=this.allAnnoLabel.concat(t.textIdLabels))},this.addNDSAnimation=e=>{if(!B||!B.find(e=>e.animationID==this.activeAnimationID)){(I=new THREE.Group).animationID=e.animationID,I.name=e.name,I.isNDSAnimation=e.isNDSAnimation;var t=this.animationId2Scene.get(e.animationID),i,i=((i=new THREE.Mesh).uuid=t.uuid,I.add(i),new THREE.NumberKeyframeTrack(t.uuid+".material.opacity",t.times,t.values,null)),t;y.push(i),(t=new THREE.AnimationClip(e.name,y.length,y.concat())).resetDuration(),a.push(t),I.loopTime=t.duration;for(let e=0;e<B.length;e++)if(B[e].animationID==I.animationID){B[e]=I,I=null;break}I&&B.push(I),y=[],w=!(I=null)}this.dispatchEvent({type:"animationScenesEnd",animationID:D.activeAnimationID})},this.addAnimation=async(e,t)=>{if(!B||!B.find(e=>e.animationID==this.activeAnimationID)){(I=new THREE.Group).name=e.name,I.isNDSAnimation=e.isNDSAnimation,I.animationID=e.animationID;for(var i=0;i<e.tracks.length;++i){var r=e.tracks[i].trackID;t.tracks.forEach(function(e){e.trackID==r&&(1==e.trackType?D.addKeyFrameTrack(e,"position",e.times,e.translations):2==e.trackType?D.addKeyFrameTrack(e,"quaternion",e.times,e.rotations):3==e.trackType?D.addKeyFrameTrack(e,"scale",e.times,e.scales):4==e.trackType?D.addKeyFrameTrack(e,"material.color",e.times,e.colors):5==e.trackType?D.addKeyFrameTrack(e,"material.opacity",e.times,e.opacities):10==e.trackType&&e.morphTargetInfluences&&e.morphTargetInfluences.length&&D.addKeyFrameTrack(e,"morphTargetInfluences",e.times,e.morphTargetInfluences))})}var n=new THREE.AnimationClip(e.name,y.length,y.concat());n.resetDuration(),a.push(n),I.loopTime=n.duration;for(let e=0;e<B.length;e++)if(B[e].animationID==I.animationID){B[e]=I,I=null;break}I&&B.push(I),y=[],w=!(I=null)}this.dispatchEvent({type:"animationScenesEnd",animationID:D.activeAnimationID})},this.addMorphAnimation=(t,n)=>{let a=this;this.oldHideLeafBody&&this.sceneWraper.unmergeBodyNode();var i=new Map;for(let e=0;e<t.tracks.length;e++){var r=t.tracks[e];if(r.deformation){var o=r.modelID[0],o=a.sceneWraper.getBodyNodeFromUuid(o,0);if(!o)return;o=O.getLeafBodyNodes(o),o=O.getMeshesInLeafBodyNode(o[0]);if(o&&o.length){var o=o[0],s=[];let e=[];var l=r.deformation;for(let t=0;t<l.length;t++){e=e.concat(l[t].targetShapeIds);for(let e=0;e<l[t].targetShapeIds.length;e++)s.push(l[t].frames[e])}i.set(o,e),r.morphTargetInfluences=[];for(let t=0;t<r.times.length;t++)for(let e=0;e<s.length;e++)r.morphTargetInfluences.push(s[e][t])}}}i.forEach(function(t,e){e=a.sceneWraper.getActiveModel().meshManager.geomId[e];if(-1<e){var i=a.sceneWraper.getActiveModel().geomManager.getGeomFromId(e);i.morphAttributes.position=[];for(let e=0;e<t.length;e++)i.morphAttributes.position.push(new THREE.BufferAttribute(n[t[e]].position,3));var r=[];for(let e=0;e<t.length;e++)r.push(new THREE.BufferAttribute(n[t[e]].normal,3));0<r.length&&(i.morphAttributes.normal=r)}})},this.addKeyFrameTrack=(o,t,i,r,n)=>{let s=o.ndsModelId?parseInt(o.ndsModelId):this.defaultNdsModelId;var a=o.modelID[0],e=this.sceneWraper.getModelById(s);if(e){if(!this.node_animations.has(a+"-"+s)){var l=D.sceneWraper.getBodyNodeFromUuid(a,s);if(!l)return;this.node_animations.set(a+"-"+s,{bodyNode:l,oriWorldMatrix:O.getMatrixWorld(l)?O.getMatrixWorld(l).clone():e.calculateNodeWorldMatrix(l)});for(var d=O.getLeafBodyNodes(l),h=0,u=d.length;h<u;h++)O.isLeafBodyNode(d[h])&&this.node_animations.set(d[h].uuid+"-"+s,{bodyNode:d[h],oriWorldMatrix:O.getMatrixWorld(d[h])?O.getMatrixWorld(d[h]).clone():e.calculateNodeWorldMatrix(d[h])})}var c,p,f,m,_,g,l=this.node_animations.get(a+"-"+s);I.getObjectByProperty("uuid",a+"-"+s)||(c=D.sceneWraper.getBodyNodeFromUuid(a,s),(p=new THREE.Group).uuid=c.uuid+"-"+s,p.applyMatrix(l.oriWorldMatrix),f=function(t,i){for(let e=0;e<t.children.length;e++){var r,n,a=t.children[e];O.isLeafBodyNode(a)?((r=new THREE.Object3D).isMesh=!0,r.ndsModelId=s,r.uuid=a.uuid+"-"+s,a.matrix&&(r.matrix.fromArray(a.matrix),r.matrix.decompose(r.position,r.quaternion,r.scale)),(n=O.getMeshesInLeafBodyNode(a)).length&&(n=x(D.modelWraperMap,a).getMeshMaterial(n[0]),r.material=n.material&&n.material.clone()),r.animationID=o.animationID,i.add(r)):((n=new THREE.Group).uuid=a.uuid,a.matrix&&(n.matrix.fromArray(a.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),i.add(n),0<a.children.length&&f(a,n))}},0==c.children.length?((m=new THREE.Mesh).isMesh=!0,m.uuid=c.uuid+"-"+s,m.ndsModelId=s,O.isLeafBodyNode(c)&&((_=O.getMeshesInLeafBodyNode(c)).length&&(g=x(D.modelWraperMap,c).getMeshMaterial(_[0]),m.material=g.material&&g.material.clone()),-1<(g=e.meshManager.geomId[_[0]])&&(m.geometry=e.geomManager.getGeomFromId(g),m.updateMorphTargets(),m.geometry.aniMorphInfluences=m.morphTargetInfluences,m.geometry.aniMorphDictionary=m.morphTargetDictionary),m.animationID=o.animationID,m.applyMatrix(l.oriWorldMatrix),I.add(m))):(f(c,p),I.add(p)),I.updateMatrixWorld(!0));try{let e=null;"position"===t||"scale"===t?e=new THREE.VectorKeyframeTrack(`${a}-${s}.`+t,i,r,n):"quaternion"===t?e=new THREE.QuaternionKeyframeTrack(`${a}-${s}.`+t,i,r,n):"material.color"===t?e=new THREE.ColorKeyframeTrack(`${a}-${s}.`+t,i,r,n):"material.opacity"!==t&&"morphTargetInfluences"!==t||(e=new THREE.NumberKeyframeTrack(`${a}-${s}.`+t,i,r,n)),y.push(e),w=!0}catch(e){console.log("addKeyFrameTrack-error:",e)}}},this.update=()=>{if(NDSWebViewer.SETTING.AnimationEdit&&!k&&this.sceneWraper.render({forceRenderAll:!0}),k&&I){var e,t=r.getDelta();if(t=.2<t?.001:t,n&&n.update(t),o){if(s==THREE.LoopOnce||s==THREE.LoopRepeat||s==THREE.LoopPingPong){let e=l%2==0?I.loopTime-o.time:o.time;h=void 0,s==THREE.LoopPingPong&&(h=e),this.dispatchEvent({type:"animationTime",time:o.time%I.loopTime,actureTime:h}),I.updateMatrixWorld(!0),this.changeBodyByTime(e)}else 2203!=s&&2204!=s&&2205!=s||(NDSWebViewer.SETTING.animationTool||this.onTimeChanged(),this.dispatchEvent({type:"animationTime",time:o.time}),e=o.time,I.updateMatrixWorld(!0),this.changeBodyByTime(e));this.animationFinish&&s==THREE.LoopOnce&&(this.AnimationStop(),this.resetAnimationStartTime(0),this.dispatchEvent({type:"animationTime",time:0}),this.changeBodyByTime(0)),this.sceneWraper.render({forceRenderAll:!0})}}},this.getTimeInStep=e=>{var t=-1;return t=this.stepTimeMap.has(String(this.activeAnimationID))?_(e,this.stepTimeMap.get(String(this.activeAnimationID)).ascTimes):t},this.getTimeInStep2=e=>{var t,i={curStep:-1,firstStep:-1,lastStep:-1};return this.stepTimeMap.has(String(this.activeAnimationID))&&(t=this.stepTimeMap.get(String(this.activeAnimationID)),i.curStep=_(e,t.ascTimes),e=t.orderTimes,i.firstStep=e[0],i.lastStep=e[e.length-1]),i},this.resetAnimationStartTime=e=>{i=d=e,o&&(o.time=e)},this.changeBodyByTime=function(t){if(this.activeAnimationID&&(!I||I.animationID!=this.activeAnimationID))for(let e=0;e<B.length;e++)B[e].animationID==this.activeAnimationID&&(I=B[e]);if(I)if(I.isNDSAnimation){var i,e={uuids:this._defaultRootUUID||[],imageLabelsMap:this.imageLabelsMap,textLabelsMap:this.textLabelsMap,textIdLabelsMap:this.textIdLabelsMap,id2showHideStatusMap:this.id2showHideStatusMap,time:t,selectedHideTreeBody:this.selectedHideTreeBody,unExistMap:this.unExistMap},r=this,n=I.animationID,a=void 0,{imageLabelsMap:o,textLabelsMap:s,id2showHideStatusMap:l,AnimationEdit:d,time:h,textIdLabelsMap:u}=e,c=r.sceneWraper,p=r.staticAnnotation,f=(L(r,e,n),r.trackDataMap);if(!a){if(p){let t=[],i=[];for(var[m,_]of o)_.animationID==n&&(_=`${n}-${m}-15`,(_=f.get(_))?(_=P(_,h),l.set(m,_),d?d.setImageVisible(m,_,!1):p.setPicTextVisible(m,_),_||i.push(m)):(l.set(m,!0),p.setPicTextVisible(m,!0)));for(var[g,y]of s)y.animationID==n&&(y=`${n}-${g}-15`,(y=f.get(y))?(y=P(y,h),l.set(g,y),d?d.setTextVisible(g,y,!1):p.setPicTextVisible(g,y),y||i.push(g)):(l.set(g,!0),p.setPicTextVisible(g,!0)));p&&(p.selectIDs.length?p.selectIDs.forEach(e=>{i.includes(e)||t.push(e)}):(p.selectID&&!i.includes(p.selectID)&&t.push(p.selectID),p.picSelectID&&!i.includes(p.picSelectID)&&t.push(p.picSelectID))),p.setSelectIdArray(t)}for(var[w,v]of u)v.animationID==n&&(v=`${n}-${w}-16`,(v=f.get(v))?(v=P(v,h),l.set(w,v),r.textAnimationOp("setTextPointShow",w,v),v||(r.textAnimationOp("_changeTextareaStatus",w,"default"),c.dispatchEvent({type:"updatePropPanel"}))):(l.set(w,!0),r.textAnimationOp("setTextPointShow",w,!0)),v=r.textAnimationOp("getTextPointDataById",w),r.textAnimationOp("setFontHeight",w,v.style.height))}for(i of this.animationId2Scene.get(I.animationID).uuids){var b=i.split("-"),x=b[1],b=parseInt(b[2]),T=D.sceneWraper.getModelById(b),x=D.sceneWraper.getBodyNodeFromUuid(x,b);if(x&&x.visible){D.changeBodyPosition(I.animationID,x,i,t);var A=`${I.animationID}-${x.uuid}-${b}-4`,A=this.trackDataMap.get(A);A&&(A=q(x,A,t))&&V(D,x,A);let e=[];A=`${I.animationID}-${x.uuid}-${b}-5`,b=this.trackDataMap.get(A),A=(b&&e.push(b),D.effectTracksDataMap.get(i));(e=A&&A.length?e.concat(A):e)&&e.length&&(b=Y(x,e,t),T.transparentBodyChanged=!0,W(D,x,b))}}z(D),F(D);for(let e=0;e<this.allAnnoLabel.length;e++){var M,S=this.allAnnoLabel[e],E=S.id;this.id2showHideStatusMap.get(E)&&S.animationID==I.animationID&&(M=I.animationID+`-${E}-17`,(M=this.trackDataMap.get(M))&&this.changeAnnoPosition(E,M,t),M=I.animationID+`-${E}-13`,(M=this.trackDataMap.get(M))&&"Pic"!=S.type&&this.changeAnnoColor(E,M,t),S=this.textOpacityTracksDataMap.get(E))&&S.length&&this.changeAnnoOpacity(E,S,t)}D.changeCameraPosition(I.animationID,t);e=R(this.playlistMap,t,I.animationID);!k||!e||this.activeAudio&&this.activeAudio.srcKey==e.srcKey||e.howl.playing()||(this.activeAudio&&this.activeAudio.howl.stop(),e.howl.seek(t-e.startTime),e.howl._rate!=C&&e.howl.rate(C),e.howl.play(),this.activeAudio=e)}else I.traverse(function(e){if(e.isMesh){var t=e.ndsModelId,i=e.uuid.split("-")[0],i=D.sceneWraper.getBodyNodeFromUuid(i,t);if(!i)return!0;O.setMatrixWorld(i,e.matrixWorld),e.material.color&&V(D,i,e.material.color),e.opacity&&W(D,i,e.opacity)}}),z(D),F(D)},this.changeCameraPosition=(()=>{let a=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3;return(e,t,i,r=!1)=>{var n=D.queryTracks(e,[6]),n=n.length&&K(D,n[0],t),n=(n&&n.position&&n.up?(this.camera.position.copy(n.position),this.camera.up.copy(n.up),this.camera.target.copy(n.target),this.camera.setCameraTarget(this.camera.getCameraTarget()),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(!0),this.sceneWraper.getViewBox()&&this.sceneWraper.updateViewBoxCamDir(),n.device&&n.projectionMatrixInverse&&(a.copy(n.device).applyMatrix4(n.projectionMatrixInverse).applyMatrix4(this.camera.matrixWorld),t=o.set(0,0,n.device.z).applyMatrix4(n.projectionMatrixInverse).applyMatrix4(this.camera.matrixWorld),n=s.copy(t).sub(a),this.camera.position.add(n),this.camera.target.add(n)),t={center:this.camera.target,up:this.camera.up,position:this.camera.position},this.sceneWraper.adjustNearAndFar(),this.sceneWraper.startSmoothTranslation(t)):i&&this.sceneWraper.zoomExtents(r,!1),NDSWebViewer.SETTING.AnimationEdit?this.sceneWraper.getBoundingBox():v(this,e));n.isEmpty()||(this.sceneWraper.setViewControlBoundingBox(n.min,n.max),this.sceneWraper.adjustNearAndFar())}})(),this.changeBodyPosition=(()=>{let d=new THREE.Matrix4,h=new THREE.Matrix4;return function(e,t,i,r){var n,a,o,s,l;t&&O.getMatrixWorld(t)&&(n=[],s=D.trackDataMap.get(i+"-1"),l=D.trackDataMap.get(i+"-2"),a=D.trackDataMap.get(i+"-3"),o=D.traTracksDataMap.get(i)||[],i=D.multiRotationTracksDataMap.get(i)||[],s&&l&&a&&n.push(s,l,a),s=$(n,o,i,r))&&(t._oriWorldMatrix||(t._oriWorldMatrix=O.getMatrixWorld(t).clone()),t.preChangeWorldMatrix?t.preChangeWorldMatrix.copy(O.getMatrixWorld(t)):t.preChangeWorldMatrix=O.getMatrixWorld(t).clone(),t.preChangeWorldMatrix&&(d.identity(),d.getInverse(t.preChangeWorldMatrix),d.premultiply(O.getMatrixWorld(t)),D.coreView.AnimationEdit)&&(l=O.getUUID(t)+"-"+O.getModelId(t),D.coreView.AnimationEdit.extension.translatePiovt(l,d),h.extractRotation(d),D.coreView.AnimationEdit.extension.rotateOnlyPiovt(l,h)),D._updateBodyNodeBox(t,s))}})(),this.unloadAnimationModel=()=>{var t,i,r,n,e,a,o,s;for(let e=this.ndsModels.length-1;0<e;e--)t=this,i=e,r=this.ndsModels[e].id,n=void 0,0!=i&&(n=t.sceneWraper,t.coreView.AnimationEdit&&t.coreView.AnimationEdit.deleteEdit(i),t.selectionManager.clearSelection(),n.unloadModelById(r),"OpBall"==n.getCurrentOperator().type)&&n.getCurrentOperator().startMove(),this.modelWraperMap.delete(this.ndsModels[e].id),this.ndsModels.splice(e,1);if(this.resetAnimationState(!0),this.oldHideLeafBody&&(D.sceneWraper.mergeBodyNode(),NDSWebViewer.SETTING.HideLeafBody=this.oldHideLeafBody,this.oldHideLeafBody=null),this.staticAnnotation){let t=[];this.staticAnnotation.TextContents.forEach(e=>{e.AnimationEdit&&t.push(e.id)}),this.staticAnnotation.PicContents.forEach(e=>{e.AnimationEdit&&t.push(e.id)}),this.staticAnnotation.deleteNoteAnnotation(t,!1),this.initLables=!1,this.textLabelsMap.clear(),this.imageLabelsMap.clear()}this.originalCameraInfo&&(a={center:this.originalCameraInfo.target.clone(),position:this.originalCameraInfo.position.clone(),up:this.originalCameraInfo.up.clone()},this.camera.setOrginalCameraInfo(a));let l=this.sceneWraper.getModelByIndex(0);if(delete l._loaded,l&&l.rootBodyNode&&(a=l.rootBodyNode.uuid+"-"+l.rootBodyNode.ndsModel.id,a=a,o=!0,e=(e=this).sceneWraper,0<(c=a.lastIndexOf("-")))&&(s=a.slice(0,c),a=parseInt(a.slice(c+1)),c=e.getModelById(a))&&(e=c.bodyUuid2NodeMap[s])&&(o?O.showBody(e):O.hideBody(e)),this.defaluHideMap.size)for(var[d,h]of this.defaluHideMap)if(h&&0<h.length)for(let e=h.length-1;0<=e;e--){var u=h[e];O.hideBody(u)}if(this.originalFileMap.clear(),this.fileurlMap.clear(),this.renderMap.clear(),-1!=this.sketchModelId){let e=this.sceneWraper.getModelById(6666);e&&(e.id=this.sketchModelId)}this._modelUpDirection&&(NDSWebViewer.SETTING.modelUpDirection=this._modelUpDirection,this._modelUpDirection=null),this._enableAnimation=!1,this.loadingModel=!1,this.viewer.modelRequestor&&this.viewer.modelRequestor.initRequest();var c=this.sceneWraper.getBoundingBox(!0);this.sceneWraper.setViewControlBoundingBox(c.min,c.max),this.sceneWraper.switchRotateCenterBySelection(),this.sceneWraper.zoomExtents(!0,!0),this.oldSelectType&&(this.coreView.selectionManager.setSelectType(this.oldSelectType),this.coreView.controls.getOperator().oldSelectType=this.oldSelectType,this.oldSelectType=""),this.sceneWraper.render()},this.resetAnimationState=(n=!1)=>{if(I){if(I.isNDSAnimation){var e;for(e of this.animationId2Scene.get(I.animationID).uuids){var t=e.split("-"),i=t[1],t=parseInt(t[2]),i=D.sceneWraper.getBodyNodeFromUuid(i,t);i&&(D.resetBodyState(i,i._oriWorldMatrix),n)&&i._oriWorldMatrix&&delete i._oriWorldMatrix}}else{for(let e=0,t=I.children.length;e<t;++e){var r=I.children[e],a=D.node_animations.get(r.uuid);r.matrix.copy(a.oriWorldMatrix),r.matrix.decompose(r.position,r.quaternion,r.scale)}I.updateMatrixWorld(!0),I.traverse(function(e){if(e.isMesh){var t,r=e.ndsModelId;let i=D.sceneWraper.getModelById(r);i&&(t=e.uuid.split("-")[0],t=D.sceneWraper.getBodyNodeFromUuid(t,r),D.resetBodyState(t,e.matrixWorld),n&&t._oriWorldMatrix&&delete t._oriWorldMatrix,O.getMeshesInLeafBodyNode(t).forEach(e=>{e=i.meshManager.geomId[e];if(-1<e){var t=i.meshManager.geomManager.getGeomFromId(e);if(t.updateModelMatrix=!0,t.refMeshesSameMaterial=!1,t.aniMorphInfluences)for(let e=0;e<t.aniMorphInfluences.length;e++)t.aniMorphInfluences[e]=0}}))}})}z(D),F(D);var o=this,s=!1,l=this.imageLabelsMap,d=this.textLabelsMap,h=this.textIdLabelsMap,u=o.staticAnnotation;if(u){var c=u.getallPicContent();if(Array.isArray(c))for(let e=0;e<c.length;e++){var p=c[e],p=(p.state||p).id;l.has(p)&&u.setPicTextVisible(p,s)}var f=u.getAllNoteContent();if(Array.isArray(f))for(let e=0;e<f.length;e++){var m=f[e],m=(m.state||m).id;d.has(m)&&u.setPicTextVisible(m,s)}}var _,g,y,w=o.textAnimationOp("getTextPointAllData");if(Array.isArray(w))for(let e=0;e<w.length;e++){var v=w[e],b=v.id;h.has(b)&&(o.textAnimationOp("setTextPointShow",b,s),s)&&o.textAnimationOp("setFontHeight",b,v.style.height)}if(D.originalCameraInfo&&(g=(_=D).originalCameraInfo)&&g.position&&g.up&&g.target&&(y=_.camera,_=_.sceneWraper,y.position.set(g.position.x,g.position.y,g.position.z),y.up.set(g.up.x,g.up.y,g.up.z),y.target.set(g.target.x,g.target.y,g.target.z),y.setCameraTarget(y.getCameraTarget()),_.adjustNearAndFar(),y.updateProjectionMatrix(),y.updateMatrixWorld(!0),_.getViewBox()&&_.updateViewBoxCamDir(),_.render()),D._isCadViewer)for(let e=1;e<this.ndsModels.length;e++){var x=this.ndsModels[e];x&&x.rootBodyNode&&O.hideBody(x.rootBodyNode)}}},this.resetBodyState=(e,t)=>{var i,r;e&&(e.preChangeWorldMatrix?e.preChangeWorldMatrix.copy(O.getMatrixWorld(e)):e.preChangeWorldMatrix=O.getMatrixWorld(e).clone(),D._updateBodyNodeBox(e,t),e.preChangeWorldMatrix&&((t=new THREE.Matrix4).getInverse(e.preChangeWorldMatrix),t.premultiply(O.getMatrixWorld(e)),D.coreView.AnimationEdit)&&(i=O.getUUID(e)+"-"+O.getModelId(e),D.coreView.AnimationEdit.extension.translatePiovt(i,t),(r=new THREE.Matrix4).extractRotation(t),D.coreView.AnimationEdit.extension.rotateOnlyPiovt(i,r)),W(D,e),V(D,e))},this._updateBodyNodeBox=(()=>{let n=new THREE.Matrix4,a=new THREE.Matrix4,o=new THREE.Matrix4,s=new THREE.Matrix4;return function(e,t){var i=O.getModel(e),r=e.parent?s.copy(O.getMatrixWorld(e.parent)):o;n.identity(),n.getInverse(r);r=(t?a.copy(t):a.copy(O.getMatrixWorld(e))).premultiply(n);i.updateNodeMatrix(O.getUUID(e),r.toArray(),e.getModel().id)}})(),this.textAnimationOp=(e,...t)=>{if(S[e])return S[e](...t)},this.setTextPointShow=(e,t)=>{var i=this.textIdLabelsMap.get(e);if(i&&(i.visible=t),S.setTextPointShow)return S.setTextPointShow(e,t)},this.getTextAnimationObject=()=>S,this.getAnimationScene=()=>B,this.getStepData=()=>this.stepMap,this.getNodeData=()=>this.stepNodeMap,this.getPlayTick=()=>(this.playTick||(this.playTick=this.getNextStepTick({time:0,update:!0})),this.playTick),this.getNextStepTick=e=>{var{time:e,update:t}=e;return!!this.stepTimeMap.has(String(this.activeAnimationID))&&(e=function(e){var t,i,r,n,{currentTime:e,orderTimes:a,ascTimes:o,loopTime:s}=e;return!(!a||!o||a.length<1)&&(i=a[0],r=a[a.length-1],(t={switchTime:-1,nextTime:-1,startTime:-1,curStep:-1,lastStep:-1,preTime:-1,nextEndTime:-1,firstStep:-1,nextStep:-1,afterSwitchStep:-1,finishStep:-1}).lastStep=r,t.firstStep=i,t.curStep=_(e,o),t.finishStep=_(s,o),-1==t.curStep?t.preTime=g(r,o):(e=-1,e=0<=(n=a.indexOf(t.curStep))-1?a[n-1]:r,t.preTime=g(e,o)),-1==t.curStep?(t.switchTime=i,t.startTime=g(i,o)):(t.switchTime=t.curStep,t.startTime=g(t.curStep,o)),t.afterSwitchStep=_(t.switchTime+.02,o),-1==t.curStep?(t.nextTime=g(i,o),t.nextStep=i):(s=-1,s=(n=a.indexOf(t.curStep))+1<=a.length-1?a[n+1]:i,t.nextStep=s,t.nextTime=g(s,o),t.nextEndTime=s),t)}({currentTime:e,orderTimes:(e=this.stepTimeMap.get(String(this.activeAnimationID))).orderTimes,ascTimes:e.ascTimes,loopTime:I?I.loopTime:0}),t&&(this.playTick=e),e)},this.pauseStepPlay=e=>{this.AnimationPause(),this.changeBodyByTime(e),this.resetAnimationStartTime(e),this.dispatchEvent({type:"animationTime",time:e,action:"pause"})},this.stopStepPlay=e=>{this.AnimationStop(),this.changeBodyByTime(e),this.resetAnimationStartTime(e),this.dispatchEvent({type:"animationTime",time:e,action:"stop"})},this.pauseORstopStepPlay=(e,t)=>{t?this.stopStepPlay(e):this.pauseStepPlay(e)},this.getChangeTick=()=>(this.changeTick||(this.changeTick={waitStop:!1,waitSwitch:!1,switchStep:-1,switchStepNext:-1,nextTime:-1}),this.changeTick),this.setChangeTick=e=>{this.getChangeTick();var{waitStop:e=!1,waitSwitch:t=!1,switchStep:i=-1,switchStepNext:r=-1,nextTime:n=-1}=e;this.changeTick.waitStop=e,this.changeTick.waitSwitch=t,this.changeTick.switchStep=i,this.changeTick.switchStepNext=r,this.changeTick.nextTime=n},this.onTimeChanged=()=>{var e,t,i,r,n;o&&(e=o.time,this.playTick||(this.playTick=this.getNextStepTick({time:e,update:!0})),t=this.playTick,this.getChangeTick(),2203==s?(i=this.changeTick.switchStep)<=e?(this.pauseORstopStepPlay(i,this.animationFinish),this.setChangeTick({waitStop:!1})):this.changeTick.waitStop&&this.animationFinish&&(this.stopStepPlay(i),this.setChangeTick({waitStop:!1})):2204==s?(i=!1,t.curStep==t.lastStep?(this.setChangeTick({waitStop:!0,nextTime:t.nextTime}),r=this.animationFinish&&t.lastStep-e<.1,(e>=t.lastStep||r)&&(this.setChangeTick({waitStop:!1}),this.pauseORstopStepPlay(t.nextTime,this.animationFinish),i=!0)):this.changeTick.waitStop&&t.curStep==t.firstStep?(r=this.changeTick.nextTime,this.pauseORstopStepPlay(r,this.animationFinish),this.setChangeTick({waitStop:!1}),i=!0):e>=t.switchTime?(r=this.changeTick.nextTime,n=!1,(n=t.curStep==this.changeTick.switchStep||this.changeTick.waitSwitch&&t.curStep==this.changeTick.switchStepNext?!0:n)&&(this.setChangeTick({waitSwitch:!1}),t.switchTime+.02!=r&&(this.clearAudio(),this.resetAnimationStartTime(r)),this.playTick=this.getNextStepTick({time:r,update:!0}),this.playTick.curStep==this.playTick.lastStep?this.setChangeTick({waitStop:!0,nextTime:this.playTick.nextTime}):r<this.playTick.switchTime&&this.setChangeTick({waitSwitch:!0,switchStep:this.playTick.switchTime,switchStepNext:this.playTick.afterSwitchStep,nextTime:this.playTick.nextTime}))):e<t.switchTime&&this.setChangeTick({waitSwitch:!0,switchStep:t.switchTime,switchStepNext:t.afterSwitchStep,nextTime:t.nextTime}),this.animationFinish&&!i&&(this.playTick.curStep==this.playTick.finishStep&&this.resetAnimationStartTime(this.playTick.nextTime),w=!0,this.clearAudio(),this.AnimationStart(-1,this.activeAnimationID))):2205==s&&(n=t.startTime,e>=t.switchTime&&(this.clearAudio(),this.resetAnimationStartTime(n)),this.animationFinish)&&(w=!0,l=1,this.resetAnimationStartTime(n),this.AnimationStart(-1,this.activeAnimationID)))},this.setViewerPlayTick=t=>{if(this.fromViewer&&o&&(2203==s||2204==s||2205==s)){this.setChangeTick({waitStop:!1,waitSwitch:!1});var i=o.time;let e=i;this.playTick=this.getNextStepTick({time:i,update:!0}),this.playTick&&-1==this.playTick.curStep&&(i=this.playTick.startTime,this.changeBodyByTime(i),this.resetAnimationStartTime(i),this.playTick=this.getNextStepTick({time:i,update:!0}),this.dispatchEvent({type:"animationTime",time:i}),e=i),(k||t)&&(2203==s?(i=this.playTick.nextTime,e==this.playTick.switchTime&&(this.resetAnimationStartTime(i),this.playTick=this.getNextStepTick({time:i,update:!0})),this.setChangeTick({waitStop:!0,switchStep:this.playTick.switchTime})):2204==s?(t=this.playTick.nextTime,e!=this.playTick.switchTime&&e!=this.playTick.lastStep||(this.resetAnimationStartTime(t),this.playTick=this.getNextStepTick({time:t,update:!0})),this.playTick.curStep==this.playTick.lastStep?this.setChangeTick({waitStop:!0,nextTime:this.playTick.nextTime}):(e<this.playTick.switchTime||t<this.playTick.switchTime)&&this.setChangeTick({waitSwitch:!0,switchStep:this.playTick.switchTime,switchStepNext:this.playTick.afterSwitchStep,nextTime:this.playTick.nextTime})):2205==s&&(i=this.playTick.startTime,e==this.playTick.switchTime)&&(this.resetAnimationStartTime(i),this.playTick=this.getNextStepTick({time:i,update:!0})))}},this.onAnimation=async e=>{this.viewer.modelRequestor&&this.viewer.modelRequestor.initRequest(),this._enableAnimation=!0,this._onAnimation();var i,t=this.sceneWraper.getModelByIndex(0),r=(console.log("ndsModel0.modelUri:",t.modelUri),X(t.modelUri)),t=(console.log("preObj:",JSON.stringify(r)),N(t,this.defaluHideMap),(i=this).animationData.animations.forEach(e=>{var t;e.jsonCameraMoves&&6==e.jsonCameraMoves.length&&((t=new THREE.Box3).min.fromArray(e.jsonCameraMoves),t.max.fromArray(e.jsonCameraMoves,3),i.animation2BBoxMap.set(e.animationID,t))}),this.addLabels(this.animationData),B.length||this.recordMapInfo(this.animationData),this.originalFileMap.size<1&&this.preparAnimationFile(this.animationData),await J(this),await Q(this,r,this.animationData,this.fileurlMap),this),r=r.prefix0,n=this.unExistMap,a=this.renderMap,o=this.stepMap,s=this.stepNodeMap;try{var l=null;if(NDSWebViewer.SETTING.singleHTML){var d=await H(t._binaryData,"string",r+"aniBusiness.js");if(l=JSON.parse(d)){var h=l.models,u=l.animations,c=l.steps;if(h&&0<h.length)for(let e=0;e<h.length;e++){var p=h[e];n.set(p.modelId,p.unExistIds)}if(u&&0<u.length)for(let e=0;e<u.length;e++){var f=u[e];a.set(f.animationID,f.renderMode)}if(c&&0<c.length)for(let e=0;e<c.length;e++){var m=c[e];if(m.stepData&&0<m.stepData.length)for(let e=0;e<m.stepData.length;e++){var _=m.stepData[e],g=m.animationID+"-"+_.id;o.set(g,_),s.set(g,{..._,type:"step"})}if(m.nodeData&&0<m.nodeData.length)for(let e=0;e<m.nodeData.length;e++){var y,w=m.nodeData[e],v=m.animationID+"-"+w.id;"step"==w.type&&o.has(v)?(y=o.get(v),s.set(v,{...y,type:"step",parentId:w.parentId})):s.set(v,w)}}}}else{var b=await fetch(r+"aniBusiness.js?temp="+(new Date).getTime());if(b.ok)try{if(l=await b.json()){h=l.models,u=l.animations,c=l.steps;if(h&&0<h.length)for(let e=0;e<h.length;e++){var x=h[e];n.set(x.modelId,x.unExistIds)}if(u&&0<u.length)for(let e=0;e<u.length;e++){var T=u[e];a.set(T.animationID,T.renderMode)}if(c&&0<c.length)for(let e=0;e<c.length;e++){var A=c[e];if(A.stepData&&0<A.stepData.length)for(let e=0;e<A.stepData.length;e++){var M=A.stepData[e],S=A.animationID+"-"+M.id;o.set(S,M),s.set(S,{...M,type:"step"})}if(A.nodeData&&0<A.nodeData.length)for(let e=0;e<A.nodeData.length;e++){var E,I=A.nodeData[e],k=A.animationID+"-"+I.id;"step"==I.type&&o.has(k)?(E=o.get(k),s.set(k,{...E,type:"step",parentId:I.parentId})):s.set(k,I)}}}}catch(e){}}}catch(e){console.info(":",e)}await 0,this.stepTimeMap=function(t){var i=new Map;if(t.size){var r=[],n=Array.from(t.keys());for(let e=0;e<n.length;e++){var a=n[e].split("-")[0];r.indexOf(a)<0&&r.push(a)}if(r.length)for(let e=0;e<r.length;e++){var o,s,l,d,h=r[e],u=[];for([o,s]of t)o.startsWith(String(h))&&u.push(s);u.length&&(l=u.sort((e,t)=>e.time-t.time).map(e=>e.time),d=u.sort((e,t)=>e.stepOrder-t.stepOrder).map(e=>e.time),i.set(h,{ascTimes:l,orderTimes:d}))}}return i}(this.stepMap),this.switchAnnimation(e)},this.toTime=e=>{i=e,this.resetAnimationStartTime(e),I&&I.updateMatrixWorld(!0),this.changeBodyByTime(e),this.sceneWraper.render(),this.playTick=this.getNextStepTick({time:e,update:!0}),this.dispatchEvent({type:"animationTime",time:e})},this.toStep=e=>{this.playTick=this.getNextStepTick({time:e,update:!0});e=this.playTick.startTime;this.toTime(e)},this.toPreStep=()=>{let e=i;s==THREE.LoopPingPong&&null!=h?(e=h,h=void 0):o&&(e=o.time),this.playTick=this.getNextStepTick({time:e,update:!0});var t=this.playTick.preTime;this.toTime(t)},this.toNextStep=()=>{let e=i;s==THREE.LoopPingPong&&null!=h?(e=h,h=void 0):o&&(e=o.time),this.playTick=this.getNextStepTick({time:e,update:!0});var t=this.playTick.nextTime;this.toTime(t)},this.dispatchAsyncEvent=e=>{setTimeout(()=>{D.dispatchEvent(e)},10)},this._resetSingleBodyRenderMode=()=>{var t=this.modelWraperMap.get(this.defaultNdsModelId).getMeshSets();for(let e=0;e<t.length;++e){var i=t[e],r=U.getBodyNodes(i);if(void 0!==r&&void 0!==U.getRenderMode(i))for(let e=0;e<r.length;++e)U.updateMeshSetRenderMode(i,r[e],"")}var e=this.viewer.getExtension("ColorChangeExtension");e&&e.removeAllBodyNodeMaterials()},this._setModelShowHideStatus=(e,t=0)=>{L(this,{uuids:this._defaultRootUUID||[],imageLabelsMap:this.imageLabelsMap,textLabelsMap:this.textLabelsMap,textIdLabelsMap:this.textIdLabelsMap,id2showHideStatusMap:this.id2showHideStatusMap,time:t,selectedHideTreeBody:this.selectedHideTreeBody,unExistMap:this.unExistMap},e)},this._changeBodyPosition=(a,o=0)=>{this.ndsModels.forEach((e,t)=>{if(e.animationId==a||0==t){var i=O.getLeafBodyNodes(e.rootBodyNode);for(let e=0;e<i.length;e++){var r=i[e];if(!O.getMatrixWorld(r))return!0;var n=O.getModelId(r),n=`${a}-${O.getUUID(r)}-`+n;this.changeBodyPosition(a,r,n,o)}}}),z(this)},this._onAnimation=()=>{var e=this.sceneWraper.getModelByIndex(0);let t=e.id;this.defaultNdsModelId=t,this.ndsModels.find(e=>e.id==t)||(i=new E(e),this.modelWraperMap.set(t,i),this.ndsModels.push(e)),NDSWebViewer.SETTING.HideLeafBody&&(this.sceneWraper.unmergeBodyNode(),this.oldHideLeafBody=NDSWebViewer.SETTING.HideLeafBody,NDSWebViewer.SETTING.HideLeafBody=!1),this.setSelectType();var i=this.sceneWraper.getModelByIndex(1);i&&i.isSketchModel&&(this.sketchModelId=i.id,i.id=6666,this.sceneWraper.setActiveModel(0)),"posy"!=NDSWebViewer.SETTING.modelUpDirection&&(this._modelUpDirection=NDSWebViewer.SETTING.modelUpDirection,NDSWebViewer.SETTING.modelUpDirection="posy"),this._resetSingleBodyRenderMode(),this.zip||(this.zip=this.coreView.ZIPData),this.camera=this.sceneWraper.getCamera(),this.staticAnnotation||(this.staticAnnotation=this.coreView.controls.staticAnnotation),this.originalCameraInfo||(e=this.camera.getOrginalCameraInfo())&&(this.originalCameraInfo={},this.originalCameraInfo.target=e.center.clone(),this.originalCameraInfo.position=e.position.clone(),this.originalCameraInfo.up=e.up.clone())},this.initByAnimationEdit=e=>{var{ndsModels:e,textIdLabels:t,activeAnimationID:i,animationData:r,unExistMap:n,fileurlMap:a,playlistMap:o,textLabelsMap:s,imageLabelsMap:l,textIdLabelsMap:d,id2showHideStatusMap:h,meshId2MaterialMap:u}=e;this.activeAnimationID=i,e.forEach(e=>{let t=e.id;var i;this.ndsModels.find(e=>e.id==t)||(i=new E(e),this.modelWraperMap.set(t,i),this.ndsModels.push(e))}),n&&(this.unExistMap=n),a&&(this.fileurlMap=a),o&&(this.playlistMap=o),s&&(this.textLabelsMap=s),l&&(this.imageLabelsMap=l),d&&(this.textIdLabelsMap=d),h&&(this.id2showHideStatusMap=h),u&&(this.meshId2MaterialMap=u),B.length||this.recordMapInfo(r),this.textAnimationOp("setListData",t),this.camera||(this.camera=this.sceneWraper.getCamera()),this.staticAnnotation||(this.staticAnnotation=this.coreView.controls.staticAnnotation)},this.addKeyMap=(e,t)=>{let i=this.keyMay.get(e);i||(i={array:[],set:new Set,indexMap:new Map},this.keyMay.set(e,i)),i.set.has(t)||(i.array.push(t),i.set.add(t),i.indexMap.set(t,i.array.length-1))},this.deleteKeyMap=(e,t)=>{var i=this.keyMay.get(e);if(i&&i.set.has(t)){i.set.delete(t);e=i.indexMap.get(t);i.array.splice(e,1),i.indexMap.delete(t);for(let e=0;e<i.array.length;e++)i.indexMap.set(i.array[e],e)}},this.queryTrackIDs=(t,e)=>{let i=[];return e.forEach(e=>{var e=t+"-"+e;this.keyMay.has(e)&&(e=this.keyMay.get(e).array,i=i.concat(e))}),i},this.queryTracks=(e,t,i=[])=>{var r=this.queryTrackIDs(e,t),n=[];if(0<r.length)for(let e=0;e<r.length;e++){var a=r[e];if(this.trackDataMap.has(a)){var o=this.trackDataMap.get(a);if(i.length){for(let e=0;e<i.length;e++)if(i[e]==o.ndsModelId){n.push(o);break}}else n.push(o)}}return n},this.queryTracksByParam=(e,t,i)=>{var{uuid:r,type:n}=i,a=this.queryTrackIDs(e,t),o=[];if(0<a.length)for(let e=0;e<a.length;e++){var s=a[e];if(this.trackDataMap.has(s)){s=this.trackDataMap.get(s);let e=null;"body"==n?e=s.modelID[0]+"-"+s.ndsModelId:"annotation"==n&&(e=s.id),(!r||r==e)&&o.push(s)}}return o},this.changeAnnoPosition=(e,t,i)=>{let r=function(e,t){var i=e.times[e.times.length-1],r=e.times[0];let n=[],a={};return i<t?n=e.translations.slice(-3):t<r?n=e.translations.slice(0,3):u(e.translations,3,r,i,t,e.times,n),a.x=n[0],a.y=n[1],a.z=n[2],a}(t,i);r&&D.staticAnnotation&&"text"!=t.type&&("pic"==t.type&&(r=f(r.x,r.y,D)),D.staticAnnotation.setTextLineImgPosition(e,r)),r&&"text"==t.type&&(r=f(r.x,r.y,D),D.textAnimationOp("setPosition",e,r.x,r.y))},this.changeAnnoColor=(e,t,i)=>{var r;"text"==t.type?(r=c(p(t,"colors",i)),D.textAnimationOp("setFontColor",e,r)):(r=p(t,"colors",i),t=p(t,"lineColors",i),i=c(r),r=c(t),D.staticAnnotation&&D.staticAnnotation.setNoteColor(e,i),D.staticAnnotation&&D.staticAnnotation.setNoteLineColor(e,r))},this.changeAnnoOpacity=(e,t,i)=>{i=Z(t,i);"number"==typeof i&&(-1<t.findIndex(e=>"text"==e.type)?D.textAnimationOp("setOpacity",e,i):D.staticAnnotation&&D.staticAnnotation.setTransparent(e,i))},this.getVisibleBoundingBox=e=>v(this,e=e||this.activeAnimationID),this.setSelectType=()=>{var e=this.coreView.selectionManager.getSelectType();"body"!=e&&(this.oldSelectType=e,this.coreView.selectionManager.setSelectType("body"),this.coreView.controls.getOperator().oldSelectType="body")}}set animationData(e){this._animationData=e}get animationData(){return this._animationData}overrideValue(e,t){super.overrideValue(this.currentTypeName,e,t)}overrideFunction(e,t){super.overrideFunction(this.currentTypeName,e,t)}overridePrototype(e){super.overridePrototype(this.currentTypeName,e)}onLoad(e){var t;Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(t,i){for(let e=this.length-1;0<=e;e--)if(t.call(i,this[e],e,this))return e;return-1}),this.viewer.zip||(t=new B.a,this.viewer.zip=t),this.sceneWraper=new ee(e),this.coreView=e,this.camera=this.sceneWraper.getCamera(),this.selectionManager=new re(e),this._isCadViewer=!NDSWebViewer.SETTING.AnimationEdit&&!NDSWebViewer.SETTING.ScenarioEditor,this.staticAnnotation,e.animationParams&&!e.AnimationExtension&&N(this.sceneWraper.getModelByIndex(0),this.defaluHideMap)}onNdsModelPrepareForRendering(e){if(0==e.id&&N(e,this.defaluHideMap),this._enableAnimation){NDSWebViewer.SETTING.HideLeafBody&&(this.sceneWraper.unmergeBodyNode(),NDSWebViewer.SETTING.HideLeafBody=!1);var i=new E(e);let t=i.ndsModelId;this.modelWraperMap.set(t,i),this.ndsModels.find(e=>e.id==t)||this.ndsModels.push(e),e.refModel&&e.refModel.meshManager.mats&&e.refModel.meshManager.mats.forEach(e=>{e&&(e._oriColor&&e.color.copy(e._oriColor),null!=e._oriOpacity)&&null!=e._oriOpacity&&(e.opacity=e._oriOpacity,e.transparent=e.opacity<1)}),0<t&&((i=this.animationData.models.find(e=>e.modelId==t))&&(e.animationId=i.animationId),this._setModelShowHideStatus(this.activeAnimationID))}}onBeforeNdsModelUpdate(e){!this.initAnimationLoaded&&this.viewer.animationParams&&!this.viewer.AnimationExtension&&this.viewer.animationParams.jsonMain&&this.viewer.animationParams.jsonMain.animationFileData&&(this.initAnimationLoaded=!0,this.viewer.AnimationExtension=this.viewer.getExtension("NDSAnimationExtension"),this.animationData=this.viewer.animationParams.jsonMain.animationFileData,this.relativePath=this.viewer.animationParams.relativePath,this.animationMorphAttri=this.viewer.animationParams.jsonMain.animationMorphAttri,this.viewer.dispatchAsyncEvent({type:"AnimationLoaded",data:this.viewer.animationParams.jsonMain.animationFileData})),this._enableAnimation&&0<e.id&&!e._bodyUpdate&&e.state>=NDSWebViewer.NdsModel.StateType.RENDERING_PREPARED&&(e._bodyUpdate=!0,this._changeBodyPosition(this.activeAnimationID))}onAfterNdsModelUpdate(e,t){if(!e.isSketchModel&&(!e._loaded&&e.state==NDSWebViewer.NdsModel.StateType.PREPARED&&this.prepareLoadModels.length||this.prepareLoadModels.length&&this._switchIns)){e._loaded=!0,this._switchIns=!1;let t=0;for(let e=0;e<this.prepareLoadModels.length;e++){var i=this.prepareLoadModels[e];if(i.unload){i.unload=!1,i.id="idv",i.singleHTML=NDSWebViewer.SETTING.singleHTML,i.needsBRep=!0,this.loadingModel=!0,this.sceneWraper.startLoadAnimationModel(i);break}t++}t==this.prepareLoadModels.length&&(this.loadAnimationFileEnd&&this.loadAnimationFileEnd(),this.prepareLoadModels=[])}}clear(){this.clearAnimations()}needDisableInputEvent(){return!!this.loadingModel}};NDSWebViewer.ExtensionManager.addExtension(t)}],r={},n.m=i,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10);function n(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},i[e].call(t.exports,t,t.exports,n),t.l=!0,t)).exports}var i,r});