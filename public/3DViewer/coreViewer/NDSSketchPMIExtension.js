!function(){"use strict";class e{constructor(e){this.__meshstate__=e}getMeshMaterial(e){return this.__meshstate__.getMeshMaterial(e)}setMeshMaterial(e,t){this.__meshstate__.setMeshMaterial(e,t)}setMeshMaterialTemporary(e,t){let r=this.__meshstate__.meshMtls.get(e);if(r){let e=r.material;r.material=t,this.__meshstate__.__updateMeshMtlBuffer(r.meshMtlIndex,r),this.__meshstate__.meshMtlTexture.needsUpdate=!0,r.material=e,r.meshSet.needsUpdate=!0,r.meshSet.prepareForBatchDraw()}}getLineMaterial(e){this.__meshstate__.getLineMaterial(e)}setLineMaterial(e,t,r){this.__meshstate__.setLineMaterial(e,t,r)}setLineMaterialTemporary(e,t,r){let i=this.__meshstate__.lineMtls.get(e);if(i){let e=2*i.lineMtlIndex;this.__meshstate__.lineMtlBuffer[e]=t,this.__meshstate__.lineMtlBuffer[e+1]=Math.round(1e3*r),this.__meshstate__.lineMtlTexture.needsUpdate=!0}}}class t{constructor(e){this.__brepManager__=e}hasBrepInfo(){return this.__brepManager__.hasBrepInfo()}hasBrepFile(){return this.__brepManager__.hasBrepFile()}getBrepInfos(){return this.__brepManager__.brepInfos}}
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */class r{constructor(r){this.__ndsModel__=r,r.meshState&&(this.__meshState__=new e(r.meshState)),r.brepManager&&(this.__brepManager__=new t(r.brepManager))}get isMCAD3DModel(){return this.__ndsModel__.isMCAD3DModel}get isMCAD2DModel(){return this.__ndsModel__.isMCAD2DModel}get typeName(){return this.__ndsModel__.typeName}get ndsModelId(){return this.__ndsModel__.id}get numMesh(){}getMeshState(){return this.__meshState__}getBrepManager(){return this.__brepManager__}getPMIObject(){return this.__ndsModel__.pmiObject}getRootBodyNode(){return this.__ndsModel__.rootBodyNode}getBodyNode(e){return this.__ndsModel__.getBodyNode(e)}getLeafBodies(e){return this.__ndsModel__.getLeafBodies(e)}isSketchModel(){return!!this.__ndsModel__.isSketchModel}getLeafBodyNodes(){return this.__ndsModel__.wholeLeafBodyNodes}transparentizeBodies(e){this.__ndsModel__.transparentizeBodies(e)}isolateBodies(e){this.__ndsModel__.isolateBodies(e,NDSWebViewer.SETTING.bodyOpacity,NDSWebViewer.SETTING.lineOpacity)}clearTransparentBodies(){this.__ndsModel__.exitIsolate()}getMeshSets(){return this.__ndsModel__.getMeshSets()}changeObjectidTouuid(e){return this.__ndsModel__.objectidTouuid[e]}getMeshMaterial(e){if(!this.__ndsModel__)return null;let t=this.__ndsModel__.meshManager.materialId[e],r=this.__ndsModel__.meshManager.materialUuids[t];return this.__ndsModel__.meshManager.materials[r].mat}setMeshMaterial(e,t){if(!this.__ndsModel__)return!1;let r=this.__ndsModel__,i=0;if(r.meshManager.materials[t.uuid]){for(let e=0;e<r.meshManager.materialUuids.length;e++)if(r.meshManager.materialUuids[e]===t.uuid){i=e;break}}else r.meshManager.materials[t.uuid]={mat:t,refCount:0},i=r.meshManager.materialUuids.length,r.meshManager.materialUuids.push(t.uuid);let o=r.meshManager.materialId[e],s=r.meshManager.materialUuids[o];return r.meshManager.materials[s].refCount--,r.meshManager.materials[t.uuid].refCount++,r.meshManager.materialId[e]=i,r.meshManager.materialIdOriginal[e]=i,!0}removeAllBodyNodeMaterials(){this.__ndsModel__.removeAllBodyNodeMaterials()}refreshBodyWorldMatrixUniforms(){this.__ndsModel__.refreshBodyWorldMatrixUniforms()}refreshMeshState(e=void 0){this.__ndsModel__.refreshMeshState(e||this.__ndsModel__.rootBodyNode)}}
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */console.log("NDS ExtensionFramework V0.1");const i={FLAG_ENABLE_NODE_TRANSFORM:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,FLAG_ENABLE_NODE_STOREVIEW:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<1,FLAG_ENABLE_NODE_CAMERA2D:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<2,FLAG_ENABLE_NODE_BLOCK:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<3,FLAG_ENABLE_NODE_TEXT:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<4,FLAG_ENABLE_NODE_BROADCAST:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<5};class o extends NDSWebViewer.Extension{constructor(){super()}onLoad(e){}onInitLights(){}update(e){}setFlags(e){super.setFlags(e)}onNdsModelPrepareForRendering(e){}onBeforeNdsModelUpdate(e,t){}onAfterNdsModelUpdate(e,t){}onBeforeNdsModelSetRender(e,t){}onAfterNdsModelSetRender(e,t){}onBeforeNdsMeshRender(e,t){}getExtensionWithFlags(e){return NDSWebViewer.ExtensionManager.getExtensionWithFlags(e)}resetToDefault(){}getStoreInfo(e){throw this.name+" Extesion did not implement method 'getStoreInfo' "}setStoreInfo(e){throw this.name+" Extesion did not implement method 'setStoreInfo' "}getBodyTransform(e){return new THREE.Matrix4}getBodyNodeTranslate(e){return new THREE.Vector3(0,0,0)}}
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */class s{static getModel(e){return e.ndsModel}static getModelId(e){return e.ndsModel.id}static getUUID(e){return e.uuid}static getObjectId(e){return e.objectid}static getId(e){return e.id}static getBodyNodeMaterial(e){let t=e.getMaterialBodyNodeUUid();return t&&e.useBodyNodeMaterial?e.ndsModel.bodyNodeUUidToMaterial[t]:null}static setBodyNodeMaterial(e,t){e.ndsModel.bodyNodeUUidToMaterial[e.uuid]=t,e.useBodyNodeMaterial=!!t}static getUserMaterial(e){return e.getUserMaterial()}static setUserMaterial(e,t){e.setUserMaterial(t)}static getBoundingBox(e){var t=new THREE.Box3;return e.getBoundingBox(t,!0)}static isLeafBodyNode(e){return!!e.leafBodyAttri}static isPartBodyNode(e){return"Part"===e.type}static getLeafBodyNodes(e){return e.ndsModel.getLeafBodies(e)}static getMeshesInLeafBodyNode(e){return e.leafBodyAttri?e.leafBodyAttri.bodyMeshIds:[]}static getMatrixLocal(e){return e.matrix}static getMatrixWorld(e){return e.worldMatrix}static setMatrixWorld(e,t){e.setMatrixWorld(t)}static applyTransform(e,t=null){e.applyTransform(t)}static updateMatrixWorld(e,t=!1){e.updateMatrixWorld(t,!0)}static hide(e){e.hide(),e.ndsModel.hideBodies.push(e)}static show(e){e.show(),e.ndsModel.RemoveElement(e.ndsModel.hideBodies,e)}static isPreSelected(e){return e.isPreSelected()}static isSelected(e){return e.isSelected()}static isTransparent(e){return e.isTransparent()}static isHidden(e){return e.isHidden()}static isIsolated(e){return e.isIsolated()}static getRenderMode(e){switch(e.renderMode){case 3:return"wireframe";case 4:return"hiddenLineRemove";case 5:return"hiddenLineVisible"}return""}static getBodyNodeTranslate(e,t){let r=new THREE.Vector3(0,0,0),o=e.getExtensionWithFlags(i.FLAG_ENABLE_NODE_TRANSFORM);for(let e=0,i=o.length;e<i;++e)r.add(o[e].getBodyNodeTranslate(t));return r}static updateNodeMatrix(e,t){e.ndsModel.updateNodeMatrix(e.uuid,t,e.getModel().id)}static hideBody(e){e.ndsModel.hideBody(e)}static showBody(e){e.ndsModel.showBody(e)}}
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */class n{constructor(e){this.__coreView__=e}addEventListener(e,t){this.__coreView__.addEventListener(e,t)}hasEventListener(e,t){return this.__coreView__.hasEventListener(e,t)}removeEventListener(e,t){this.__coreView__.removeEventListener(e,t)}dispatchEvent(e){this.__coreView__.dispatchEvent(e)}getPixelRatio(){return this.__coreView__.renderer.getPixelRatio()}switchRotateCenterBySelection(){this.__coreView__.switchRotateCenterBySelection()}setDefaultEnvMap(e){e&&(this.__coreView__.hasPbrMaterial=!0,this.__coreView__.setDefaultEnvMap=()=>{this.__coreView__.setEnvMapEnabled(!0),this.__coreView__.defaultEnvMapTexture=e,this.__coreView__.updateEnvMap(this.__coreView__.defaultEnvMapTexture)},this.__coreView__.setDefaultEnvMap())}getBackgroundState(){return this.__coreView__.exchangeBackImage?{type:this.__coreView__.exchangeBackImage.type,value:this.__coreView__.exchangeBackImage.value}:void 0}setBackgroundState(e,t){"Image"===e?(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(t)):"EnvMap"===e?this.__coreView__.setEnvMapTextures(t):"Color"===e&&(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(null),this.__coreView__.setBackGroundColor(t))}removeAllLights(){this.__coreView__.lights.length=0}getLight(e){return this.__coreView__.lights[e]}setLight(e,t){this.__coreView__.lights[e]=t}getViewBox(){return this.__coreView__.viewBox}toggleAutoRotation(e){this.__coreView__.toggleAutoRotation(e)}randColor(){return this.__coreView__.materialsSetting.randColor()}getBoundingBox(e=!1){let t=this.__coreView__.ndsModel.getTotalBodyBoundingBox(null,e);return t.isEmpty()?this.__coreView__.modelRootObject.boundingBox:t}getModelTree(){return this.__coreView__.getModelTree()}getModelCount(){return this.__coreView__.ndsModel.models.length}setActiveModel(e){this.__coreView__.ndsModel.setActiveModel(e)}setActiveModelByModel(e){this.__coreView__.ndsModel.activeModel=e}setActiveModelByModelId(e){let t=-1;for(let r=0;r<this.__coreView__.ndsModel.models.length;++r)if(this.__coreView__.ndsModel.models[r].id===e){t=r;break}this.setActiveModel(t)}getActiveModel(){return this.__coreView__.ndsModel.getActiveModel()}getModelById(e){return this.__coreView__.ndsModel.getModelById(e)}getModelIndexByModelId(e){let t=this.__coreView__.ndsModel;for(let r=0;r<t.models.length;++r)if(t.models[r].id===e)return r}getModelByIndex(e){return this.__coreView__.ndsModel.models[e]}getMeshManager(){return this.__coreView__.ndsModel.meshManager}registOperator(e,t){this.__coreView__.registOperator(e,t)}setOperatorByID(e){this.__coreView__.setOperatorByID(e)}getCurrentOperator(){return this.__coreView__.controls.getOperator()}getCurrentOperatorID(){return this.__coreView__.getCurrentOperatorID()}getCurrentOperatorState(){return this.__coreView__.getCurrentOperatorState()}setOperator(e){this.__coreView__.setOperator(e)}registCursor(e,t,r){this.__coreView__.registCursor(e,t,r)}hideSelectedObjects(){this.__coreView__.hideSelectedObjects()}getViewControlBoundingBox(){return this.__coreView__.controls.getBoundingBox()}setViewControlBoundingBox(e,t){this.__coreView__.controls.setBoundingBox(e,t)}getCamera(){return this.__coreView__.camera}setCameraControlBoundingBoxCenter(e){this.__coreView__.cameraControl.setBoundingBoxCenter(e)}setCameraControlBounding(e,t){this.__coreView__.cameraControl.setBoundingBox(e,t)}getRotateCenter(){return this.__coreView__.cameraControl.getRotateCenter()}setRotateCenter(e){this.__coreView__.cameraControl.setRotateCenter(e)}getViewLockedState(){return this.__coreView__.cameraControl.isViewLockedBySingleBody}setViewLockedState(e){this.__coreView__.cameraControl.isViewLockedBySingleBody=e}getCameraInfo(){return this.__coreView__.cameraControl.getCameraInfo()}adjustNearAndFar(){this.__coreView__.cameraControl.adjustNearAndFar()}updateViewBoxCamDir(){this.__coreView__.cameraControl.updateViewBoxCamDir()}startSmoothTranslation(e){this.__coreView__.cameraControl.startSmoothTranslation(e)}zoomExtents(e,t,r){this.__coreView__.cameraControl.zoomExtents(e,t,r)}setCameraInfo(e,t){this.__coreView__.cameraControl.setCameraInfo(e,t)}getOrginalCameraInfo(){return this.__coreView__.viewManager?this.__coreView__.viewManager.getOrginalCameraInfo():this.__coreView__.camera.getOrginalCameraInfo()}setOrginalCameraInfo(e,t,r){this.__coreView__.camera.setOrginalCameraInfo({center:e,up:t,position:r})}toPerspectiveCamera(){this.__coreView__.toPerspectiveCamera()}toOrthographicCamera(){this.__coreView__.toOrthographicCamera()}updateGroundTransform(e,t,r){return this.__coreView__.groundShadow.updateGroundTransform(e,t,r)}isRendererContainsClipPlanes(){return this.__coreView__.renderer.clippingPlanes.length>0}getCanvas2D(){return this.__coreView__.canvas2D}getCanvas3D(){return this.__coreView__.canvas3D}getContainer(){return this.__coreView__.container}getRenderDomElement(){return this.__coreView__.renderer.domElement}getAdditionalObjectsScene(){return this.__coreView__.additionalObjectsScene}getDispalyModelUnit(e,t){return this.__coreView__.getDispalyModelUnit(e,t)}setDispalyModelUnit(e,t){return this.__coreView__.setDispalyModelUnit(e,t)}modelCoordToClientCoord(e){return this.__coreView__.modelCoordToClientCoord(e)}clientCoordToModelCoord(e){return this.__coreView__.clientCoordToModelCoord(e)}showObject(e,t,r,i=!0){this.__coreView__.showObject(e,t,r,i)}showObjectReversed(e){this.__coreView__.showObjectReversed(e)}renderAllViews(){this.__coreView__.renderAllViews()}render(e){this.__coreView__.render(e)}setRenderMode(e,t){this.__coreView__.setRenderMode(e,t)}getRenderMode(){let e;switch(this.__coreView__.getRenderMode()){case 0:e="lighting";break;case 1:e="primarycolor";break;case 2:e="wireframe";break;case 3:e="whitemold";break;case 4:e="shadedWithEdges";break;case 5:e="shaded";break;case 6:e="hiddenLineRemove";break;case 7:e="hiddenLineVisible";break;case 8:e="transparent"}return e}getAssemblyPMIState(){return this.__coreView__.AssemblyPMIState}setAssemblyPMIState(e){this.__coreView__.AssemblyPMIState=e}getPartPMIState(){return this.__coreView__.PartPMIState}setPartPMIState(e){this.__coreView__.PartPMIState=e}getPmiVisible(){return this.__coreView__.pmiVisible}setPmiVisible(e){this.__coreView__.pmiVisible=e}setPMIObjectVisible(e,t){this.__coreView__.setPMIObjectVisible(e,t)}isPMIOccludeByModel(){return!NDSWebViewer.SETTING.StopPMIOcclusion}enablePMIOccludeByModel(e){this.__coreView__.stopPMIOcclusion(!e)}getPmiList(){return this.__coreView__.PMINDSBodys}getPMIObjectByUUID(e,t=-1){return this.__coreView__.getPMIObjectByuuid(e,t)}isPMIObjectOrSomeChildHidden(e){return this.__coreView__.isPMIObjectOrSomeChildHidden(e)}isPMIObjectSelect(e){return this.__coreView__.isPMIObjectSelect(e)}getPmiObjectTree(){return this.__coreView__.pmiObject}getSelectedPmiList(){return this.__coreView__.getPMINDSBodySelectList()}selectPMIObject(e,t=!0){this.__coreView__.selectPMIObject(e,t)}deselectPMIObject(e,t=!0){this.__coreView__.deselectPMIObject(e,t)}unmergeBodyNode(){this.__coreView__.ndsModel.unmergeNode()}mergeBodyNode(){this.__coreView__.ndsModel.mergeNode()}getAllTransparentBodies(e){return this.__coreView__.ndsModel.getAllTransparentBodies(e)}isolateBodiesOnly(e){this.__coreView__.ndsModel.isolateBodiesOnly(e)}clearTransparentModeBodiesMap(){this.__coreView__.ndsModel.transparentModeBodiesMap.clear()}unloadModelById(e){this.__coreView__.unloadModelById(e)}startLoadAnimationModel(e){let t=e.url,r=e.id,i={needsPMI:!1,needsAnimation:!1,needsSketchModel:!1,position:e.position,pmiVisible:this.__coreView__.pmiVisible,modelId:e.modelId};this.__coreView__.loadModel(r,t,null,null,"js",null,null,null,i)}getBodyNodeFromUuid(e,t=-1){var r=null;if(t>=0){let i=this.getModelById(t);if(i){let t=i.getBodyNodeFromUuid(e);t&&(r=t)}}else this.__coreView__.ndsModel.models.forEach((t=>{let i=t.getBodyNodeFromUuid(e);i&&(r=i)}));return r}loadBrepInfo(e){this.__coreView__.loadBrepInfo(e)}enableTransparent(e){this.__coreView__.enableTransparent(e)}getLineWidth(){return this.__coreView__.showLineWidth}setLineWidth(e){this.__coreView__.setLineWidth(e)}getViewManager(){return this.__coreView__.viewManager}switchViewport(e,t){return this.__coreView__.switchViewport(e,t)}}class d{constructor(e){this.__selectionManager__=e.selectionManager}getSelectedObjects(){return this.__selectionManager__.getSelectedObjects()}getSelectedMeshes(){return this.__selectionManager__.getSelectedMeshes()}clearSelection(){this.__selectionManager__.clearSelection()}setSelectType(e){this.__selectionManager__.setSelectType(e)}selectByClick(e,t){this.__selectionManager__.selectByClick(e,t)}selectObject(e,t,r){this.__selectionManager__.selectObject(e,t,r)}deselectObject(e,t){this.__selectionManager__.deselectObject(e,t)}getSelectedSketchObjects(){return this.__selectionManager__.getSelectedSketchObjects()}}"undefined"!=typeof token&&token;const a=new class extends o{constructor(){super(),this.name="NDSSketchPMIExtension",console.log("NDSSketchPMIExtension version 1.0.2"),this.nodeSet=new Set,this.geoRootBodyNode=null,this.sketchName=null,this.geoNode=null}onLoad(e){this.sceneWraper=new n(e),this.selectionManager=new d(e)}getBodyNodeByName(e,t){let r=[],i=e;for(;i.parent;)r.push(i.parent.index),i=i.parent;i=t;for(let e=2;e<r.length;e++)if(i=i.children[r[e]],!i)return null;if(e.name===i.name||e.oriName&&e.oriName===i.oriName)return i;for(let t=0;t<i.children.length;t++){const r=i.children[t];if(e.name===r.name||e.oriName&&e.oriName===r.oriName)return r}}setSketchuuids(e){e[0].index=0;for(let t=0;t<e.length;t++){const r=e[t];if("Body"===r.type)if(r.parent&&r.parent.parent&&r.parent.name==r.parent.parent.name.split(".")[0]){let e=this.getBodyNodeByName(r.parent.parent,this.geoRootBodyNode);e&&(e.sketchuuids=e.sketchuuids||[],e.sketchuuids.push(r.uuid))}else{let e=this.getBodyNodeByName(r.parent,this.geoRootBodyNode);e&&(e.sketchuuids=e.sketchuuids||[],e.sketchuuids.push(r.uuid))}for(let t=0;t<r.children.length;t++)e.push(r.children[t]),r.children[t].index=t}}onNdsModelPrepareForRendering(e){if(e.isSketchModel){this.geoRootBodyNode=e.parentModel.rootBodyNode;let t=e;if(this.sketchName=null,this.geoNode=null,t.rootBodyNode.children)for(let r=0;r<t.rootBodyNode.children.length;r++){let i=t.rootBodyNode.children[r],o=this.sceneWraper.getBodyNodeFromUuid(e.parentModel.sketchFileBindNodeuuid[r],e.parentModel.id);this.geoRootBodyNode=o||e.parentModel.rootBodyNode,this.setSketchuuids([i])}}}insertSketchNode(e){let t=function(e){let t=e.ndsModel.getBodyNodeFromUuid(e.uuid);if(t&&t.sketchuuids&&t.sketchuuids.length>0){var r=new NDSWebViewer.NdsBodyNode;r.name=NDSWebViewer.COMMON.translateString("NDS_SKETCH"),r.type="sketchs",r.parent=e,r.uuid=`sketch-${r.parent.uuid}`,r.ndsModel=e.ndsModel.ndsSketchModel,r.ndsModel.bodyUuid2ClonedNodeMap[r.uuid]=r;let n=-1;e.children.forEach(((e,t)=>{"PMI"!==e.type&&"views"!==e.type&&"captures"!==e.type&&-1===n&&(n=t)})),e.children.splice(n,0,r);for(var i=0;i<t.sketchuuids.length;++i){var o=t.sketchuuids[i];let e=r.ndsModel.getBodyNodeFromUuid(o);if(e){var s=new NDSWebViewer.NdsBodyNode;s.parent=r,s.uuid=e.uuid,s.name=e.name,s.type="sketch",s.ndsModel=r.ndsModel,r.ndsModel.bodyUuid2ClonedNodeMap[s.uuid]=s,e.NdsBodyNode=s,r.children.push(s)}}}};if(e){let r=[e];for(let e=0;e<r.length;e++){const i=r[e];t(i);for(let e=0;e<i.children.length;e++)r.push(i.children[e])}}}setSketchObjectVisible(e,t){let r=e.ndsModel.getBodyNodeFromUuid(e.uuid),i=e.ndsModel.parentModel.id;if(r){if(t)s.showBody(r);else if(s.hideBody(r),r.bodyPmiuuid)for(let e=0;e<r.bodyPmiuuid.length;e++){let t=this.sceneWraper.getPMIObjectByUUID(r.bodyPmiuuid[e],i);t&&this.sceneWraper.setPMIObjectVisible(t,!1)}}else if(e.children&&e.children.length>0)for(let r=0;r<e.children.length;r++)this.setSketchObjectVisible(e.children[r],t);this.sceneWraper.renderAllViews()}showSketchObjectByPMIuuid(e,t){let r=this.sceneWraper.getModelById(t).ndsSketchModel;if(r)for(let t=0;t<r.wholeLeafBodyNodes.length;t++)r.wholeLeafBodyNodes[t].bodyPmiuuid&&-1!==r.wholeLeafBodyNodes[t].bodyPmiuuid.indexOf(e)&&this.setSketchObjectVisible(r.wholeLeafBodyNodes[t],!0)}getSketchListByPMIuuid(e,t){let r=this.sceneWraper.getModelById(t).ndsSketchModel,i=[];if(r)for(let t=0;t<r.wholeLeafBodyNodes.length;t++)r.wholeLeafBodyNodes[t].bodyPmiuuid&&-1!==r.wholeLeafBodyNodes[t].bodyPmiuuid.indexOf(e)&&i.push(r.wholeLeafBodyNodes[t].uuid);return i}selectSketchObject(e){this.selectionManager.selectObject(e)}deselectSketchObject(){this.selectionManager.deselectObject(sketchBodyNode)}getSketchSelectList(){let e=this.selectionManager.getSelectedSketchObjects(),t=[];return e.forEach((e=>{t.push(e.ndsModel.bodyUuid2ClonedNodeMap[e.uuid])})),t}getSketchObjectOrSomeChildVisibleStatus(e){let t=e.ndsModel.getBodyNodeFromUuid(e.uuid);if(t&&s.isHidden(t))return 0;if(e.children&&e.children.length>0){let r=e.children.length,i=0;for(let r=0;r<e.children.length;r++){let o=e.children[r];t=o.ndsModel.getBodyNodeFromUuid(o.uuid),t&&!s.isHidden(t)&&i++}if(i==r)return 1;if(0==i)return 0;if(i<r)return 2}return 1}onAfterNdsModelUpdate(e,t){e.isSketchModel&&5===e.state&&!this.nodeSet.has(e.id)&&(s.updateMatrixWorld(e.rootBodyNode,!0),this.nodeSet.add(e.id))}selectFaceAndLineByPMIObject(e){var t=function(e,t,r){var i,s=r.geomManager.getGeomFromUuid(e,0),n=t.concat();if(n[0]+=s.drawRange.start/2,n[1]+=s.drawRange.start/2,s.isBufferGeometry){var d=n[1]-n[0]+1,a=s.index,_=s.attributes.position.array,l=new Float32Array(6*d),c=n[0],h=n[1];if(null!=a){for(var u=a.array,M=0,g=c,p=h;g<=p;g++,M+=1){var m=u[2*g],w=u[2*g+1],B=new THREE.Vector3,f=new THREE.Vector3;B.fromArray(_,3*m),f.fromArray(_,3*w),l[6*M]=B.x,l[6*M+1]=B.y,l[6*M+2]=B.z,l[6*M+3]=f.x,l[6*M+4]=f.y,l[6*M+5]=f.z,B=null,f=null}let e=NDSWebViewer.SETTING.SelectedEdgeMaterial1,t=new NDSWebViewer.LineSegmentsGeometry;t.setPositions(l);let r=new NDSWebViewer.LineMaterial({linewidth:e.linewidth,opacity:e.opacity,color:e.color,depthTest:!1,depthWrite:!1});const s=o.sceneWraper.getPixelRatio(),n=o.sceneWraper.getRenderDomElement();let d=n.width/s,y=n.height/s;r.resolution.set(d,y),i=new NDSWebViewer.LineSegments2(t,r)}}return i},i=function(e,t,r){var i,o=r.geomManager.getGeomFromUuid(e,0),s=t.concat();if(s[0]+=o.drawRange.start/3,s[1]+=o.drawRange.start/3,o.isBufferGeometry){for(var n=o.index,d=o.attributes.position,a=s[1]-s[0]+1,_=new Float32Array(9*a),l=0,c=s[0],h=s[1];c<=h;c++,l+=1){var u=3*c,M=n.getX(u),g=n.getX(u+1),p=n.getX(u+2),m=new THREE.Vector3,w=new THREE.Vector3,B=new THREE.Vector3;m.fromBufferAttribute(d,M),w.fromBufferAttribute(d,g),B.fromBufferAttribute(d,p),_[9*l]=m.x,_[9*l+1]=m.y,_[9*l+2]=m.z,_[9*l+3]=w.x,_[9*l+4]=w.y,_[9*l+5]=w.z,_[9*l+6]=B.x,_[9*l+7]=B.y,_[9*l+8]=B.z,m=null,w=null,B=null}var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(_,3));var y=new THREE.MeshBasicMaterial({opacity:.8,color:979390,side:THREE.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1});i=new THREE.Mesh(f,y)}return i};let o=this;function s(){if(e.ndsModel.ndsSketchModel){let t=new r(e.ndsModel.ndsSketchModel);if(!t.getBrepManager().hasBrepInfo()&&t.getBrepManager().hasBrepFile())return}let t=new r(e.ndsModel);!t.getBrepManager().hasBrepInfo()&&t.getBrepManager().hasBrepFile()||(o.sceneWraper.removeEventListener("BrepInfoEvent",s),o.selectFaceAndLineByPMIObject(e))}let n=new r(e.ndsModel);if(!n.getBrepManager().hasBrepInfo()&&n.getBrepManager().hasBrepFile())return this.sceneWraper.addEventListener("BrepInfoEvent",s),void this.sceneWraper.loadBrepInfo(!1);e.linkedEntities&&e.linkedEntities.forEach((s=>{if("body"===s.entityType.toLowerCase()&&s.children){let r=o.sceneWraper.getBodyNodeFromUuid(s.id,e.ndsModel.id);for(let d=0;d<s.children.length;d++){const a=s.children[d];let _=null,l=-1,c=null;if("face"===a.entityType.toLowerCase()){let t=n.getBrepManager().getBrepInfos();if(void 0!==s.id&&t.bodies.has(s.id)){let n=t.bodies.get(s.id),d=t.breps[n];for(let s=0;s<d.faceGroups.length;s++){const n=t.faceGroups[d.faceGroups[s]];if(Object.entries(n).forEach((([e,t])=>{if(!_&&("geomUUID"==e&&(c=t),t.ids&&t.ids.length>0))for(let e=0;e<t.ids.length;e++)if(t.ids[e]==a.id){l=e,_=t;break}})),_){let t=[0,1];t[0]=_.triIndexRanges[2*l],t[1]=_.triIndexRanges[2*l+1];let s=i(c,t,e.ndsModel);s.uuid=`${a.id}-${e.ndsModel.id}`,s.applyMatrix(r.worldMatrix),s.updateMatrixWorld(!0),o.sceneWraper.getAdditionalObjectsScene().add(s);break}}}}else if("edge"===a.entityType.toLowerCase()){let i=n.getBrepManager().getBrepInfos();if(void 0!==s.id&&i.bodies.has(s.id)){let n=i.bodies.get(s.id),d=i.breps[n];for(let s=0;s<d.edgeGroups.length;s++){const n=i.edgeGroups[d.edgeGroups[s]];if(Object.entries(n).forEach((([e,t])=>{if(!_&&("geomUUID"==e&&(c=t),t.ids&&t.ids.length>0))for(let e=0;e<t.ids.length;e++)if(t.ids[e]==a.id){l=e,_=t;break}})),_){let i=[0,1];i[0]=_.indexRanges[2*l],i[1]=_.indexRanges[2*l+1];let s=t(c,i,e.ndsModel);s.uuid=`${a.id}-${e.ndsModel.id}`,s.applyMatrix(r.worldMatrix),s.updateMatrixWorld(!0),o.sceneWraper.getAdditionalObjectsScene().add(s);break}}}}}}else if("sketchbody"===s.entityType.toLowerCase()&&s.children){let i=o.sceneWraper.getBodyNodeFromUuid(s.id,e.ndsModel.ndsSketchModel.id);for(let d=0;d<s.children.length;d++){const a=s.children[d];let _=null,l=-1,c=null;if("edge"===a.entityType.toLowerCase()){n=new r(e.ndsModel.ndsSketchModel);let d=n.getBrepManager().getBrepInfos();if(void 0!==s.id&&d.bodies.has(s.id)){let r=d.bodies.get(s.id),n=d.breps[r];for(let r=0;r<n.edgeGroups.length;r++){const s=d.edgeGroups[n.edgeGroups[r]];if(Object.entries(s).forEach((([e,t])=>{if(!_&&("geomUUID"==e&&(c=t),t.ids&&t.ids.length>0))for(let e=0;e<t.ids.length;e++)if(t.ids[e]==a.id){l=e,_=t;break}})),_){let r=[0,1];r[0]=_.indexRanges[2*l],r[1]=_.indexRanges[2*l+1];let s=t(c,r,e.ndsModel.ndsSketchModel);s.uuid=`${a.id}-${e.ndsModel.ndsSketchModel.id}`,s.applyMatrix(i.worldMatrix),s.updateMatrixWorld(!0),o.sceneWraper.getAdditionalObjectsScene().add(s);break}}}}}}})),o.sceneWraper.renderAllViews()}deselectFaceAndLineByPMIObject(e){let t=this;e.linkedEntities&&e.linkedEntities.forEach((r=>{if("body"===r.entityType.toLowerCase()&&r.children)for(let i=0;i<r.children.length;i++){let o=r.children[i],s=t.sceneWraper.getAdditionalObjectsScene().getObjectByProperty("uuid",`${o.id}-${e.ndsModel.id}`);s&&t.sceneWraper.getAdditionalObjectsScene().remove(s)}else if("sketchbody"===r.entityType.toLowerCase()&&r.children)for(let i=0;i<r.children.length;i++){let o=r.children[i],s=t.sceneWraper.getAdditionalObjectsScene().getObjectByProperty("uuid",`${o.id}-${e.ndsModel.ndsSketchModel.id}`);s&&t.sceneWraper.getAdditionalObjectsScene().remove(s)}}))}};NDSWebViewer.ExtensionManager.addExtension(a)}();
