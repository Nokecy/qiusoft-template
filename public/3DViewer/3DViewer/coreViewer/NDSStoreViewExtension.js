!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NDSStoreViewExtension=t():e.NDSStoreViewExtension=t()}(window,function(){return r=[function(e,t,r){r.r(t);console.log("NDS ExtensionFramework V0.1");let a={FLAG_ENABLE_NODE_TRANSFORM:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,FLAG_ENABLE_NODE_STOREVIEW:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<1,FLAG_ENABLE_NODE_CAMERA2D:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<2,FLAG_ENABLE_NODE_BLOCK:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<3,FLAG_ENABLE_NODE_TEXT:NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM<<4};class s extends NDSWebViewer.Extension{constructor(){super()}onLoad(e){}onInitLights(){}update(e){}setFlags(e){super.setFlags(e)}onNdsModelPrepareForRendering(e){}onBeforeNdsModelUpdate(e,t){}onAfterNdsModelUpdate(e,t){}onBeforeNdsModelSetRender(e,t){}onAfterNdsModelSetRender(e,t){}onBeforeNdsMeshRender(e,t){}getExtensionWithFlags(e){return NDSWebViewer.ExtensionManager.getExtensionWithFlags(e)}resetToDefault(){}getStoreInfo(e){throw this.name+" Extesion did not implement method 'getStoreInfo' "}setStoreInfo(e){throw this.name+" Extesion did not implement method 'setStoreInfo' "}getBodyTransform(e){return new THREE.Matrix4}getBodyNodeTranslate(e){return new THREE.Vector3(0,0,0)}}class i{constructor(e){this.__coreView__=e}addEventListener(e,t){this.__coreView__.addEventListener(e,t)}hasEventListener(e,t){return this.__coreView__.hasEventListener(e,t)}removeEventListener(e,t){this.__coreView__.removeEventListener(e,t)}dispatchEvent(e){this.__coreView__.dispatchEvent(e)}getPixelRatio(){return this.__coreView__.renderer.getPixelRatio()}switchRotateCenterBySelection(){this.__coreView__.switchRotateCenterBySelection()}setDefaultEnvMap(e){e&&(this.__coreView__.hasPbrMaterial=!0,this.__coreView__.setDefaultEnvMap=()=>{this.__coreView__.setEnvMapEnabled(!0),this.__coreView__.defaultEnvMapTexture=e,this.__coreView__.updateEnvMap(this.__coreView__.defaultEnvMapTexture)},this.__coreView__.setDefaultEnvMap())}getBackgroundState(){return this.__coreView__.exchangeBackImage?{type:this.__coreView__.exchangeBackImage.type,value:this.__coreView__.exchangeBackImage.value}:void 0}setBackgroundState(e,t){"Image"===e?(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(t)):"EnvMap"===e?this.__coreView__.setEnvMapTextures(t):"Color"===e&&(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(null),this.__coreView__.setBackGroundColor(t))}removeAllLights(){this.__coreView__.lights.length=0}getLight(e){return this.__coreView__.lights[e]}setLight(e,t){this.__coreView__.lights[e]=t}getViewBox(){return this.__coreView__.viewBox}toggleAutoRotation(e){this.__coreView__.toggleAutoRotation(e)}randColor(){return this.__coreView__.materialsSetting.randColor()}getBoundingBox(e=!1){e=this.__coreView__.ndsModel.getTotalBodyBoundingBox(null,e);return e.isEmpty()?this.__coreView__.modelRootObject.boundingBox:e}getModelTree(){return this.__coreView__.getModelTree()}getModelCount(){return this.__coreView__.ndsModel.models.length}setActiveModel(e){this.__coreView__.ndsModel.setActiveModel(e)}setActiveModelByModelId(t){let r=-1;for(let e=0;e<this.__coreView__.ndsModel.models.length;++e)if(this.__coreView__.ndsModel.models[e].id===t){r=e;break}this.setActiveModel(r)}getActiveModel(){return this.__coreView__.ndsModel.getActiveModel()}getModelById(e){return this.__coreView__.ndsModel.getModelById(e)}getModelByIndex(e){return this.__coreView__.ndsModel.models[e]}registOperator(e,t){this.__coreView__.registOperator(e,t)}setOperatorByID(e){this.__coreView__.setOperatorByID(e)}getCurrentOperator(){return this.__coreView__.controls.getOperator()}getCurrentOperatorID(){return this.__coreView__.getCurrentOperatorID()}setOperator(e){this.__coreView__.setOperator(e)}registCursor(e,t,r){this.__coreView__.registCursor(e,t,r)}hideSelectedObjects(){this.__coreView__.hideSelectedObjects()}getViewControlBoundingBox(){return this.__coreView__.controls.getBoundingBox()}setViewControlBoundingBox(e,t){this.__coreView__.controls.setBoundingBox(e,t)}getCamera(){return this.__coreView__.camera}setCameraControlBoundingBoxCenter(e){this.__coreView__.cameraControl.setBoundingBoxCenter(e)}setCameraControlBounding(e,t){this.__coreView__.cameraControl.setBoundingBox(e,t)}getRotateCenter(){return this.__coreView__.cameraControl.getRotateCenter()}setRotateCenter(e){this.__coreView__.cameraControl.setRotateCenter(e)}getViewLockedState(){return this.__coreView__.cameraControl.isViewLockedBySingleBody}setViewLockedState(e){this.__coreView__.cameraControl.isViewLockedBySingleBody=e}getCameraInfo(){return this.__coreView__.cameraControl.getCameraInfo()}adjustNearAndFar(){this.__coreView__.cameraControl.adjustNearAndFar()}updateViewBoxCamDir(){this.__coreView__.cameraControl.updateViewBoxCamDir()}startSmoothTranslation(e){this.__coreView__.cameraControl.startSmoothTranslation(e)}zoomExtents(e,t,r){this.__coreView__.cameraControl.zoomExtents(e,t,r)}setCameraInfo(e,t){this.__coreView__.cameraControl.setCameraInfo(e,t)}getOrginalCameraInfo(){return(this.__coreView__.viewManager||this.__coreView__.camera).getOrginalCameraInfo()}setOrginalCameraInfo(e,t,r){this.__coreView__.camera.setOrginalCameraInfo({center:e,up:t,position:r})}toPerspectiveCamera(){this.__coreView__.toPerspectiveCamera()}toOrthographicCamera(){this.__coreView__.toOrthographicCamera()}updateGroundTransform(e,t,r){return this.__coreView__.groundShadow.updateGroundTransform(e,t,r)}isRendererContainsClipPlanes(){return 0<this.__coreView__.renderer.clippingPlanes.length}getCanvas2D(){return this.__coreView__.canvas2D}getCanvas3D(){return this.__coreView__.canvas3D}getContainer(){return this.__coreView__.container}getRenderDomElement(){return this.__coreView__.renderer.domElement}getAdditionalObjectsScene(){return this.__coreView__.additionalObjectsScene}getDispalyModelUnit(e,t){return this.__coreView__.getDispalyModelUnit(e,t)}setDispalyModelUnit(e,t){return this.__coreView__.setDispalyModelUnit(e,t)}modelCoordToClientCoord(e){return this.__coreView__.modelCoordToClientCoord(e)}clientCoordToModelCoord(e){return this.__coreView__.clientCoordToModelCoord(e)}showObject(e,t,r,s=!0){this.__coreView__.showObject(e,t,r,s)}showObjectReversed(e){this.__coreView__.showObjectReversed(e)}renderAllViews(){this.__coreView__.renderAllViews()}render(e){this.__coreView__.render(e)}setRenderMode(e,t){this.__coreView__.setRenderMode(e,t)}getRenderMode(){let e=void 0;switch(this.__coreView__.getRenderMode()){case 0:e="lighting";break;case 1:e="primarycolor";break;case 2:e="wireframe";break;case 3:e="whitemold";break;case 4:e="shadedWithEdges";break;case 5:e="shaded";break;case 6:e="hiddenLineRemove";break;case 7:e="hiddenLineVisible";break;case 8:e="transparent"}return e}getAssemblyPMIState(){return this.__coreView__.AssemblyPMIState}setAssemblyPMIState(e){this.__coreView__.AssemblyPMIState=e}getPartPMIState(){return this.__coreView__.PartPMIState}setPartPMIState(e){this.__coreView__.PartPMIState=e}getPmiVisible(){return this.__coreView__.pmiVisible}setPmiVisible(e){this.__coreView__.pmiVisible=e}setPMIObjectVisible(e,t){this.__coreView__.setPMIObjectVisible(e,t)}isPMIOccludeByModel(){return!NDSWebViewer.SETTING.StopPMIOcclusion}enablePMIOccludeByModel(e){this.__coreView__.stopPMIOcclusion(!e)}getPmiList(){return this.__coreView__.PMINDSBodys}getPMIObjectByUUID(e,t=-1){return this.__coreView__.getPMIObjectByuuid(e,t)}isPMIObjectOrSomeChildHidden(e){return this.__coreView__.isPMIObjectOrSomeChildHidden(e)}getPmiObjectTree(){return this.__coreView__.pmiObject}getSelectedPmiList(){return this.__coreView__.getPMINDSBodySelectList()}selectPMIObject(e,t=!0){this.__coreView__.selectPMIObject(e,t)}deselectPMIObject(e,t=!0){this.__coreView__.deselectPMIObject(e,t)}unmergeBodyNode(){this.__coreView__.ndsModel.unmergeNode()}mergeBodyNode(){this.__coreView__.ndsModel.mergeNode()}getAllTransparentBodies(e){return this.__coreView__.ndsModel.getAllTransparentBodies(e)}hasTransparentBodies(){return this.__coreView__.ndsModel.hasTransparentBodies()}isolateBodiesOnly(e){this.__coreView__.ndsModel.isolateBodiesOnly(e)}clearTransparentModeBodiesMap(){this.__coreView__.ndsModel.transparentModeBodiesMap.clear()}unloadModelById(e){this.__coreView__.ndsModel.unloadModelById(e)}startLoadAnimationModel(e){var t=e.url,r=e.id,e={needsPMI:!1,needsAnimation:!1,needsSketchModel:!1,position:e.position,pmiVisible:this.__coreView__.pmiVisible,modelId:e.modelId};this.__coreView__.loadModel(r,t,null,null,"js",null,null,null,e)}getBodyNodeFromUuid(t,e=-1){var r=null;return 0<=e?(e=this.getModelById(e))&&(e=e.getBodyNodeFromUuid(t))&&(r=e):this.__coreView__.ndsModel.models.forEach(e=>{e=e.getBodyNodeFromUuid(t);e&&(r=e)}),r}enableTransparent(e){this.__coreView__.enableTransparent(e)}applyActiveViewState(){this.__coreView__.viewManager&&this.__coreView__.viewManager.applyActiveViewState()}}class B{static getBodyNodes(e){return e.bodyNodes}static updateMeshSetRenderMode(e,t,r){return e.updateMeshSetRenderMode(t,r)}static containsBodyNode(e,t){return e.containsBodyNode(t)}static getRenderMode(e){return e.renderMode}static setRenderMode(e,t){e.renderMode=t}}class I{static getModel(e){return e.ndsModel}static getModelId(e){return e.ndsModel.id}static getUUID(e){return e.uuid}static getObjectId(e){return e.objectid}static getId(e){return e.id}static getBodyNodeMaterial(e){var t=e.getMaterialBodyNodeUUid();return t&&e.useBodyNodeMaterial?e.ndsModel.bodyNodeUUidToMaterial[t]:null}static setBodyNodeMaterial(e,t){e.ndsModel.bodyNodeUUidToMaterial[e.uuid]=t,e.useBodyNodeMaterial=!!t}static getUserMaterial(e){return e.getUserMaterial()}static setUserMaterial(e,t){e.setUserMaterial(t)}static getBoundingBox(e){var t=new THREE.Box3;return e.getBoundingBox(t,!0)}static isLeafBodyNode(e){return!!e.leafBodyAttri}static isPartBodyNode(e){return"Part"===e.type}static getLeafBodyNodes(e){return e.ndsModel.getLeafBodies(e)}static getMeshesInLeafBodyNode(e){return e.leafBodyAttri?e.leafBodyAttri.bodyMeshIds:[]}static getMatrixLocal(e){return e.matrix}static getMatrixWorld(e){return e.worldMatrix}static setMatrixWorld(e,t){e.setMatrixWorld(t)}static applyTransform(e,t=null){e.applyTransform(t)}static updateMatrixWorld(e,t=!1){e.updateMatrixWorld(t,!0)}static hide(e){e.hide(),e.ndsModel.hideBodies.push(e)}static show(e){e.show(),e.ndsModel.RemoveElement(e.ndsModel.hideBodies,e)}static isPreSelected(e){return e.isPreSelected()}static isSelected(e){return e.isSelected()}static isTransparent(e){return e.isTransparent()}static isHidden(e){return e.isHidden()}static isIsolated(e){return e.isIsolated()}static getRenderMode(e){switch(e.renderMode){case 3:return"wireframe";case 4:return"hiddenLineRemove";case 5:return"hiddenLineVisible"}return""}static getBodyNodeTranslate(e,r){var s=new THREE.Vector3(0,0,0),i=e.getExtensionWithFlags(a.FLAG_ENABLE_NODE_TRANSFORM);for(let e=0,t=i.length;e<t;++e)s.add(i[e].getBodyNodeTranslate(r));return s}static updateNodeMatrix(e,t){e.ndsModel.updateNodeMatrix(e.uuid,t,e.getModel().id)}static hideBody(e){e.ndsModel.hideBody(e)}static showBody(e){e.ndsModel.showBody(e)}}class o{constructor(e){this.__selectionManager__=e.selectionManager}getSelectedObjects(){return this.__selectionManager__.getSelectedObjects()}getSelectedMeshes(){return this.__selectionManager__.getSelectedMeshes()}clearSelection(){this.__selectionManager__.clearSelection()}setSelectType(e){this.__selectionManager__.setSelectType(e)}selectByClick(e,t){this.__selectionManager__.selectByClick(e,t)}selectObject(e,t,r){this.__selectionManager__.selectObject(e,t,r)}deselectObject(e,t){this.__selectionManager__.deselectObject(e,t)}getSelectedSketchObjects(){return this.__selectionManager__.getSelectedSketchObjects()}}class n{constructor(e){this.__meshstate__=e}getMeshMaterial(e){return this.__meshstate__.getMeshMaterial(e)}setMeshMaterial(e,t){this.__meshstate__.setMeshMaterial(e,t)}setMeshMaterialTemporary(e,t){var r,e=this.__meshstate__.meshMtls.get(e);e&&(r=e.material,e.material=t,this.__meshstate__.__updateMeshMtlBuffer(e.meshMtlIndex,e),this.__meshstate__.meshMtlTexture.needsUpdate=!0,e.material=r,e.meshSet.needsUpdate=!0,e.meshSet.prepareForBatchDraw())}getLineMaterial(e){this.__meshstate__.getLineMaterial(e)}setLineMaterial(e,t,r){this.__meshstate__.setLineMaterial(e,t,r)}setLineMaterialTemporary(e,t,r){var e=this.__meshstate__.lineMtls.get(e);e&&(e=2*e.lineMtlIndex,this.__meshstate__.lineMtlBuffer[e]=t,this.__meshstate__.lineMtlBuffer[1+e]=Math.round(1e3*r),this.__meshstate__.lineMtlTexture.needsUpdate=!0)}}class d{constructor(e){this.__brepManager__=e}hasBrepInfo(){return this.__brepManager__.hasBrepInfo()}hasBrepFile(){return this.__brepManager__.hasBrepFile()}}class _{constructor(e){(this.__ndsModel__=e).meshState&&(this.__meshState__=new n(e.meshState)),e.brepManager&&(this.__brepManager__=new d(e.brepManager))}get isMCAD3DModel(){return this.__ndsModel__.isMCAD3DModel}get isMCAD2DModel(){return this.__ndsModel__.isMCAD2DModel}get typeName(){return this.__ndsModel__.typeName}get ndsModelId(){return this.__ndsModel__.id}get numMesh(){}getMeshState(){return this.__meshState__}getBrepManager(){return this.__brepManager__}getPMIObject(){return this.__ndsModel__.pmiObject}getRootBodyNode(){return this.__ndsModel__.rootBodyNode}getBodyNode(e){return this.__ndsModel__.getBodyNode(e)}getLeafBodies(e){return this.__ndsModel__.getLeafBodies(e)}isSketchModel(){return!!this.__ndsModel__.isSketchModel}getLeafBodyNodes(){return this.__ndsModel__.wholeLeafBodyNodes}transparentizeBodies(e){this.__ndsModel__.transparentizeBodies(e)}isolateBodies(e){this.__ndsModel__.isolateBodies(e,NDSWebViewer.SETTING.bodyOpacity,NDSWebViewer.SETTING.lineOpacity)}clearTransparentBodies(){this.__ndsModel__.exitIsolate()}getMeshSets(){return this.__ndsModel__.getMeshSets()}changeObjectidTouuid(e){return this.__ndsModel__.objectidTouuid[e]}getMeshMaterial(e){return this.__ndsModel__?(e=this.__ndsModel__.meshManager.materialId[e],e=this.__ndsModel__.meshManager.materialUuids[e],this.__ndsModel__.meshManager.materials[e].mat):null}setMeshMaterial(e,t){if(!this.__ndsModel__)return!1;var r=this.__ndsModel__;let s=0;if(r.meshManager.materials[t.uuid]){for(let e=0;e<r.meshManager.materialUuids.length;e++)if(r.meshManager.materialUuids[e]===t.uuid){s=e;break}}else r.meshManager.materials[t.uuid]={mat:t,refCount:0},s=r.meshManager.materialUuids.length,r.meshManager.materialUuids.push(t.uuid);var i=r.meshManager.materialId[e],i=r.meshManager.materialUuids[i];return r.meshManager.materials[i].refCount--,r.meshManager.materials[t.uuid].refCount++,r.meshManager.materialId[e]=s,r.meshManager.materialIdOriginal[e]=s,!0}removeAllBodyNodeMaterials(){this.__ndsModel__.removeAllBodyNodeMaterials()}refreshBodyWorldMatrixUniforms(){this.__ndsModel__.refreshBodyWorldMatrixUniforms()}refreshMeshState(e=void 0){this.__ndsModel__.refreshMeshState(e||this.__ndsModel__.rootBodyNode)}}r=new class extends s{constructor(){super(),this.name="StoreViewExtension",console.log("NDSStoreViewExtension version 1.0.1"),this.coreView=null}onLoad(e){this.sceneWraper=new i(e),this.selectWraper=new o(e),this.coreView=e}resetModelState(e){e.meshVisible?I.hideBody(this.modelWraper.getRootBodyNode()):I.showBody(this.modelWraper.getRootBodyNode()),this.modelWraper.clearTransparentBodies();var t=this.modelWraper.getMeshSets();for(let e=0;e<t.length;++e){var r=t[e],s=B.getBodyNodes(r);if(void 0!==s&&void 0!==B.getRenderMode(r))for(let e=0;e<s.length;++e)B.updateMeshSetRenderMode(r,s[e],"")}}getMeshState(e){var t=[],r=[],s=[],i=[],o=[];if(0<(o=this.modelWraper.isSketchModel()?this.selectWraper.getSelectedSketchObjects():this.selectWraper.getSelectedObjects()).length){e.meshSel=[];for(var n,a=0;a<o.length;++a)this.modelWraper.isMCAD2DModel?e.meshSel.push(o[a].id):(n=void 0!==o[a].instanceOrPartIndex?o[a].bodyNode:o[a]).ndsModel.id===e.id&&(void 0!==o[a].instanceOrPartIndex?e.meshSel.push({uuid:n.uuid,instanceOrPartIndex:o[a].instanceOrPartIndex}):e.meshSel.push({uuid:n.uuid}))}for(var d=this.modelWraper.getLeafBodyNodes(),_=0,l=d.length;_<l;++_){var h=d[_];if(I.isLeafBodyNode(h))if(h.IsInstanceNode&&1<h.instanceNum){var c=h.instanceNum;for(let e=0;e<c;++e)(h.isHidden(!1,e)?r:t).push({id:I.getId(h),instanceOrPartIndex:e}),this.sceneWraper.hasTransparentBodies()&&(!h.isIsolated(e)&&h.isTransparent(e)?s:i).push({id:I.getId(h),instanceOrPartIndex:e})}else(I.isHidden(h)?r:t).push(I.getId(h)),0<this.sceneWraper.getAllTransparentBodies().length&&(I.isIsolated(h)||!I.isTransparent(h)||I.getRenderMode(h)?i:s).push(I.getId(h))}0==r.length?e.meshInvisible=[]:0==t.length&&0<r.length?e.meshVisible=[]:r.length<=t.length?e.meshInvisible=r:e.meshVisible=t,s.length<=i.length?e.meshTrans=s:e.meshNoTrans=i;var g=[],M=this.modelWraper.getMeshSets();for(let e=0;e<M.length;++e){var u=M[e],m=B.getBodyNodes(u),u=B.getRenderMode(u);if(void 0!==m&&void 0!==u){var u={index:e,mode:u},p=[];for(let e=0;e<m.length;++e){var w=I.getRenderMode(m[e]);w&&p.push({index:e,mode:w})}u.renderNodes=p,g.push(u)}}0<g.length&&(e.meshSetRenderInfos=g)}applyMeshState(t){if(0<!this.sceneWraper.getModelCount())console.warn("ndsModel没有正确创建。请检查模型载入状态。");else{if(this.resetModelState(t),null!=t.meshSel&&0<t.meshSel.length)for(var e,r=0;r<t.meshSel.length;++r)(e=this.modelWraper.isMCAD2DModel?this.modelWraper.getBodyNode(t.meshSel[r]):(e=t.meshSel[r].uuid,this.sceneWraper.getBodyNodeFromUuid(e,t.id)))&&(void 0!==t.meshSel[r].instanceOrPartIndex?this.selectWraper.selectObject({bodyNode:e,instanceOrPartIndex:t.meshSel[r].instanceOrPartIndex}):this.selectWraper.selectObject(e));if(t.meshVisible){let e;for(r=0;r<t.meshVisible.length;++r)this.modelWraper.__ndsModel__.hasHiddenBodies=!0,void 0!==t.meshVisible[r].instanceOrPartIndex?(i=t.meshVisible[r].id,(e=this.modelWraper.getBodyNode(i)).show(t.meshVisible[r].instanceOrPartIndex)):(i=t.meshVisible[r],e=this.modelWraper.getBodyNode(i),I.show(e))}else if(t.meshInvisible){let e;for(r=0;r<t.meshInvisible.length;++r)this.modelWraper.__ndsModel__.hasHiddenBodies=!0,void 0!==t.meshInvisible[r].instanceOrPartIndex?(i=t.meshInvisible[r].id,(e=this.modelWraper.getBodyNode(i)).hide(t.meshInvisible[r].instanceOrPartIndex)):(i=t.meshInvisible[r],e=this.modelWraper.getBodyNode(i),I.hide(e),I.setBodyNodeMaterial(e))}if(t.meshTrans&&0<t.meshTrans.length){if(0<this.sceneWraper.getModelCount()){for(var s=[],r=0;r<t.meshTrans.length;++r)void 0!==t.meshTrans[r].instanceOrPartIndex?(i=t.meshTrans[r].id,s.push({bodyNode:this.modelWraper.getBodyNode(i),instanceOrPartIndex:t.meshTrans[r].instanceOrPartIndex})):(i=t.meshTrans[r],s.push(this.modelWraper.getBodyNode(i)));this.modelWraper.transparentizeBodies(s)}}else if(t.meshNoTrans)if(0<t.meshNoTrans.length){for(var i,s=[],r=0;r<t.meshNoTrans.length;++r)void 0!==t.meshNoTrans[r].instanceOrPartIndex?(i=t.meshNoTrans[r].id,s.push({bodyNode:this.modelWraper.getBodyNode(i),instanceOrPartIndex:t.meshNoTrans[r].instanceOrPartIndex})):(i=t.meshNoTrans[r],s.push(this.modelWraper.getBodyNode(i)));this.modelWraper.isolateBodies(s)}else{var o;0==t.meshNoTrans.length&&((o=[]).push(this.modelWraper.getRootBodyNode()),this.modelWraper.transparentizeBodies(o))}if(void 0!==t.meshSetRenderInfos){var n=t.meshSetRenderInfos,a=this.modelWraper.getMeshSets();for(let e=0,t=n.length;e<t;++e){var d=n[e],_=a[d.index];if(_){B.setRenderMode(_,d.mode);var l=B.getBodyNodes(_),h=d.renderNodes;for(let e=0,t=h.length;e<t;++e){var c=h[e],g=l[c.index];B.updateMeshSetRenderMode(_,g,c.mode)}}}}}}getBackgroundState(e){var t=this.sceneWraper.getBackgroundState();t&&(e.exchangeBackImage=t)}applyBackgroundState(e){e.exchangeBackImage?NDSWebViewer.SETTING.singleHTML&&"Color"!==e.exchangeBackImage.type||this.sceneWraper.setBackgroundState(e.exchangeBackImage.type,e.exchangeBackImage.value):this.sceneWraper.setBackgroundState("Color","0Xf2f2f2")}getPMIInfo(e){e.pmiVisible=this.sceneWraper.getPmiVisible(),e.shouldStopPMIOcclusion=this.sceneWraper.isPMIOccludeByModel();var r=[],s=[],i=this.sceneWraper.getPmiList();if(void 0!==i&&0<i.length){for(let e=0,t=i.length;e<t;++e)null===I.getUUID(i[e])||this.sceneWraper.isPMIObjectOrSomeChildHidden(i[e])||s.push(I.getUUID(i[e])+"&"+I.getModelId(i[e]));e.PMIObjectVisibleList=s}var t=this.sceneWraper.getPmiObjectTree();if(t&&t.children){t=t.children[0];if(t.version,2===t.version){var o=this.sceneWraper.getSelectedPmiList();if(o&&0<o.length)for(let e=0,t=o.length;e<t;++e){var n=o[e];this.sceneWraper.isPMIObjectOrSomeChildHidden(n)||r.push(I.getUUID(n)+"&"+I.getModelId(n))}}else if(1===t.version){var a=this.coreView.getPMISelectList();if(a&&0<a.length)for(let e=0,t=a.length;e<t;++e)r.push(a[e].uuid)}e.PMIObjectSelList=r}}applyPMIInfo(r){if(null!=r.pmiVisible&&this.sceneWraper.setPmiVisible(r.pmiVisible),void 0!==r.shouldStopPMIOcclusion&&this.sceneWraper.enablePMIOccludeByModel(r.shouldStopPMIOcclusion),void 0!==r.PMIObjectVisibleList){this.sceneWraper.setPMIObjectVisible(this.sceneWraper.getPmiObjectTree(),!1);for(let e=0,t=r.PMIObjectVisibleList.length;e<t;e++){var s=r.PMIObjectVisibleList[e].split("&");this.sceneWraper.setPMIObjectVisible(this.sceneWraper.getPMIObjectByUUID(s[0],Number(s[1])),!0)}}if(void 0!==r.PMIObjectSelList){this.sceneWraper.deselectPMIObject(this.sceneWraper.getPmiObjectTree(),!1);for(let e=0,t=r.PMIObjectSelList.length;e<t;e++){var i=r.PMIObjectSelList[e].split("&");this.sceneWraper.selectPMIObject(this.sceneWraper.getPMIObjectByUUID(i[0],Number(i[1])),!1)}this.sceneWraper.dispatchEvent({type:"selPMI",object:null})}}getRotationCenterInfo(e){var t=this.sceneWraper.getViewControlBoundingBox();let r=this.sceneWraper.getRotateCenter();var s=this.sceneWraper.getViewLockedState();r||(r=new THREE.Vector3,this.sceneWraper.getBoundingBox(!0).getCenter(r)),e.rotationCenterInfo={bound:{min:{x:t.min.x,y:t.min.y,z:t.min.z},max:{x:t.max.x,y:t.max.y,z:t.max.z}},center:{x:r.x,y:r.y,z:r.z},islocked:s}}applyRotationCenterInfo(e){var t,r;null!=e.rotationCenterInfo&&(r=(e=e.rotationCenterInfo).bound,t=e.center,this.sceneWraper.setViewControlBoundingBox(new THREE.Vector3(r.min.x,r.min.y,r.min.z),new THREE.Vector3(r.max.x,r.max.y,r.max.z)),this.sceneWraper.setRotateCenter(new THREE.Vector3(t.x,t.y,t.z)),this.sceneWraper.setViewLockedState(e.islocked),r=this.sceneWraper.getCurrentOperator())&&r.updateRotateCenterHelper()}clear(){}setModelViewInfo(r){this.sceneWraper.applyActiveViewState(),r.renderMode&&this.sceneWraper.setRenderMode(r.renderMode,!0),this.applyBackgroundState(r),this.sceneWraper.setDispalyModelUnit(r.displaymodelUnit,!1),this.applyRotationCenterInfo(r);var s=this.getExtensionWithFlags(a.FLAG_ENABLE_NODE_STOREVIEW);for(let e=0,t=s.length;e<t;++e)s[e].setStoreInfo(r);if(this.selectWraper.clearSelection(),r.modelStates)for(let e=0,t=r.modelStates.length;e<t;++e){var i=r.modelStates[e],o=i.id,n=i.auxiliaryLineVisible,o=this.sceneWraper.getModelById(o);o&&(this.modelWraper=new _(o),void 0!==n?n?I.showBody(this.modelWraper.getRootBodyNode()):I.hideBody(this.modelWraper.getRootBodyNode()):o.rootBodyNode&&this.applyMeshState(i),this.modelWraper=null)}this.sceneWraper.clearTransparentModeBodiesMap(),r.cameraInfo&&(this.coreView.viewManager?(e=this.coreView.viewManager.getActiveView(),r.cameraInfo.isPerspective?e.camera.setPerspectiveCameraInfo(r.cameraInfo):e.camera.setOrthographicCameraInfo(r.cameraInfo),this.coreView.viewManager.setConnectView(!1)):this.sceneWraper.setCameraInfo(r.cameraInfo,!0),r.originalCameraInfo&&this.sceneWraper.setOrginalCameraInfo(new THREE.Vector3(r.originalCameraInfo.center.x,r.originalCameraInfo.center.y,r.originalCameraInfo.center.z),new THREE.Vector3(r.originalCameraInfo.up.x,r.originalCameraInfo.up.y,r.originalCameraInfo.up.z),new THREE.Vector3(r.originalCameraInfo.position.x,r.originalCameraInfo.position.y,r.originalCameraInfo.position.z)),r.cameraInfo.isPerspective?this.sceneWraper.toPerspectiveCamera():this.sceneWraper.toOrthographicCamera()),this.sceneWraper.getPmiObjectTree()&&this.applyPMIInfo(r);var e=this.sceneWraper.getModelByIndex(0);r.enableTransparent!==e.meshManager.enableTransparent&&this.sceneWraper.enableTransparent(r.enableTransparent)}getModelViewInfo(){var r={},s=(this.sceneWraper.applyActiveViewState(),r.operator=this.sceneWraper.getCurrentOperatorID(),r.cameraInfo=this.sceneWraper.getCameraInfo(),r.originalCameraInfo=this.sceneWraper.getOrginalCameraInfo(),r.renderMode=this.sceneWraper.getRenderMode(),r.displaymodelUnit=this.sceneWraper.getDispalyModelUnit(1).unit,[]);for(let e=0,t=this.sceneWraper.getModelCount();e<t;++e){var i={},o=this.sceneWraper.getModelByIndex(e);this.modelWraper=new _(o),i.id=o.id,this.getMeshState(i),s.push(i),this.modelWraper=null}0<s.length&&(r.modelStates=s),this.getBackgroundState(r);var n=this.getExtensionWithFlags(a.FLAG_ENABLE_NODE_STOREVIEW);for(let e=0,t=n.length;e<t;++e)n[e].getStoreInfo(r);this.getPMIInfo(r),this.getRotationCenterInfo(r);var e=this.sceneWraper.getModelByIndex(0);return r.enableTransparent=e.meshManager.enableTransparent,r}};NDSWebViewer.ExtensionManager.addExtension(r)}],s={},i.m=r,i.c=s,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0);function i(e){var t;return(s[e]||(t=s[e]={i:e,l:!1,exports:{}},r[e].call(t.exports,t,t.exports,i),t.l=!0,t)).exports}var r,s});