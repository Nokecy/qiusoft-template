!function(){"use strict";
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */console.log("NDS ExtensionFramework V0.1"),NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM,NDSWebViewer.Extension.FLAG_ENABLE_NODE_TRANSFORM;class e extends NDSWebViewer.Extension{constructor(){super()}onLoad(e){}onInitLights(){}update(e){}setFlags(e){super.setFlags(e)}onNdsModelPrepareForRendering(e){}onBeforeNdsModelUpdate(e,t){}onAfterNdsModelUpdate(e,t){}onBeforeNdsModelSetRender(e,t){}onAfterNdsModelSetRender(e,t){}onBeforeNdsMeshRender(e,t){}getExtensionWithFlags(e){return NDSWebViewer.ExtensionManager.getExtensionWithFlags(e)}resetToDefault(){}getStoreInfo(e){throw this.name+" Extesion did not implement method 'getStoreInfo' "}setStoreInfo(e){throw this.name+" Extesion did not implement method 'setStoreInfo' "}getBodyTransform(e){return new THREE.Matrix4}getBodyNodeTranslate(e){return new THREE.Vector3(0,0,0)}}
/**
	 * @file 这是新迪轻量化引擎查看器插件框架代码，请不要修改此文件
	 * @copyright 新迪数字 2024
	 */class t{constructor(e){this.__coreView__=e}addEventListener(e,t){this.__coreView__.addEventListener(e,t)}hasEventListener(e,t){return this.__coreView__.hasEventListener(e,t)}removeEventListener(e,t){this.__coreView__.removeEventListener(e,t)}dispatchEvent(e){this.__coreView__.dispatchEvent(e)}getPixelRatio(){return this.__coreView__.renderer.getPixelRatio()}switchRotateCenterBySelection(){this.__coreView__.switchRotateCenterBySelection()}setDefaultEnvMap(e){e&&(this.__coreView__.hasPbrMaterial=!0,this.__coreView__.setDefaultEnvMap=()=>{this.__coreView__.setEnvMapEnabled(!0),this.__coreView__.defaultEnvMapTexture=e,this.__coreView__.updateEnvMap(this.__coreView__.defaultEnvMapTexture)},this.__coreView__.setDefaultEnvMap())}getBackgroundState(){return this.__coreView__.exchangeBackImage?{type:this.__coreView__.exchangeBackImage.type,value:this.__coreView__.exchangeBackImage.value}:void 0}setBackgroundState(e,t){"Image"===e?(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(t)):"EnvMap"===e?this.__coreView__.setEnvMapTextures(t):"Color"===e&&(this.__coreView__.setEnvMapTextures(null),this.__coreView__.setBackGroundImage(null),this.__coreView__.setBackGroundColor(t))}removeAllLights(){this.__coreView__.lights.length=0}getLight(e){return this.__coreView__.lights[e]}setLight(e,t){this.__coreView__.lights[e]=t}getViewBox(){return this.__coreView__.viewBox}toggleAutoRotation(e){this.__coreView__.toggleAutoRotation(e)}randColor(){return this.__coreView__.materialsSetting.randColor()}getBoundingBox(e=!1){let t=this.__coreView__.ndsModel.getTotalBodyBoundingBox(null,e);return t.isEmpty()?this.__coreView__.modelRootObject.boundingBox:t}getModelTree(){return this.__coreView__.getModelTree()}getModelCount(){return this.__coreView__.ndsModel.models.length}setActiveModel(e){this.__coreView__.ndsModel.setActiveModel(e)}setActiveModelByModelId(e){let t=-1;for(let r=0;r<this.__coreView__.ndsModel.models.length;++r)if(this.__coreView__.ndsModel.models[r].id===e){t=r;break}this.setActiveModel(t)}getActiveModel(){return this.__coreView__.ndsModel.getActiveModel()}getModelById(e){return this.__coreView__.ndsModel.getModelById(e)}getModelByIndex(e){return this.__coreView__.ndsModel.models[e]}registOperator(e,t){this.__coreView__.registOperator(e,t)}setOperatorByID(e){this.__coreView__.setOperatorByID(e)}getCurrentOperator(){return this.__coreView__.controls.getOperator()}getCurrentOperatorID(){return this.__coreView__.getCurrentOperatorID()}setOperator(e){this.__coreView__.setOperator(e)}registCursor(e,t,r){this.__coreView__.registCursor(e,t,r)}hideSelectedObjects(){this.__coreView__.hideSelectedObjects()}getViewControlBoundingBox(){return this.__coreView__.controls.getBoundingBox()}setViewControlBoundingBox(e,t){this.__coreView__.controls.setBoundingBox(e,t)}getCamera(){return this.__coreView__.camera}setCameraControlBoundingBoxCenter(e){this.__coreView__.cameraControl.setBoundingBoxCenter(e)}setCameraControlBounding(e,t){this.__coreView__.cameraControl.setBoundingBox(e,t)}getRotateCenter(){return this.__coreView__.cameraControl.getRotateCenter()}setRotateCenter(e){this.__coreView__.cameraControl.setRotateCenter(e)}getViewLockedState(){return this.__coreView__.cameraControl.isViewLockedBySingleBody}setViewLockedState(e){this.__coreView__.cameraControl.isViewLockedBySingleBody=e}getCameraInfo(){return this.__coreView__.cameraControl.getCameraInfo()}adjustNearAndFar(){this.__coreView__.cameraControl.adjustNearAndFar()}updateViewBoxCamDir(){this.__coreView__.cameraControl.updateViewBoxCamDir()}startSmoothTranslation(e){this.__coreView__.cameraControl.startSmoothTranslation(e)}zoomExtents(e,t,r){this.__coreView__.cameraControl.zoomExtents(e,t,r)}setCameraInfo(e,t){this.__coreView__.cameraControl.setCameraInfo(e,t)}getOrginalCameraInfo(){return this.__coreView__.viewManager?this.__coreView__.viewManager.getOrginalCameraInfo():this.__coreView__.camera.getOrginalCameraInfo()}setOrginalCameraInfo(e,t,r){this.__coreView__.camera.setOrginalCameraInfo({center:e,up:t,position:r})}toPerspectiveCamera(){this.__coreView__.toPerspectiveCamera()}toOrthographicCamera(){this.__coreView__.toOrthographicCamera()}updateGroundTransform(e,t,r){return this.__coreView__.groundShadow.updateGroundTransform(e,t,r)}isRendererContainsClipPlanes(){return this.__coreView__.renderer.clippingPlanes.length>0}getCanvas2D(){return this.__coreView__.canvas2D}getCanvas3D(){return this.__coreView__.canvas3D}getContainer(){return this.__coreView__.container}getRenderDomElement(){return this.__coreView__.renderer.domElement}getAdditionalObjectsScene(){return this.__coreView__.additionalObjectsScene}getDispalyModelUnit(e,t){return this.__coreView__.getDispalyModelUnit(e,t)}modelCoordToClientCoord(e){return this.__coreView__.modelCoordToClientCoord(e)}clientCoordToModelCoord(e){return this.__coreView__.clientCoordToModelCoord(e)}showObject(e,t,r,o=!0){this.__coreView__.showObject(e,t,r,o)}showObjectReversed(e){this.__coreView__.showObjectReversed(e)}renderAllViews(){this.__coreView__.renderAllViews()}render(e){this.__coreView__.render(e)}setRenderMode(e,t){this.__coreView__.setRenderMode(e,t)}getRenderMode(){let e;switch(this.__coreView__.getRenderMode()){case 0:e="lighting";break;case 1:e="primarycolor";break;case 2:e="wireframe";break;case 3:e="whitemold";break;case 4:e="shadedWithEdges";break;case 5:e="shaded";break;case 6:e="hiddenLineRemove";break;case 7:e="hiddenLineVisible";break;case 8:e="transparent"}return e}getAssemblyPMIState(){return this.__coreView__.AssemblyPMIState}setAssemblyPMIState(e){this.__coreView__.AssemblyPMIState=e}getPartPMIState(){return this.__coreView__.PartPMIState}setPartPMIState(e){this.__coreView__.PartPMIState=e}getPmiVisible(){return this.__coreView__.pmiVisible}setPmiVisible(e){this.__coreView__.pmiVisible=e}setPMIObjectVisible(e,t){this.__coreView__.setPMIObjectVisible(e,t)}isPMIOccludeByModel(){return!NDSWebViewer.SETTING.StopPMIOcclusion}enablePMIOccludeByModel(e){this.__coreView__.stopPMIOcclusion(!e)}getPmiList(){return this.__coreView__.PMINDSBodys}getPMIObjectByUUID(e){return this.__coreView__.PMIUUIDtoPMIObject[e]}isPMIObjectOrSomeChildHidden(e){return this.__coreView__.isPMIObjectOrSomeChildHidden(e)}getPmiObjectTree(){return this.__coreView__.pmiObject}getSelectedPmiList(){return this.__coreView__.getPMINDSBodySelectList()}selectPMIObject(e){this.__coreView__.selectPMIObject(e)}deselectPMIObject(e){this.__coreView__.deselectPMIObject(e)}unmergeBodyNode(){this.__coreView__.ndsModel.unmergeNode()}mergeBodyNode(){this.__coreView__.ndsModel.mergeNode()}getAllTransparentBodies(e){return this.__coreView__.ndsModel.getAllTransparentBodies(e)}isolateBodiesOnly(e){this.__coreView__.ndsModel.isolateBodiesOnly(e)}unloadModelById(e){this.__coreView__.ndsModel.unloadModelById(e)}startLoadAnimationModel(e){let t=e.url,r=e.id,o={needsPMI:!1,needsAnimation:!1,needsSketchModel:!1,position:e.position,pmiVisible:this.__coreView__.pmiVisible,modelId:e.modelId};this.__coreView__.loadModel(r,t,null,null,"js",null,null,null,o)}getBodyNodeFromUuid(e,t=-1){var r=null;if(t>=0){let o=this.getModelById(t);if(o){let t=o.getBodyNodeFromUuid(e);t&&(r=t)}}else this.__coreView__.ndsModel.models.forEach((t=>{let o=t.getBodyNodeFromUuid(e);o&&(r=o)}));return r}loadBrepInfo(e){this.__coreView__.loadBrepInfo(e)}}class r{constructor(e){this.__selectionManager__=e.selectionManager}getSelectedObjects(){return this.__selectionManager__.getSelectedObjects()}getSelectedMeshes(){return this.__selectionManager__.getSelectedMeshes()}clearSelection(){this.__selectionManager__.clearSelection()}setSelectType(e){this.__selectionManager__.setSelectType(e)}selectByClick(e,t){this.__selectionManager__.selectByClick(e,t)}}"undefined"!=typeof token&&token;const o=new class extends e{constructor(){super(),this.name="PMIControlExtension",console.log("PMIControlExtension version 1.0.2"),this._box=new THREE.Box3,this._tempLine=null,this.localMatrix=new THREE.Matrix4,this.destMatrix=new THREE.Matrix4,this.temMatrix=new THREE.Matrix4,this.epsilon=1e-4}onLoad(e){this.sceneWraper=new t(e),this.selectionManager=new r(e),this.coreView=e}getUpDir(e){if(e.geometry&&(e.textOrSymbolObject||e.geometry.TextBox)){let t=new THREE.Line3(new THREE.Vector3(0,0,0),new THREE.Vector3(0,100,0)),r=new THREE.Line3(new THREE.Vector3(0,0,100),new THREE.Vector3(0,0,0));return t.applyMatrix4(e.matrixWorld),t.start.sub(t.end),r.applyMatrix4(e.matrixWorld),r.start.sub(r.end),{up:t.start.normalize().negate(),dir:r.start.normalize().negate()}}if(e.geometry&&e.geometry.attributes.instanceStart){let t=e.geometry.attributes.instanceStart.data.array,r=new THREE.Vector3,o=new THREE.Vector3;r.fromArray(t,0).applyMatrix4(e.matrixWorld),o.fromArray(t,3).applyMatrix4(e.matrixWorld);let i=(new THREE.Vector3).subVectors(r,o);if(this._tempLine){if(this._tempLine.clone().cross(i).length()>this.epsilon)return{up:null,dir:(new THREE.Vector3).crossVectors(this._tempLine,i).normalize()}}else this._tempLine=i}const t=e.children;for(let e=0,r=t.length;e<r;e++){let r=this.getUpDir(t[e]);if(r)return r}return null}expandByObject(e,t){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),this._box.copy(e.boundingBox),this._box.applyMatrix4(e.matrixWorld),t.union(this._box);else{const r=e.geometry;if(void 0!==r){null===r.boundingBox&&r.computeBoundingBox();let o=r.TextBox?r.TextBox:r.boundingBox;this._box.copy(o),this._box.applyMatrix4(e.matrixWorld),t.union(this._box)}}const r=e.children;for(let e=0,o=r.length;e<o;e++)this.expandByObject(r[e],t)}orthographicPMI(e){if(e instanceof NDSWebViewer.NdsBodyNode){e=this.sceneWraper.getModelById(e.ndsModel.id).PMIUUIDtoPMIObject[e.uuid]}if(e.fixedPmi&&e.fixedBox)return;let t,r;const o=this;e.followCamera&&("Mesh"===e.type&&"TextBufferGeometry"===e.geometry.type||(this.localMatrix.copy(e.parent.matrixWorld),this.destMatrix.copy(e.matrixWorld),e.matrix.copy(this.destMatrix.premultiply(this.temMatrix.getInverse(this.localMatrix)))));let i=new THREE.Box3;this.expandByObject(e,i),this._tempLine=null;let n=this.getUpDir(e);if(n&&(t=n.dir,r=n.up),e.followCamera){let e=this.sceneWraper.getCameraInfo();var s=new THREE.Vector3(e.position.x,e.position.y,e.position.z);t=new THREE.Vector3(e.target.x,e.target.y,e.target.z).sub(s).normalize(),r=new THREE.Vector3(e.up.x,e.up.y,e.up.z)}else if(!t)if(Math.abs(i.min.x-i.max.x)<this.epsilon)t=new THREE.Vector3(-1,0,0);else if(Math.abs(i.min.y-i.max.y)<this.epsilon)t=new THREE.Vector3(0,-1,0);else if(Math.abs(i.min.z-i.max.z)<this.epsilon)t=new THREE.Vector3(0,0,-1);else{const e=new THREE.Vector3(i.min.x,i.min.y,i.min.z),r=new THREE.Vector3(i.max.x,i.min.y,i.max.z),o=new THREE.Vector3(i.max.x,i.max.y,i.max.z),n=(new THREE.Vector3).subVectors(r,e),s=(new THREE.Vector3).subVectors(o,e);t=(new THREE.Vector3).crossVectors(n,s).normalize().negate()}var _={dir:t,up:r||new THREE.Vector3(0,1,0),callback:()=>{let e=o.sceneWraper.getBoundingBox(!0);o.sceneWraper.setViewControlBoundingBox(e.min,e.max)}};this.sceneWraper.setViewControlBoundingBox(i.min,i.max),this.sceneWraper.zoomExtents(!0,!1,_)}};NDSWebViewer.ExtensionManager.addExtension(o)}();
